!function(global){global.StarSchema=global.StarSchema||{},global.StarSchema.NodeDisplayNameProp="separatedDisplayName",global.StarSchema.NodeDisplayNameSeperator="$",global.StarSchema.trancateTreshold=17,global.StarSchema.MaxFactTextLength=18,global.StarSchema.MaxDimensionTextLength=18;var default_rx=10,default_ry=10;global.AttuGraph.shapes.StarSchemaFact={draw:function(node,nodeEl){{var max_text_length=global.StarSchema.MaxFactTextLength;d3.select(nodeEl).append("rect").attr("class",node.class).attr("rx",default_rx).attr("ry",default_ry)}node[StarSchema.NodeDisplayNameProp]=node.display_name.length==global.StarSchema.trancateTreshold?node.display_name:node.display_name.substring(0,global.StarSchema.trancateTreshold)+StarSchema.NodeDisplayNameSeperator+node.display_name.substring(global.StarSchema.trancateTreshold),global.AttuGraph.Utils.setTextToNode(node,nodeEl,StarSchema.NodeDisplayNameProp,StarSchema.NodeDisplayNameSeperator,max_text_length),global.AttuGraph.Utils.setToolTipToNode(node.display_name,nodeEl),0==node.clickable&&d3.select(nodeEl).classed("no_click",!0)},getBBox:function(node,el){return d3.select(el).select("rect").node().getBBox()},size:function(node,el){var default_height=50,default_width=50,node_bbox={height:node.height||default_height,width:node.width||default_width},rect=d3.select(el).select("rect"),text=d3.select(el).select("text");rect.attr("width",node_bbox.width).attr("height",node_bbox.height),text.attr("text-anchor","left"),text.attr("y",0)},update:function(){}},global.AttuGraph.shapes.StarSchemaDimension={draw:function(node,nodeEl){d3.select(nodeEl).append("rect").attr("class",node.class).attr("rx",default_rx).attr("ry",default_ry);node[StarSchema.NodeDisplayNameProp]=node.display_name.substring(0,global.StarSchema.trancateTreshold)+StarSchema.NodeDisplayNameSeperator+node.display_name.substring(global.StarSchema.trancateTreshold),global.AttuGraph.Utils.setTextToNode(node,nodeEl,StarSchema.NodeDisplayNameProp,StarSchema.NodeDisplayNameSeperator,global.StarSchema.MaxDimensionTextLength),global.AttuGraph.Utils.setToolTipToNode(node.display_name,nodeEl),0==node.clickable&&d3.select(nodeEl).classed("no_click",!0),node.is_shared&&d3.select(nodeEl).append("image").attr("class","shared_dim").attr("xlink:href","shared/images/shared_dimension.svg").attr("width",12).attr("height",12).attr("x",node.width-12)},getBBox:function(node,el){return d3.select(el).select("rect").node().getBBox()},size:function(node,el){var default_height=50,default_width=50,node_bbox={height:node.height||default_height,width:node.width||default_width},rect=d3.select(el).select("rect"),text=d3.select(el).select("text");rect.attr("width",node_bbox.width).attr("height",node_bbox.height),text.attr("text-anchor","left")},update:function(node,nodeEl){if(d3.select(nodeEl).selectAll(".shared_dim").remove(),node.de_normalized_entities.length>0){var names=node.de_normalized_entities.map(function(it){return"- "+it.caption}),tooltipPrefix="The following entities are denormalized in this dimension:\n";if(node.de_normalized_entities.length<=5)for(var rectSize=4,i=0;i<node.de_normalized_entities.length;i++){var xPos=7*i+10,de_normalized_rect=d3.select(nodeEl).append("rect").attr("class","shared_dim").attr("width",rectSize).attr("height",rectSize).attr("y",51).attr("x",xPos);global.AttuGraph.Utils.hasValidProp(node.de_normalized_entities[i],"caption")&&global.AttuGraph.Utils.setToolTipToNode(tooltipPrefix+names.join("\n"),de_normalized_rect.node())}else d3.select(nodeEl).append("text").text(node.de_normalized_entities.length+" Entities").attr("y",57).attr("x",6).attr("class","shared_dim")}}}}(this);
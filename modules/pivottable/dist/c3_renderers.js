(function(){var callWithJQuery;(callWithJQuery=function(pivotModule){return"object"==typeof exports&&"object"==typeof module?pivotModule(require("jquery"),require("c3")):"function"==typeof define&&define.amd?define(["jquery","c3"],pivotModule):pivotModule(jQuery,c3)})(function($,c3){var makeC3Chart;return makeC3Chart=function(chartOpts){return null==chartOpts&&(chartOpts={}),function(pivotData,opts){var agg,attrs,base,base1,base2,base3,base4,base5,base6,base7,c,categories,colKey,colKeys,columns,dataColumns,defaults,formatter,fullAggName,groupByTitle,h,hAxisTitle,headers,i,j,k,l,len,len1,len2,len3,len4,m,numCharsInHAxis,numSeries,params,ref,ref1,ref2,ref3,renderArea,result,rotationAngle,row,rowHeader,rowKey,rowKeys,s,scatterData,series,title,titleText,vAxisTitle,val,vals,x,xs,y;if(defaults={localeStrings:{vs:"vs",by:"by"},c3:{}},opts=$.extend(!0,{},defaults,opts),null==(base=opts.c3).size&&(base.size={}),null==(base1=opts.c3.size).width&&(base1.width=window.innerWidth/1.4),null==(base2=opts.c3.size).height&&(base2.height=window.innerHeight/1.4-50),null==chartOpts.type&&(chartOpts.type="line"),null==chartOpts.horizontal&&(chartOpts.horizontal=!1),null==chartOpts.stacked&&(chartOpts.stacked=!1),rowKeys=pivotData.getRowKeys(),0===rowKeys.length&&rowKeys.push([]),colKeys=pivotData.getColKeys(),0===colKeys.length&&colKeys.push([]),headers=function(){var i,len,results;for(results=[],i=0,len=colKeys.length;len>i;i++)h=colKeys[i],results.push(h.join("-"));return results}(),rotationAngle=0,fullAggName=pivotData.aggregatorName,pivotData.valAttrs.length&&(fullAggName+="("+pivotData.valAttrs.join(", ")+")"),"scatter"===chartOpts.type)for(scatterData={x:{},y:{},t:{}},attrs=pivotData.rowAttrs.concat(pivotData.colAttrs),vAxisTitle=null!=(ref=attrs[0])?ref:"",hAxisTitle=null!=(ref1=attrs[1])?ref1:"",groupByTitle=attrs.slice(2).join("-"),titleText=vAxisTitle,""!==hAxisTitle&&(titleText+=" "+opts.localeStrings.vs+" "+hAxisTitle),""!==groupByTitle&&(titleText+=" "+opts.localeStrings.by+" "+groupByTitle),i=0,len=rowKeys.length;len>i;i++)for(rowKey=rowKeys[i],j=0,len1=colKeys.length;len1>j;j++)colKey=colKeys[j],agg=pivotData.getAggregator(rowKey,colKey),null!=agg.value()&&(vals=rowKey.concat(colKey),series=vals.slice(2).join("-"),""===series&&(series="series"),null==(base3=scatterData.x)[series]&&(base3[series]=[]),null==(base4=scatterData.y)[series]&&(base4[series]=[]),y=null!=(ref2=vals[0])?ref2:0,x=null!=(ref3=vals[1])?ref3:0,scatterData.y[series].push(y),scatterData.x[series].push(x),null==(base5=scatterData.t)[series]&&(base5[series]={}),null==(base6=scatterData.t[series])[x]&&(base6[x]={}),scatterData.t[series][x][y]=agg.value());else{for(numCharsInHAxis=0,k=0,len2=headers.length;len2>k;k++)x=headers[k],numCharsInHAxis+=x.length;for(numCharsInHAxis>50&&(rotationAngle=45),columns=[],l=0,len3=rowKeys.length;len3>l;l++){for(rowKey=rowKeys[l],rowHeader=rowKey.join("-"),row=[""===rowHeader?fullAggName:rowHeader],m=0,len4=colKeys.length;len4>m;m++)colKey=colKeys[m],val=parseFloat(pivotData.getAggregator(rowKey,colKey).value()),row.push(isFinite(val)?val:null);columns.push(row)}vAxisTitle=fullAggName,chartOpts.horizontal?(hAxisTitle=pivotData.rowAttrs.join("-"),groupByTitle=pivotData.colAttrs.join("-")):(hAxisTitle=pivotData.colAttrs.join("-"),groupByTitle=pivotData.rowAttrs.join("-")),titleText=fullAggName,""!==hAxisTitle&&(titleText+=" "+opts.localeStrings.vs+" "+hAxisTitle),""!==groupByTitle&&(titleText+=" "+opts.localeStrings.by+" "+groupByTitle)}if(title=$("<p>",{style:"text-align: center; font-weight: bold"}),title.text(titleText),formatter=pivotData.getAggregator([],[]).format,params={axis:{rotated:chartOpts.horizontal,y:{label:vAxisTitle,tick:{}},x:{label:hAxisTitle,tick:{rotate:rotationAngle,multiline:!1}}},data:{type:chartOpts.type,order:null},tooltip:{grouped:!1},color:{pattern:["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac"]}},params=$.extend(!0,{},params,opts.c3),"scatter"===chartOpts.type){xs={},numSeries=0,dataColumns=[];for(s in scatterData.x)numSeries+=1,xs[s]=s+"_x",dataColumns.push([s+"_x"].concat(scatterData.x[s])),dataColumns.push([s].concat(scatterData.y[s]));params.data.xs=xs,params.data.columns=dataColumns,params.axis.x.tick={fit:!1},1===numSeries&&(params.legend={show:!1}),params.tooltip.format={title:function(){return fullAggName},name:function(){return""},value:function(a,b,c,d,e){var ref4;return ref4=e[0],series=ref4.name,y=ref4.value,x=ref4.x,formatter(scatterData.t[series][x][y])}}}else params.axis.x.type="category",null==(base7=params.axis.y.tick).format&&(base7.format=function(v){return formatter(v)}),params.tooltip.format={value:function(v){return formatter(v)}},chartOpts.horizontal?(categories=function(){var len5,n,results;for(results=[],n=0,len5=columns.length;len5>n;n++)c=columns[n],results.push(c.shift());return results}(),1===categories.length&&categories[0]===fullAggName&&(categories=[""]),params.axis.x.categories=categories,1===headers.length&&""===headers[0]&&(headers=[fullAggName]),columns.unshift(headers),params.data.rows=columns):(params.axis.x.categories=headers,params.data.columns=columns);return chartOpts.stacked&&(params.data.groups=chartOpts.horizontal?[function(){var len5,n,results;for(results=[],n=0,len5=colKeys.length;len5>n;n++)x=colKeys[n],results.push(x.join("-"));return results}()]:[function(){var len5,n,results;for(results=[],n=0,len5=rowKeys.length;len5>n;n++)x=rowKeys[n],results.push(x.join("-"));return results}()]),renderArea=$("<div>",{style:"display:none;"}).appendTo($("body")),result=$("<div>").appendTo(renderArea),params.bindto=result[0],c3.generate(params),result.detach(),renderArea.remove(),$("<div>").append(title,result)}},$.pivotUtilities.c3_renderers={"Horizontal Bar Chart":makeC3Chart({type:"bar",horizontal:!0}),"Horizontal Stacked Bar Chart":makeC3Chart({type:"bar",stacked:!0,horizontal:!0}),"Bar Chart":makeC3Chart({type:"bar"}),"Stacked Bar Chart":makeC3Chart({type:"bar",stacked:!0}),"Line Chart":makeC3Chart(),"Area Chart":makeC3Chart({type:"area",stacked:!0}),"Scatter Chart":makeC3Chart({type:"scatter"})}})}).call(this);
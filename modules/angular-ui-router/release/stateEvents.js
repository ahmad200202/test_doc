!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("angular")):"function"==typeof define&&define.amd?define(["exports","angular"],factory):(global=global||self,factory(global["@uirouter/angularjs-state-events"]={},global.angular))}(this,function(exports,ng_from_import){"use strict";var $stateChangeStart,$stateChangeCancel,$stateChangeSuccess,$stateChangeError,$stateNotFound,ng_from_global=angular,ng=ng_from_import&&ng_from_import.module?ng_from_import:ng_from_global;!function(){function applyPairs(memo,keyValTuple){var key,value;if(Array.isArray(keyValTuple)&&(key=keyValTuple[0],value=keyValTuple[1]),!isString(key))throw new Error("invalid parameters to applyPairs");return memo[key]=value,memo}function stateChangeStartHandler($transition$){if($transition$.options().notify&&$transition$.valid()&&!$transition$.ignored()){var $injector=$transition$.injector(),$stateEvents=$injector.get("$stateEvents"),$rootScope=$injector.get("$rootScope"),$state=$injector.get("$state"),$urlRouter=$injector.get("$urlRouter"),enabledEvents=$stateEvents.provider.enabled(),toParams=$transition$.params("to"),fromParams=$transition$.params("from");if(enabledEvents.$stateChangeSuccess){var startEvent=$rootScope.$broadcast("$stateChangeStart",$transition$.to(),toParams,$transition$.from(),fromParams,$transition$.options(),$transition$);if(startEvent.defaultPrevented)return enabledEvents.$stateChangeCancel&&$rootScope.$broadcast("$stateChangeCancel",$transition$.to(),toParams,$transition$.from(),fromParams,$transition$.options(),$transition$),null==$state.transition&&$urlRouter.update(),!1;var successOpts={priority:9999};$transition$.onSuccess({},function(){$rootScope.$broadcast("$stateChangeSuccess",$transition$.to(),toParams,$transition$.from(),fromParams,$transition$.options(),$transition$)},successOpts)}enabledEvents.$stateChangeError&&$transition$.promise["catch"](function(error){if(!error||2!==error.type&&3!==error.type){var evt=$rootScope.$broadcast("$stateChangeError",$transition$.to(),toParams,$transition$.from(),fromParams,error,$transition$.options(),$transition$);evt.defaultPrevented||$urlRouter.update()}})}}function stateNotFoundHandler($to$,$from$,injector){function redirectFn(){return $state.target(redirect.to,redirect.toParams,redirect.options)}var $state=injector.get("$state"),$rootScope=injector.get("$rootScope"),$urlRouter=injector.get("$urlRouter"),redirect={to:$to$.identifier(),toParams:$to$.params(),options:$to$.options()},e=$rootScope.$broadcast("$stateNotFound",redirect,$from$.state(),$from$.params());return(e.defaultPrevented||e.retry)&&$urlRouter.update(),e.defaultPrevented?!1:e.retry||$state.get(redirect.to)?e.retry&&isFunction(e.retry.then)?e.retry.then(redirectFn):redirectFn():void 0}function $StateEventsProvider($stateProvider){function assertNotRuntime(){if(runtime)throw new Error("Cannot enable events at runtime (use $stateEventsProvider")}function $get($transitions){return runtime=!0,enabledStateEvents.$stateNotFound&&$stateProvider.onInvalid(stateNotFoundHandler),enabledStateEvents.$stateChangeStart&&$transitions.onBefore({},stateChangeStartHandler,{priority:1e3}),{provider:$StateEventsProvider.prototype.instance}}$StateEventsProvider.prototype.instance=this;var runtime=!1,allEvents=["$stateChangeStart","$stateNotFound","$stateChangeSuccess","$stateChangeError"],enabledStateEvents=allEvents.map(function(e){return[e,!0]}).reduce(applyPairs,{});this.enable=function(){for(var events=[],_i=0;_i<arguments.length;_i++)events[_i]=arguments[_i];assertNotRuntime(),events&&events.length||(events=allEvents),events.forEach(function(event){return enabledStateEvents[event]=!0})},this.disable=function(){for(var events=[],_i=0;_i<arguments.length;_i++)events[_i]=arguments[_i];assertNotRuntime(),events&&events.length||(events=allEvents),events.forEach(function(event){return delete enabledStateEvents[event]})},this.enabled=function(){return enabledStateEvents},this.$get=$get,$get.$inject=["$transitions"]}var isFunction=ng.isFunction,isString=ng.isString;stateNotFoundHandler.$inject=["$to$","$from$","$state","$rootScope","$urlRouter"],$StateEventsProvider.$inject=["$stateProvider"],ng.module("ui.router.state.events",["ui.router.state"]).provider("$stateEvents",$StateEventsProvider).run(["$stateEvents",function(){}])}(),exports.$stateChangeCancel=$stateChangeCancel,exports.$stateChangeError=$stateChangeError,exports.$stateChangeStart=$stateChangeStart,exports.$stateChangeSuccess=$stateChangeSuccess,exports.$stateNotFound=$stateNotFound,Object.defineProperty(exports,"__esModule",{value:!0})});
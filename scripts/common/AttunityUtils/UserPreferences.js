!function(){"use strict";var UserPreferences=function(){var _currentPrefs=null,LAST_MODIFIED="lastModified",options={saveInterval:0,storageKey:"userPreferences",saveCallback:null,getCallback:null},interval=null;this.init=function(opts,onSuccess){ObjectUtils.deepMixIn(options,opts),options.getCallback?options.getCallback(function(data){_currentPrefs=data,onSuccess&&onSuccess()},function(){}):_currentPrefs=amplify.store(options.storageKey)||{},null!=options.saveInterval&&0!=options.saveInterval&&(interval=setInterval(this.save,options.saveInterval))},this.get=function(key){return _currentPrefs?_currentPrefs[key]:(this.init(options),null)},this.set=function(key,value,forceSave){return _currentPrefs?(_currentPrefs[key]=value,_currentPrefs[LAST_MODIFIED]=(new Date).getUTCTime(),void(forceSave&&this.save())):void this.init(options)},this.removePreferencesByKey=function(subkeyToRemove,doSave){(null===doSave||void 0===doSave)&&(doSave=!0);for(var cKeys=Object.keys(_currentPrefs),index=0;index<cKeys.length;index++){var key=cKeys[index];key.indexOf(subkeyToRemove)>-1&&delete _currentPrefs[key]}doSave&&this.save()},this.save=function(onSaveSuccess){options.saveCallback?options.saveCallback(_currentPrefs,onSaveSuccess):amplify.store(options.storageKey,_currentPrefs)}};window.userPreferences=new UserPreferences}(this);
function handleError(err){console.log(err.toString()),this.emit("end")}var fs=require("fs"),connect=require("gulp-connect"),gulp=require("gulp"),karma=require("karma").server,concat=require("gulp-concat"),jshint=require("gulp-jshint"),header=require("gulp-header"),rename=require("gulp-rename"),es=require("event-stream"),del=require("del"),uglify=require("gulp-uglify"),minifyHtml=require("gulp-minify-html"),minifyCSS=require("gulp-minify-css"),templateCache=require("gulp-angular-templatecache"),gutil=require("gulp-util"),plumber=require("gulp-plumber"),open=require("gulp-open"),less=require("gulp-less"),order=require("gulp-order"),runSequence=require("run-sequence"),config={pkg:JSON.parse(fs.readFileSync("./package.json")),banner:"/*!\n * <%= pkg.name %>\n * <%= pkg.homepage %>\n * Version: <%= pkg.version %> - <%= timestamp %>\n * License: <%= pkg.license %>\n */\n\n\n"};gulp.task("connect",function(){connect.server({root:".",livereload:!0})}),gulp.task("html",function(){gulp.src(["./demo/*.html",".src/*.html"]).pipe(connect.reload())}),gulp.task("watch",function(){gulp.watch(["./demo/**/*.html"],["html"]),gulp.watch(["./**/*.less"],["styles"]),gulp.watch(["./**/*.js","./**/*.html"],["scripts"])}),gulp.task("clean",function(cb){del(["dist"],cb)}),gulp.task("scripts",function(){function buildTemplates(){return gulp.src("src/**/*.html").pipe(minifyHtml({empty:!0,spare:!0,quotes:!0})).pipe(templateCache({module:"jsonFormatter"}))}function buildDistJS(){return gulp.src(["src/json-formatter.js","src/recursion-helper.js"]).pipe(concat("json-formatter.js")).pipe(plumber({errorHandler:handleError})).pipe(jshint()).pipe(jshint.reporter("jshint-stylish")).pipe(jshint.reporter("fail"))}es.merge(buildDistJS(),buildTemplates()).pipe(plumber({errorHandler:handleError})).pipe(order(["json-formatter.js","json-formatter.html"])).pipe(concat("json-formatter.js")).pipe(header(config.banner,{timestamp:(new Date).toISOString(),pkg:config.pkg})).pipe(gulp.dest("dist")).pipe(rename({suffix:".min"})).pipe(uglify({preserveComments:"some",reservedNames:"Person"})).pipe(gulp.dest("./dist")).pipe(connect.reload())}),gulp.task("styles",function(){return gulp.src("src/json-formatter.less").pipe(less()).pipe(header(config.banner,{timestamp:(new Date).toISOString(),pkg:config.pkg})).pipe(gulp.dest("dist")).pipe(minifyCSS()).pipe(rename({suffix:".min"})).pipe(gulp.dest("dist")).pipe(connect.reload())}),gulp.task("open",function(){gulp.src("./demo/demo.html").pipe(open("",{url:"http://localhost:8080/demo/demo.html"}))}),gulp.task("jshint-test",function(){return gulp.src("./test/**/*.js").pipe(jshint())}),gulp.task("karma",function(done){karma.start({configFile:__dirname+"/karma.conf.js",singleRun:!0},done)}),gulp.task("karma-serve",function(done){karma.start({configFile:__dirname+"/karma.conf.js"},done)}),gulp.task("build",function(cb){runSequence("clean","scripts","styles",cb)}),gulp.task("serve",["build","connect","watch","open"]),gulp.task("default",["build","test"]),gulp.task("test",["build","jshint-test","karma"]),gulp.task("serve-test",["build","watch","jshint-test","karma-serve"]);
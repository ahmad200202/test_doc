!function(amplify){"use strict";function noop(){}function isFunction(obj){return"[object Function]"==={}.toString.call(obj)}function async(fn){var isAsync=!1;return setTimeout(function(){isAsync=!0},1),function(){var that=this,args=arguments;isAsync?fn.apply(that,args):setTimeout(function(){fn.apply(that,args)},1)}}amplify.request=function(resourceId,data,callback){var settings=resourceId||{};"string"==typeof settings&&(isFunction(data)&&(callback=data,data={}),settings={resourceId:resourceId,data:data||{},success:callback});var request={abort:noop},resource=amplify.request.resources[settings.resourceId],success=settings.success||noop,error=settings.error||noop;if(settings.success=async(function(data,status){status=status||"success",amplify.publish("request.success",settings,data,status),amplify.publish("request.complete",settings,data,status),success(data,status)}),settings.error=async(function(data,status){status=status||"error",amplify.publish("request.error",settings,data,status),amplify.publish("request.complete",settings,data,status),error(data,status)}),!resource){if(!settings.resourceId)throw"amplify.request: no resourceId provided";throw"amplify.request: unknown resourceId: "+settings.resourceId}return amplify.publish("request.before",settings)?(amplify.request.resources[settings.resourceId](settings,request),request):void settings.error(null,"abort")},amplify.request.types={},amplify.request.resources={},amplify.request.define=function(resourceId,type,settings){if("string"==typeof type){if(!(type in amplify.request.types))throw"amplify.request.define: unknown type: "+type;settings.resourceId=resourceId,amplify.request.resources[resourceId]=amplify.request.types[type](settings)}else amplify.request.resources[resourceId]=type}}(amplify),function(amplify,$,undefined){"use strict";var xhrProps=["status","statusText","responseText","responseXML","readyState"],rurlData=/\{([^\}]+)\}/g;amplify.request.types.ajax=function(defnSettings){return defnSettings=$.extend({type:"GET"},defnSettings),function(settings,request){var xhr,handleResponse,abort=(defnSettings.url,request.abort),ajaxSettings=$.extend(!0,{},defnSettings,{data:settings.data}),aborted=!1,ampXHR={readyState:0,setRequestHeader:function(name,value){return xhr.setRequestHeader(name,value)},getAllResponseHeaders:function(){return xhr.getAllResponseHeaders()},getResponseHeader:function(key){return xhr.getResponseHeader(key)},overrideMimeType:function(type){return xhr.overrideMimeType(type)},abort:function(){aborted=!0;try{xhr.abort()}catch(e){}handleResponse(null,"abort")},success:function(data,status){settings.success(data,status)},error:function(data,status){settings.error(data,status)}};handleResponse=function(data,status){$.each(xhrProps,function(i,key){try{ampXHR[key]=xhr[key]}catch(e){}}),/OK$/.test(ampXHR.statusText)&&(ampXHR.statusText="success"),data===undefined&&(data=null),aborted&&(status="abort"),/timeout|error|abort/.test(status)?ampXHR.error(data,status):ampXHR.success(data,status),handleResponse=$.noop},amplify.publish("request.ajax.preprocess",defnSettings,settings,ajaxSettings,ampXHR),$.extend(ajaxSettings,{isJSONP:function(){return/jsonp/gi.test(this.dataType)},cacheURL:function(){if(!this.isJSONP())return this.url;var callbackName="callback";this.hasOwnProperty("jsonp")&&(this.jsonp!==!1?callbackName=this.jsonp:this.hasOwnProperty("jsonpCallback")&&(callbackName=this.jsonpCallback));var callbackRegex=new RegExp("&?"+callbackName+"=[^&]*&?","gi");return this.url.replace(callbackRegex,"")},success:function(data,status){handleResponse(data,status)},error:function(_xhr,status){handleResponse(null,status)},beforeSend:function(_xhr,_ajaxSettings){xhr=_xhr,ajaxSettings=_ajaxSettings;var ret=defnSettings.beforeSend?defnSettings.beforeSend.call(this,ampXHR,ajaxSettings):!0;return ret&&amplify.publish("request.before.ajax",defnSettings,settings,ajaxSettings,ampXHR)}}),ajaxSettings.cache&&ajaxSettings.isJSONP()&&$.extend(ajaxSettings,{cache:!0}),$.ajax(ajaxSettings),request.abort=function(){ampXHR.abort(),abort.call(this)}}},amplify.subscribe("request.ajax.preprocess",function(defnSettings,settings,ajaxSettings){var mappedKeys=[],data=ajaxSettings.data;"string"!=typeof data&&(data=$.extend(!0,{},defnSettings.data,data),ajaxSettings.url=ajaxSettings.url.replace(rurlData,function(m,key){return key in data?(mappedKeys.push(key),data[key]):void 0}),$.each(mappedKeys,function(i,key){delete data[key]}),ajaxSettings.data=data)}),amplify.subscribe("request.ajax.preprocess",function(defnSettings,settings,ajaxSettings){var data=ajaxSettings.data,dataMap=defnSettings.dataMap;dataMap&&"string"!=typeof data&&($.isFunction(dataMap)?ajaxSettings.data=dataMap(data):($.each(defnSettings.dataMap,function(orig,replace){orig in data&&(data[replace]=data[orig],delete data[orig])}),ajaxSettings.data=data))});var cache=amplify.request.cache={_key:function(resourceId,url,data){function chunk(){return data.charCodeAt(i++)<<24|data.charCodeAt(i++)<<16|data.charCodeAt(i++)<<8|data.charCodeAt(i++)<<0}data=url+data;for(var length=data.length,i=0,checksum=chunk();length>i;)checksum^=chunk();return"request-"+resourceId+"-"+checksum},_default:function(){var memoryStore={};return function(resource,settings,ajaxSettings,ampXHR){var cacheKey=cache._key(settings.resourceId,ajaxSettings.cacheURL(),ajaxSettings.data),duration=resource.cache;if(cacheKey in memoryStore)return ampXHR.success(memoryStore[cacheKey]),!1;var success=ampXHR.success;ampXHR.success=function(data){memoryStore[cacheKey]=data,"number"==typeof duration&&setTimeout(function(){delete memoryStore[cacheKey]},duration),success.apply(this,arguments)}}}()};amplify.store&&($.each(amplify.store.types,function(type){cache[type]=function(resource,settings,ajaxSettings,ampXHR){var cacheKey=cache._key(settings.resourceId,ajaxSettings.cacheURL(),ajaxSettings.data),cached=amplify.store[type](cacheKey);if(cached)return ajaxSettings.success(cached),!1;var success=ampXHR.success;ampXHR.success=function(data){amplify.store[type](cacheKey,data,{expires:resource.cache.expires}),success.apply(this,arguments)}}}),cache.persist=cache[amplify.store.type]),amplify.subscribe("request.before.ajax",function(resource){var cacheType=resource.cache;return cacheType?(cacheType=cacheType.type||cacheType,cache[cacheType in cache?cacheType:"_default"].apply(this,arguments)):void 0}),amplify.request.decoders={jsend:function(data,status,ampXHR,success,error){"success"===data.status?success(data.data):"fail"===data.status?error(data.data,"fail"):"error"===data.status?(delete data.status,error(data,"error")):error(null,"error")}},amplify.subscribe("request.before.ajax",function(resource,settings,ajaxSettings,ampXHR){function success(data,status){_success(data,status)}function error(data,status){_error(data,status)}var _success=ampXHR.success,_error=ampXHR.error,decoder=$.isFunction(resource.decoder)?resource.decoder:resource.decoder in amplify.request.decoders?amplify.request.decoders[resource.decoder]:amplify.request.decoders._default;decoder&&(ampXHR.success=function(data,status){decoder(data,status,ampXHR,success,error)},ampXHR.error=function(data,status){decoder(data,status,ampXHR,success,error)})})}(amplify,jQuery);
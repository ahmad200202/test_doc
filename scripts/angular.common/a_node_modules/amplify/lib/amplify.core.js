!function(global){{var slice=[].slice,subscriptions={};global.amplify={publish:function(topic){if("string"!=typeof topic)throw new Error("You must provide a valid topic to publish.");var topicSubscriptions,subscription,length,ret,args=slice.call(arguments,1),i=0;if(!subscriptions[topic])return!0;for(topicSubscriptions=subscriptions[topic].slice(),length=topicSubscriptions.length;length>i&&(subscription=topicSubscriptions[i],ret=subscription.callback.apply(subscription.context,args),ret!==!1);i++);return ret!==!1},subscribe:function(topic,context,callback,priority){if("string"!=typeof topic)throw new Error("You must provide a valid topic to create a subscription.");3===arguments.length&&"number"==typeof callback&&(priority=callback,callback=context,context=null),2===arguments.length&&(callback=context,context=null),priority=priority||10;for(var added,topicIndex=0,topics=topic.split(/\s/),topicLength=topics.length;topicLength>topicIndex;topicIndex++){topic=topics[topicIndex],added=!1,subscriptions[topic]||(subscriptions[topic]=[]);for(var i=subscriptions[topic].length-1,subscriptionInfo={callback:callback,context:context,priority:priority};i>=0;i--)if(subscriptions[topic][i].priority<=priority){subscriptions[topic].splice(i+1,0,subscriptionInfo),added=!0;break}added||subscriptions[topic].unshift(subscriptionInfo)}return callback},unsubscribe:function(topic,context,callback){if("string"!=typeof topic)throw new Error("You must provide a valid topic to remove a subscription.");if(2===arguments.length&&(callback=context,context=null),subscriptions[topic])for(var length=subscriptions[topic].length,i=0;length>i;i++)subscriptions[topic][i].callback===callback&&(context&&subscriptions[topic][i].context!==context||(subscriptions[topic].splice(i,1),i--,length--))}}}}(this);
function getNodesBetween(a,b){var between={},nodesBetween=[a,b],get=function(p){return null==between[p.id]&&(p==b?(nodesBetween.push(p),between[p.id]=!0):-1!=p.getParents().map(get).indexOf(!0)?(nodesBetween.push(p),between[p.id]=!0):between[p.id]=!1),between[p.id]};return get(a),nodesBetween}function getEntirePathNodes(center){var visible_parent_map={},visible_child_map={},nodes={},explore_parents=function(node){if(!visible_parent_map[node.id]){visible_parent_map[node.id]={},nodes[node.id]=node;var parents=node.parent_nodes;for(var pid in parents){var parent=parents[pid];if(parent.visible())visible_parent_map[node.id][pid]=!0,explore_parents(parent);else{explore_parents(parent);var grandparents=visible_parent_map[pid];for(var gpid in grandparents)visible_parent_map[node.id][gpid]=!0}}}},explore_children=function(node){if(!visible_child_map[node.id]){visible_child_map[node.id]={},nodes[node.id]=node;var children=node.child_nodes;for(var cid in children){var child=children[cid];if(child.visible())visible_child_map[node.id][cid]=!0,explore_children(child);else{explore_children(child);var grandchildren=visible_child_map[cid];for(var gcid in grandchildren)visible_child_map[node.id][gcid]=!0}}}};return explore_parents(center),explore_children(center),values(nodes)}function getEntirePathLinks(center){var visible_parent_map={},visible_child_map={},nodes={},explore_parents=function(node){if(!visible_parent_map[node.id]){visible_parent_map[node.id]={},nodes[node.id]=node;var parents=node.parent_nodes;for(var pid in parents){var parent=parents[pid];if(parent.visible())visible_parent_map[node.id][pid]=!0,explore_parents(parent);else{explore_parents(parent);var grandparents=visible_parent_map[pid];for(var gpid in grandparents)visible_parent_map[node.id][gpid]=!0}}}},explore_children=function(node){if(!visible_child_map[node.id]){visible_child_map[node.id]={},nodes[node.id]=node;var children=node.child_nodes;for(var cid in children){var child=children[cid];if(child.visible())visible_child_map[node.id][cid]=!0,explore_children(child);else{explore_children(child);var grandchildren=visible_child_map[cid];for(var gcid in grandchildren)visible_child_map[node.id][gcid]=!0}}}};explore_parents(center),explore_children(center);var path=[];for(var targetid in visible_parent_map){var target=nodes[targetid],sourceids=visible_parent_map[targetid];for(var sourceid in sourceids){var source=nodes[sourceid];path.push({source:source,target:target})}}for(var sourceid in visible_child_map){var source=nodes[sourceid],targetids=visible_child_map[sourceid];for(var targetid in targetids){var target=nodes[targetid];path.push({source:source,target:target})}}return path}function values(obj){return Object.keys(obj).map(function(key){return obj[key]})}function flatten(arrays){var flattened=[];return flattened.concat.apply(flattened,arrays)}var Node=function(id){this.id=id,this.never_visible=!1,this.hidden=!1,this.child_nodes={},this.parent_nodes={}};Node.prototype.visible=function(_){return 0==arguments.length?!this.never_visible&&!this.hidden:(this.hidden=!_,this)},Node.prototype.addChild=function(child){this.child_nodes[child.id]=child},Node.prototype.addParent=function(parent){this.parent_nodes[parent.id]=parent},Node.prototype.removeChild=function(child){child.id in this.child_nodes&&delete this.child_nodes[child.id]},Node.prototype.removeParent=function(parent){parent.id in this.parent_nodes&&delete this.parent_nodes[parent.id]},Node.prototype.getParents=function(){return values(this.parent_nodes)},Node.prototype.getChildren=function(){return values(this.child_nodes)},Node.prototype.getVisibleParents=function(){var visible_parent_map={},explore_node=function(node){if(!visible_parent_map[node.id]){visible_parent_map[node.id]={};var parents=node.parent_nodes;for(var pid in parents){var parent=parents[pid];if(parent.visible())visible_parent_map[node.id][pid]=parent;else{explore_node(parent);var grandparents=visible_parent_map[pid];for(var gpid in grandparents)visible_parent_map[node.id][gpid]=grandparents[gpid]}}}};return explore_node(this),values(visible_parent_map[this.id])},Node.prototype.getVisibleChildren=function(){var visible_children_map={},explore_node=function(node){if(!visible_children_map[node.id]){visible_children_map[node.id]={};var children=node.child_nodes;for(var pid in children){var child=children[pid];if(child.visible())visible_children_map[node.id][pid]=child;else{explore_node(child);var grandchildren=visible_children_map[pid];for(var gcid in grandchildren)visible_children_map[node.id][gcid]=grandchildren[gcid]}}}};return explore_node(this),values(visible_children_map[this.id])};var Graph=function(){this.nodelist=[],this.nodes={}};Graph.prototype.addNode=function(node){this.nodelist.push(node),this.nodes[node.id]=node},Graph.prototype.getNode=function(id){return this.nodes[id]},Graph.prototype.getNodes=function(){return this.nodelist},Graph.prototype.getVisibleNodes=function(){return this.nodelist.filter(function(node){return node.visible()})},Graph.prototype.getVisibleLinks=function(){for(var visible_parent_map={},explore_node=function(node){if(!visible_parent_map[node.id]){visible_parent_map[node.id]={};var parents=node.parent_nodes;for(var pid in parents){var parent=parents[pid];if(parent.visible())visible_parent_map[node.id][pid]=!0;else{explore_node(parent);var grandparents=visible_parent_map[pid];for(var gpid in grandparents)visible_parent_map[node.id][gpid]=!0}}}},i=0;i<this.nodelist.length;i++)explore_node(this.nodelist[i]);for(var nodes=this.nodes,ret=[],visible_nodes=this.getVisibleNodes(),i=0;i<visible_nodes.length;i++){var node=visible_nodes[i],parentids=visible_parent_map[node.id];Object.keys(parentids).forEach(function(pid){ret.push({source:nodes[pid],target:node})})}return ret};
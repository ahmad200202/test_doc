!function(angular){"use strict";var attGlobalMessages=angular.module("attGlobalMessages",[]);attGlobalMessages.factory("GlobalMessagesService",["$injector","$rootScope","$timeout",function($injector,$rootScope,$timeout){var modalService,$compile,dockedErrorCompileInterval=null,dockedErrorFadeOutInterval=null,GlobalMessagesService={data:{show:!1,mode:consts.errorModes.error,fade:!1,showMessageFor:300,errorMessage:"",moreDetailsErrors:[],maxMessageLength:70},getIconClassByMode:function(mode){switch(mode){case consts.errorModes.warning:return"globalMsgWarning";case consts.errorModes.error:return"globalMsgError";case consts.errorModes.success:return"globalMsgSuccess";case consts.errorModes.info:return"globalMsgInfo"}},setMessages:function(show,mode,fade,message,moreDetailsMessage,appendToBody,showAsPopup,DOMElementSelector,showMessageFor,canBeClosed,moreDetailsPopupCallBack,moreDetailsOtherLabel,headerText){if(null!=moreDetailsMessage||null!=message)if(headerText||(headerText="Error"),angular.isUndefined(canBeClosed)&&(canBeClosed=!0),mode=mode||consts.errorModes.error,showAsPopup){var messages=[message];moreDetailsMessage&&messages.push(moreDetailsMessage),modalService=modalService||$injector.get("modalService"),modalService&&modalService.showModal({model:messages,headerText:headerText,contentTemplate:"scripts/angular.common/attGlobalMessages/moreDetailsView.html",resizable:!0,actionButtonText:"Close",closeButtonText:""},{windowClass:"moreDetailsPopup"})}else 0==ObjectUtils.isKind(moreDetailsMessage,"Array")&&null!=moreDetailsMessage&&"null"!=moreDetailsMessage.toLowerCase()&&""!=moreDetailsMessage&&(moreDetailsMessage=[moreDetailsMessage]),GlobalMessagesService.appendDirectiveToDOM(show,mode,fade,message,moreDetailsMessage,appendToBody,DOMElementSelector,showMessageFor,canBeClosed,moreDetailsPopupCallBack,moreDetailsOtherLabel),GlobalMessagesService.setData(show,mode,fade,message,moreDetailsMessage,showMessageFor,moreDetailsPopupCallBack)},clearDockedErrorFadeOutInterval:function(){null!=dockedErrorFadeOutInterval&&($timeout.cancel(dockedErrorFadeOutInterval),dockedErrorFadeOutInterval=null)},appendDirectiveToDOM:function(show,mode,fade,errorMessage,moreDetailsErrors,appendToBody,DOMElementSelector,showMessageFor,canBeClosed,moreDetailsPopupCallBack,moreDetailsOtherLabel){modalService=modalService||$injector.get("modalService"),$compile=$compile||$injector.get("$compile");var errScope=$rootScope.$new();errScope.show=show,errScope.mode=mode,errScope.fade=fade,errScope.message=errorMessage,errScope.moreDetailsErrors=Array.isArray(moreDetailsErrors)&&moreDetailsErrors.length>0?moreDetailsErrors:null,errScope.moreDetailsPopupCallBack=moreDetailsPopupCallBack,errScope.moreDetailsOtherLabel=moreDetailsOtherLabel,errScope.DomElementSelector=DOMElementSelector,errScope.canBeClosed=canBeClosed;var activeModal=modalService.getActiveModalElement();if(!activeModal||!activeModal.hasClass("confirmDialogClass")){var globalMsgContainer;null==activeModal||appendToBody?globalMsgContainer=$(".mainMessageWrapper"):(activeModal=$(activeModal),globalMsgContainer=activeModal.find(".modal-body"));var dockedErrorHtml="<docked-error></docked-error>";if(errScope.iconClass=GlobalMessagesService.getIconClassByMode(errScope.mode),angular.isDefined(DOMElementSelector)){var DOMElement=globalMsgContainer.find(DOMElementSelector);angular.isDefined(DOMElement)&&DOMElement.length>0&&(globalMsgContainer=DOMElement),DOMElement=null}if(null!=dockedErrorCompileInterval&&($timeout.cancel(dockedErrorCompileInterval),dockedErrorCompileInterval=null),null!=dockedErrorFadeOutInterval&&($timeout.cancel(dockedErrorFadeOutInterval),dockedErrorFadeOutInterval=null),globalMsgContainer.stop(),globalMsgContainer.find(".dockedErrorWrapper").length>0&&globalMsgContainer.find(".dockedErrorWrapper").stop(),globalMsgContainer.find(".floatingErrorWrapper").remove(),globalMsgContainer.find(".dockedErrorWrapper").remove(),globalMsgContainer.length>0&&(mode==consts.errorModes.error||mode==consts.errorModes.warning)?(globalMsgContainer.addClass("dockedErrExpanded"),dockedErrorCompileInterval=$timeout(function(){globalMsgContainer.prepend($compile(dockedErrorHtml)(errScope)),$timeout.cancel(dockedErrorCompileInterval),dockedErrorCompileInterval=null},50)):globalMsgContainer.prepend($compile(dockedErrorHtml)(errScope)),fade){var fadeForMiliSec=null==showMessageFor?300:showMessageFor;dockedErrorFadeOutInterval=$timeout(function(){var errElementInDom=globalMsgContainer.find(".dockedErrorWrapper");errElementInDom.css("pointer-events","none"),errElementInDom.stop().fadeOut(4500,function(){null!=dockedErrorFadeOutInterval&&globalMsgContainer.find(".dockedErrorWrapper").length>0&&errElementInDom.length>0&&globalMsgContainer.find(".dockedErrorWrapper")[0].$$hashKey==errElementInDom[0].$$hashKey&&GlobalMessagesService.removeDirectiveFromDom(),$timeout.cancel(dockedErrorFadeOutInterval),dockedErrorFadeOutInterval=null})},fadeForMiliSec)}}},removeDirectiveFromDom:function(){modalService=modalService||$injector.get("modalService");var activeModal=modalService.getActiveModalElement();null!=activeModal&&(activeModal.find(".modal-body").find(".floatingErrorWrapper").remove(),activeModal.find(".modal-body").find(".dockedErrorWrapper").remove());var $mainMessageWrapper=$(".mainMessageWrapper");$mainMessageWrapper.find(".dockedErrorWrapper").remove()},setData:function(show,mode,fade,errorMessage,moreDetailsErrors,showMessageFor,moreDetailsPopupCallBack){GlobalMessagesService.data.show=show,GlobalMessagesService.data.mode=mode,GlobalMessagesService.data.fade=fade,GlobalMessagesService.data.showMessageFor=null==showMessageFor?300:showMessageFor,GlobalMessagesService.data.errorMessage=errorMessage,GlobalMessagesService.data.moreDetailsErrors=moreDetailsErrors,GlobalMessagesService.data.moreDetailsPopupCallBack=moreDetailsPopupCallBack},clearData:function(){GlobalMessagesService.data.show=!1,GlobalMessagesService.data.mode=consts.errorModes.error,GlobalMessagesService.data.fade=!1,GlobalMessagesService.data.showMessageFor=300,GlobalMessagesService.data.errorMessage="",GlobalMessagesService.data.moreDetailsErrors=[],GlobalMessagesService.data.moreDetailsPopupCallBack=null,GlobalMessagesService.removeDirectiveFromDom()},hideDockedError:function(obj){var selector="."+(ObjectUtils.isEmpty(obj)?"dockedErrorWrapper":obj.dockedClass)+':not([style*="display: none"])';obj&&obj.DomElementSelector&&(selector=obj.DomElementSelector+" "+selector);var parentElement=$(selector).parent();parentElement.length>0&&parentElement.last().removeClass("dockedErrExpanded");var $mainMessageWrapper=$(".mainMessageWrapper");$mainMessageWrapper.length>0&&($mainMessageWrapper.last().removeClass("expandedInnerError"),$mainMessageWrapper.last().children(".floatingErrorWrapper").hide()),$(selector).length>1?$(selector).last().removeClass("dockedErrExpanded").stop(!0,!0).hide():$(selector).removeClass("dockedErrExpanded").stop(!0,!0).hide(),angular.isDefined(obj)&&(obj.show=!1)},hideAllErrors:function(){var selector=".dockedErrorWrapper",parentElement=$(selector).parent();parentElement.length>0&&parentElement.removeClass("dockedErrExpanded");var $mainMessageWrapper=$(".mainMessageWrapper");$mainMessageWrapper.length>0&&($mainMessageWrapper.removeClass("expandedInnerError"),$mainMessageWrapper.children(".floatingErrorWrapper").hide()),$(selector).removeClass("dockedErrExpanded").stop(!0,!0).hide()},showErrorMessage:function(message,detailedMessage,statusCode){angular.isDefined(statusCode)&&statusCode.length>0&&(detailedMessage+="(statusCode: "+statusCode+")"),GlobalMessagesService.setMessages(!0,consts.errorModes.error,!1,message,detailedMessage)},showWarningMessageWithOpenPopupCallbackAndText:function(message,moreDetailsPopupCallBack,moreDetailsOtherLabel){var mode=consts.errorModes.warning;GlobalMessagesService.setMessages(!0,mode,!1,message,null,null,null,null,null,!0,moreDetailsPopupCallBack,moreDetailsOtherLabel)}};return GlobalMessagesService}]),attGlobalMessages.directive("dockedError",["modalService","GlobalMessagesService","$timeout","locale",function(ModalService,GlobalMessagesService,$timeout,locale){return{restrict:"E",replace:!0,templateUrl:"scripts/angular.common/attGlobalMessages/globalErrorMessageTemplate.html",link:function(scope){function isMoreDetailsExists(){var isMoreDetailsArray=1==ObjectUtils.isKind(scope.moreDetailsErrors,ArrayType);return isMoreDetailsArray&&scope.moreDetailsErrors.length>0||null!=scope.moreDetailsOtherLabel?!0:!1}function manageMoreDetailsShowHide(){null!=manageMoreDetailsShowHideTimeout&&($timeout.cancel(manageMoreDetailsShowHideTimeout),manageMoreDetailsShowHideTimeout=null),manageMoreDetailsShowHideTimeout=$timeout(function(){var isExist=isMoreDetailsExists();scope.isVisibleBtnShowMore!=isExist&&(scope.isVisibleBtnShowMore=isExist)})}var ArrayType="Array";scope.isVisibleBtnShowMore=!1,scope.message&&scope.message.indexOf(consts.GlobalMessagesNewRowDelimeter)>=0&&(scope.message=scope.message.split(consts.GlobalMessagesNewRowDelimeter),scope.messageIsArray=!0);var manageMoreDetailsShowHideTimeout=null;manageMoreDetailsShowHide();var dockedErrorTimeout=null;dockedErrorTimeout=$timeout(function(){addResizeListener($(".dockedErrorWrapper")[0],function(){manageMoreDetailsShowHide()})}),scope.dockedClass="dockedErrorWrapper",scope.moreDetailsLabel=null!=scope.moreDetailsOtherLabel?scope.moreDetailsOtherLabel:locale.getString("common.base.MoreDetailsMessage"),scope.hideError=function(){GlobalMessagesService.hideDockedError(this)},scope.showMoreDetails=function(){if(null!=scope.moreDetailsPopupCallBack)return void scope.moreDetailsPopupCallBack();var addedWindowClass=" ";ObjectUtils.isKind(scope.moreDetailsErrors,"Array")||(scope.moreDetailsErrors=[]),ObjectUtils.isKind(scope.message,"Array")&&(addedWindowClass+="FirstRowNoHeader"),ModalService.showModal({model:scope.moreDetailsErrors,headerText:"More Details",contentTemplate:"scripts/angular.common/attGlobalMessages/moreDetailsView.html",resizable:!0,hasOk:!1,closeButtonText:"Close",onBeforeClose:function(vm,fnc){fnc(),ArrayUtils.removeElementFromArray(scope.moreDetailsErrors,scope.message)}},{windowClass:"moreDetailsPopup"+addedWindowClass})},scope.$on("$destroy",function(){null!=manageMoreDetailsShowHideTimeout&&($timeout.cancel(manageMoreDetailsShowHideTimeout),manageMoreDetailsShowHideTimeout=null),$timeout.cancel(dockedErrorTimeout),dockedErrorTimeout=null})}}}]),attGlobalMessages.directive("floatingError",["modalService","GlobalMessagesService",function(modalService,GlobalMessagesService){return{restrict:"E",replace:!0,templateUrl:"scripts/angular.common/attGlobalMessages/globalErrorMessageTemplate.html",link:function(scope,element){element.draggable({start:function(){},stop:function(){}}),scope.dockedClass="floatingErrorWrapper",scope.hideError=function(){this.show=!1,GlobalMessagesService.hideDockedError(this)},scope.moreDetailsLabel=null!=scope.moreDetailsOtherLabel?scope.moreDetailsOtherLabel:locale.getString("common.base.MoreDetailsMessage"),scope.showMoreDetails=function(){return null!=scope.moreDetailsPopupCallBack?void scope.moreDetailsPopupCallBack():void modalService.showModal({model:scope.moreDetailsErrors,headerText:"More Details",contentTemplate:"scripts/angular.common/attGlobalMessages/moreDetailsView.html",resizable:!0,hasOk:!1,showFooter:!1,onBeforeClose:function(vm,fnc){fnc()}},{windowClass:"moreDetailsPopup"})}}}}])}(angular);
!function(angular){"use strict";var module=angular.module("attTabSwapper",[]);module.directive("attTabSwapper",["UserPreferencesService",function(UserPreferencesService){return{scope:{selectedTabIndex:"=?",topBorder:"=?",tabCount:"=?",cssClass:"@",userPersistenceContext:"&",useUserPreferencesService:"=?"},restrict:"AE",transclude:!0,template:'<div id="tabSwapper" class="attTabSwapperStyle {{cssClass}}" ng-class="{topBorder:topBorder}"><ul class="tabHeadersList"><li ng-click="onTabClick($index,$event)" ng-class="{\'active\' : tab.isCurrentTab == true, \'disabled\' : tab.disabled}" ng-repeat="tab in tabs" title="{{tab.tabTitle | i18n}}" class="{{tab.tabCss}}"><div><div class="tabIndication" ng-class="getTabClass($index)"></div><a><span class="ellipsisStyle" >{{tab.tabTitle | i18n}}<span><div class="tabSwapperIncludeHeader"><div ng-include="tab.headerTemplate" class="ng-scope"></div></div></a></div><div class="errorIndicator">*</div></li></ul></div><div class="attTabsContent" ng-transclude></div>',controller:["$scope",function($scope){$scope.tabs=[],$scope.tabCount=0,this.addTab=function(tabScope){$scope.tabs.push(tabScope),$scope.tabs.sort(function(t1,t2){return null!=t1.sortIndex&&null!=t2.sortIndex?t1.sortIndex>t2.sortIndex:!1}),$scope.tabCount++},this.removeTab=function(tabScope){$scope.tabs.splice($scope.tabs.indexOf(tabScope),1),$scope.tabCount--}}],compile:function(element){return function(scope){function selectTab(tab_index,$event){if(!scope.useShowHide){for(var children=element.find(".CurrentTabHolder").children(),i=0;i<children.length;i++){var chiSc=null,angularEl=angular.element(children[i]);angularEl.scope&&(chiSc=angularEl.scope()),chiSc&&chiSc.$destroy&&chiSc.$destroy()}children=null}if(0!=scope.tabs.length&&scope.tabs[tab_index]&&(ArrayUtils.each(scope.tabs,function(tab){tab.isCurrentTab=!1}),scope.tabs[tab_index].isCurrentTab=!0,angular.isFunction(scope.tabs[tab_index].clickTabFunction)&&scope.tabs[tab_index].clickTabFunction({$event:$event,tabData:scope.tabs[tab_index].tabData}),0!=scope.useUserPreferencesService)){var tabSwapperID=$(element).attr("id");if(angular.isDefined(tabSwapperID)){var preferencesKey=UserPreferencesService.getKey({type:elementType,id:$(element).attr("id")});UserPreferencesService.setValueByKey(preferencesKey,tab_index)}}}scope.useShowHide="true"==element.attr("use-show-hide");var elementType="tabSwapper";0==element.find("att-tab").length&&(scope.addWatcher=!0),scope.onTabClick=function($index){scope.selectedTabIndex=$index},scope.getTabClass=function(index){return scope.tabs[index]&&scope.tabs[index].getTabClassFunction()?scope.tabs[index].getTabClassFunction():void 0};var tabSwapperID=$(element).attr("id"),userPersistenceVal=null;if(0!=scope.useUserPreferencesService&&angular.isDefined(tabSwapperID)){var preferencesKey=UserPreferencesService.getKey({type:elementType,id:$(element).attr("id")});userPersistenceVal=UserPreferencesService.getValueByKey(preferencesKey)}null==userPersistenceVal?scope.tabs.length>0&&selectTab(null!=scope.selectedTabIndex&&scope.tabs.length>scope.selectedTabIndex?scope.selectedTabIndex:0):setTimeout(function(){selectTab(userPersistenceVal)}),scope.addWatcher&&scope.$watch("tabCount",function(newVal,oldVal){null!=newVal&&newVal!=oldVal&&selectTab(scope.selectedTabIndex)}),scope.$watch("selectedTabIndex",function(newVal,oldVal){null!=newVal&&newVal!=oldVal&&selectTab(scope.selectedTabIndex)})}}}}]),module.directive("attTab",function(){return{restrict:"E",require:"^attTabSwapper",transclude:!0,scope:{tabTitle:"@",tabId:"@",sortIndex:"@",clickTabFunction:"&",tabData:"=?",headerTemplate:"@",tabCss:"@",disabled:"=",getTabClassFunction:"&"},controller:["$scope",function(){}],template:function(elem){var template="<div style=' height: 100%;max-height: 100%;float: left;width: 100%;' ng-if=\"isCurrentTab\" ng-transclude class='CurrentTabHolder'></div>";return"true"==elem.parents("att-tab-swapper").attr("use-show-hide")&&(template="<div style='height: 100%' ng-show=\"isCurrentTab\" ng-transclude></div>"),template},compile:function(){return function(scope,elemnt,attrs,attTabSwapperCtrl){attTabSwapperCtrl.addTab(scope),scope.$on("$destroy",function(){attTabSwapperCtrl.removeTab(scope)})}}}})}(angular);
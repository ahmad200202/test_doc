!function(angular){"use strict";function debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func.apply(context,args)}}function _getScale(sizeCss){return parseInt(sizeCss.replace(/px|%/,""),10)}function guid(){function s4(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()}function getColumnData(columnScope){return{displayName:columnScope.displayName,modelProp:columnScope.modelProp,cssClass:columnScope.cssClass,headerType:columnScope.headerType,headerGroup:columnScope.headerGroup,headerHandler:columnScope.headerHandler,headerDisabled:columnScope.headerDisabled,hidden:columnScope.hidden,ordinal:columnScope.ordinal,specialHidden:columnScope.specialHidden,isMandatory:columnScope.isMandatory,guid:columnScope.guid,headerTooltip:columnScope.headerTooltip?columnScope.headerTooltip:columnScope.displayName,hiddenForCSFn:function(val){return 0==arguments.length?!this.hidden:void(this.hidden=!val)}}}function gridExportName(file_name,grid_id,extension,addTimestamp){var ret="";if(ret=null!=file_name&&""!=file_name?file_name:null!=grid_id&&""!=grid_id?grid_id:"Grid_"+guid(),addTimestamp){var now=new Date,mon=now.getMonth()+1,day=now.getDate(),hrs=now.getHours(),min=now.getMinutes(),sec=now.getSeconds(),mil=""+now.getMilliseconds();ret+="_"+now.getFullYear()+"-"+((mon>9?"":"0")+mon)+"-"+((day>9?"":"0")+day)+"_"+((hrs>9?"":"0")+hrs)+"."+((min>9?"":"0")+min)+"."+((sec>9?"":"0")+sec)+"."+mil}return(ret+extension).replaceAll(" ","_")}function createGridDataForCSV(columns,data,exportHeaderGroups){var displayedColumns=ArrayUtils.filter(columns,function(colItem){return 0==colItem.hidden});ArrayUtils.sort(displayedColumns,function(item1,item2){return item1.ordinal-item2.ordinal});for(var mainArr=[],columnsArr=[],headerGroupsArr=[],hasGroupHeaders=!1,i=0;i<displayedColumns.length;i++){var headerStr=displayedColumns[i].exportHeader;if(ObjectUtils.isEmpty(headerStr)&&(headerStr=displayedColumns[i].displayName),columnsArr.push(headerStr),exportHeaderGroups){var group=displayedColumns[i].headerGroup;group&&!ObjectUtils.isEmpty(group)?(hasGroupHeaders=!0,headerGroupsArr.push(group)):headerGroupsArr.push("")}}hasGroupHeaders&&mainArr.push(headerGroupsArr),mainArr.push(columnsArr);for(var i=0;i<data.length;i++){for(var dtRow=data[i],rowArr=[],j=0;j<displayedColumns.length;j++){var cellVal="N/A";displayedColumns[j].exportFn?cellVal=displayedColumns[j].exportFn(dtRow,displayedColumns[j].modelProp):null!=displayedColumns[j].modelProp&&(cellVal=ObjectUtils.get(dtRow,displayedColumns[j].modelProp),null==cellVal&&(cellVal="N/A")),rowArr.push(cellVal)}mainArr.push(rowArr)}return mainArr}function createGridHtmlString(columns,data){for(var tableStart="<table>",tableEnd="</table>",headStart="<thead>",headEnd="</thead>",bodyStart="<body>",bodyEnd="</body>",trStart="<tr>",trEnd="</tr>",thStart="<th>",thEnd="</th>",tdStart="<td>",tdEnd="</td>",tableHtml='<div class="MainContent">'+tableStart+headStart,i=0;i<columns.length;i++)columns[i].hidden||(tableHtml+=thStart+columns[i].displayName+thEnd);tableHtml+=headEnd,tableHtml+=bodyStart;for(var i=0;i<data.length;i++){var dtRow=data[i];tableHtml+=trStart;for(var j=0;j<columns.length;j++)if(!columns[j].hidden){var cellVal="N/A";columns[j].exportFn?cellVal=columns[j].exportFn(dtRow,columns[j].modelProp):null!=columns[j].modelProp&&(cellVal=ObjectUtils.get(dtRow,columns[j].modelProp),null==cellVal&&(cellVal="N/A")),tableHtml+=tdStart+cellVal+tdEnd}tableHtml+=trEnd}return tableHtml+=bodyEnd,tableHtml+=tableEnd,tableHtml+="</div>"}function createGridStyleString(gridWidth){var cssStr="<style>";return cssStr+=" td{padding-left: 5px;padding-top: 4px;border-bottom: 1px dotted #9F9F9F;border-right: 1px dotted #9F9F9F;border-top: none;} th{border-left: 1px solid #ddd;padding-right: 11px;padding: 0 8px;background:rgba(90, 87, 87, 0.52);}",cssStr+="td:first-child{border-left: 1px dotted #9F9F9F}",cssStr+="table{width:100%;table-layout:fixed;}",cssStr+=" .MainContent{margin: 0 auto;width:"+gridWidth+"px}",cssStr+="</style>"}function isNumber(value){return"number"==typeof value}function isString(value){return"string"==typeof value}function _clearTextSelection(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var sel=window.getSelection();sel.removeAllRanges()}}function Resizer(elem,onResizeEndFn,options){this.options={columnsWidth:null},this.clickedElement=null,this.mouseDown=null,this.init=function(options,elem){return this._options=$.extend({},this.options,options),this.elem=elem,this.$elem=$(elem),this._build(),this},this.IsPositionOnBorder=function(element,left){var IsOnBorder=!1,width=$(element).width(),position=$(element).offset(),eLeft=position.left;return(Math.abs(eLeft-left)<=2||Math.abs(eLeft+width-left)<=2)&&(IsOnBorder=!0),IsOnBorder},this.setWidthsArray=function(){for(var columnsWidth=this._options.columnsWidth,table=this.$elem,tds=table.find("thead th"),i=0;i<tds.length;i++)columnsWidth[i]=$(tds[i]).width()},this.disableSelection=function(element){return $(element).addClass("noselect")},this.enableSelection=function(element){return $(element).removeClass("noselect")},this.setColumnsWidth=function(){var _I=this;if(_I.setEvents(),null!=_I._options.columnsWidth)for(var thead=this.$elem.find("thead"),tds=thead.find("th"),i=0;i<tds.length;i++)null!=_I._options.columnsWidth[i]&&$(tds[i]).width(_I._options.columnsWidth[i])},this.checkPosition=function(element,mousePosition){var _I=this;_I.IsPositionOnBorder(element,mousePosition)?_I.$elem.addClass("Resizer"):_I.mouseDown||_I.$elem.removeClass("Resizer")},this.setEvents=function(){function doResize(event){if(null!=_I.clickedElement){var pagex=event.pageX,left=$(_I.clickedElement).offset().left,maxWidth=($(_I.clickedElement).width(),_I.getCSSPropValue(_I.clickedElement,"max-width")),minWidth=_I.getCSSPropValue(_I.clickedElement,"min-width"),width=pagex-left,minCellWidth=40;width=Math.max(_I.limitLeft-left,width),width=Math.min(width,_I.limitRight-_I.limitLeft),width=Math.max(minWidth,width),width=Math.min(width,maxWidth);var prevWidth=$(_I.clickedElement).width(),nextElementsCollection=$(_I.clickedElement).nextAll(),delta=width-prevWidth,nextElementsWeight=0;nextElementsCollection.each(function(i,thEl){var $thEl=$(thEl),thGuid=$thEl.attr("guid");nextElementsWeight+=_I.realStateMap[thGuid].percentage});var elsArr={};nextElementsCollection.each(function(i,thEl){var $thEl=$(thEl),thGuid=$thEl.attr("guid"),thWidth=parseFloat($thEl.width())-_I.realStateMap[thGuid].percentage*parseFloat(delta)/nextElementsWeight;minCellWidth>thWidth&&(delta+=minCellWidth-thWidth,thWidth=minCellWidth),elsArr[thGuid]=calcPercent(_I.tableWidth,thWidth)});var p=calcPercent(_I.tableWidth,width);$(_I.clickedElement).css("width",p+"%"),ObjectUtils.forOwn(elsArr,function(key,val){_I.$elem.find('th[guid="'+key+'"]').css("width",val+"%")})}}function calcPercent(tableWidth,width){return width/tableWidth*100}function mouseupFn(event){if(null!=_I.clickedElement){event.stopPropagation(),event.preventDefault(),_I.$elem.removeAttr("draggable"),$("body").removeAttr("draggable"),_I.mouseDown=!1,_I.$elem.removeClass("Resizer"),doResize(event);{$(_I.clickedElement).parent("tr").children().index($(_I.clickedElement))}$(".CorsurPos").remove(),onResizeEndFn&&onResizeEndFn()}_I.clickedElement=null,_I.$elem.removeClass("noselect"),_I.enableSelection($("body")),$(document).off("mouseup",mouseupFn)}var _I=this,thead=this.$elem.find("thead");thead.find(".th-inner").off("mouseleave").on("mouseleave",function(){_I.$elem.removeClass("Resizer")}),thead.find(".th-inner").off("mousemove").on("mousemove",function(event){if(_I.checkPosition($(this).parent(),event.pageX),_I.mouseDown){event.stopPropagation(),event.preventDefault();var height=_I.$elem.find(".scrollableContainer2").height()+_I.$elem.find(".headerSpacer").height()+_I.$elem.find(".headerSpacer1").height(),line=$(".CorsurPos"),position=_I.$elem.offset();line.height(0),line.css({top:position.top,height:height}),event.pageX>_I.limitLeft&&event.pageX<_I.limitRight&&line.css({left:event.pageX})}}),thead.find(".th-inner").off("mousedown").on("mousedown",function(event){if(_I.IsPositionOnBorder($(this).parent(),event.pageX)&&(event.stopPropagation(),event.preventDefault(),_I.clickedElementFixed=!1,null==$(this).parent().attr("colspan"))){var parent=$("body");_I.limitRight=9999,_I.limitLeft=0,_I.$elem.attr("draggable","false"),_I.$elem.prop("draggable",!1),parent.attr("draggable","false"),parent.prop("draggable",!1),$(document).on("mouseup",mouseupFn),_I.mouseDown=!0;var index=$($(this).parent()).index();_I.clickedElement=$(this).parent(),_I.clickedElementFixed=!0,_I.elemBrother=$($($(this).parent()).parent().children()[index+1]),index>0&&Math.abs(event.pageX-$(this).offset().left)<=2&&(_I.elemBrother=$($($(this).parent()).parent().children()[index]),_I.clickedElement=$($($(this).parent()).parent().children()[index-1]),_I.clickedElementFixed=!1),_I.limitLeft=_I.clickedElement.offset().left+30,_I.limitRight=_I.getCSSPropValue(_I.clickedElement,"max-width")+_I.limitLeft;{thead.find("th")}_I.disableSelection($("body")),_I.tableWidth=_I.$elem.find(".scrollArea .tableLogicalContainer").width(),_I.realStateMap=options.getHeadersRealStateMap(),parent.append('<div class="CorsurPos"></div>')}})},this.getCSSPropValue=function(elem,prop){var res=10,str=elem.css(prop);return"max-width"==prop&&(res=1500),null!=str&&"none"!=str&&(res=parseInt(str.replace("px",""))),res},this._build=function(){var _I=this;_I._options.columnsWidth=[],_I.mouseDown=!1,_I.setEvents()},this.destroy=function(){},this.init(options,elem)}function doSearch(parentNode,text){if(window.find&&window.getSelection){document.designMode="on";var sel=window.getSelection();for(sel.collapse(parentNode,0);window.find(text);)document.execCommand("HiliteColor",!1,"yellow"),sel.collapseToEnd();document.designMode="off"}else if(parentNode.createTextRange)for(var textRange=parentNode.createTextRange();textRange.findText(text);)textRange.execCommand("BackColor",!1,"yellow"),textRange.collapse(!1)}window.attGridConfig={useNgRepeat:!1,headerCtxMenuActions:{sorting:!0,defaultSorting:!1,freezeColumn:!1,quickColumnSelection:!1,exportToCSV:!0,exportToTSV:!1,exportToHTML:!1,exportGroupHeaders:!1,exportFileNameAddTimestamp:!0,columnSettings:!0,hideColumn:!0,valuesFilter:!1},exportFormats:{CSV:{type:"CSV",displayName:"Export To CSV"},TSV:{type:"TSV",displayName:"Export To TSV"},HTML:{type:"HTML",displayName:"Export To HTML"}},saveUserPreferencesOnSet:!1,defaultEmptyResultMessage:"We couldn't find what you were looking for",isImmutableSource:!1};var SelectionPolicyEnum={byIndex:1,byId:2};angular.module("attGrid",["attGridServices","attGridDirectives","keyEvents"]);var gridServices=angular.module("attGridServices",[]),gridDirectives=angular.module("attGridDirectives",[]);String.format||(String.format=function(format){var args=Array.prototype.slice.call(arguments,1);return format.replace(/{(\d+)}/g,function(match,number){return"undefined"!=typeof args[number]?args[number]:match})});var lastTouchedGrid="";gridDirectives.directive("attGrid",["$compile","$timeout","$filter","$q","keyEvents","$rootScope",function($compile,$timeout,$filter,$q,keyEvents,$rootScope){return{restrict:"AE",replace:!0,scope:{data:"=",dynamicColumns:"=",api:"=?",filter:"=?",groupByProp:"=?",scrollEnable:"=?",paging:"=?",itemsPerPageGetter:"&itemsPerPage",enableSelection:"=?",useVirtualScroll:"=?",fixedHeader:"=?",multipleSelection:"=?",showHeader:"=?",cssClass:"@",identifier:"@",gridId:"@",isTree:"@",showExpandButton:"=?",minWidth:"=?",resizable:"=?",featurePack:"@",orderPredicate:"@",columnsOrdering:"=?",enableSorting:"=?",columnsInSearch:"&",configObjGetter:"&config",rowTooltipFn:"&",exportFnGetter:"&exportFn",exportFileName:"@"},priority:0,terminal:!0,template:function(elem,attrs){var replacer="",customFilters="",selectionPolicy=SelectionPolicyEnum.byIndex;null!=attrs.identifier&&(replacer="track by rowData."+attrs.identifier,"$index"==attrs.identifier&&(replacer="track by $index"),window.attGridConfig.useNgRepeat&&"true"!=attrs.useSly||(replacer=""),selectionPolicy=SelectionPolicyEnum.byId);var activeClassHtml="selection[$index+limitBegin]";selectionPolicy==SelectionPolicyEnum.byId&&"$index"!=attrs.identifier&&(activeClassHtml="selection[rowData."+attrs.identifier+"]"),null!=attrs.customFilter&&""!=attrs.customFilter&&(customFilters=attrs.customFilter);var rowTooltipHandle="";null!=attrs.rowTooltipFn&&(rowTooltipHandle="att-custom-tooltip delegate-event-selector='tr' show-if='shouldShowRowTip'");var emptyResultMessage=attGridConfig.defaultEmptyResultMessage;null!=attrs.emptyResultMessage&&(emptyResultMessage=attrs.emptyResultMessage);var template=String.format(gridBasicTemplate2,String.format(rowsRepeaterTemplate,replacer,activeClassHtml),rowTooltipHandle,emptyResultMessage);if((window.attGridConfig.useNgRepeat||"false"==attrs.useSly)&&(template=String.format(gridBasicTemplate2,String.format(ngRowsRepeaterTemplate,replacer,customFilters,activeClassHtml),rowTooltipHandle,emptyResultMessage)),"true"==attrs.allowGrouping)template=String.format(gridBasicTemplate2,String.format(groupRowsRepeater,replacer,activeClassHtml),rowTooltipHandle,emptyResultMessage);else if("true"==attrs.expandable)template=String.format(gridBasicTemplate2,String.format(rowsExpandableRepeaterTemplate,replacer,activeClassHtml),rowTooltipHandle,emptyResultMessage);else if("true"==attrs.isTree){var childrenProp="children",showPlusMinusHtml="rowData.{0}!=null && rowData.{0}.length>0";null!=attrs.childrenProp&&(childrenProp=attrs.childrenProp),showPlusMinusHtml=String.format(showPlusMinusHtml,childrenProp),null!=attrs.childrenCountProp&&(showPlusMinusHtml=String.format("rowData.{0} > 0",attrs.childrenCountProp)),template=String.format(gridBasicTemplate2,String.format(rowsHirercalRepeaterTemplate,replacer,childrenProp,showPlusMinusHtml,activeClassHtml),emptyResultMessage)}"true"==attrs.staticMode&&(template=staticTemplate),template=$(template);var columns=elem.find("column");template.find(".columnsDef").append(columns);var ExpandableRow=elem.find("expandable-row");return template.find(".ExpandableRowDef").append(ExpandableRow),template[0].outerHTML},controller:["$scope",function($scope){var gridPersesitancy={set:amplify.store,get:amplify.store,save:angular.noop};window.userPreferences=window.userPreferences||gridPersesitancy,$scope.columns=[],$scope.columnsDict={},$scope.headerGroups=[];var colIndex=0;this.addColumn=function(columnScope){null!=columnScope.headerGroup&&0!=columnScope.headerGroup.length&&($scope.hasHeaderGroups=!0),null!=columnScope.subHeaderDisplayGroups&&0!=columnScope.subHeaderDisplayGroups.length&&($scope.hasVirtualHeaderGroups=!0),columnScope.ordinal=colIndex,colIndex++,$scope.columns.push(columnScope),null!=$scope.columnsDict[columnScope.modelProp]&&null!=$scope.gridId&&console.log($scope.columnsDict[columnScope.modelProp]+" is defined for 2 or more columns, gridID: "+$scope.gridId),$scope.columnsDict[columnScope.modelProp]={sortProp:columnScope.sortProp},$scope.minWidth&&!isNaN(parseInt($scope.minWidth))&&($scope.tableMinWidth+=$scope.minWidth)},this.addExpandableRowTransclution=function(transclution,offset){$scope.$expandableRowTransclude=transclution,$scope.$expandedRows={},$scope.showExpandButton&&offset++,$scope.getOffsetNumber=function(){return new Array(offset)},$scope.toggleExpand=function(row,$index){$scope.identifier?$scope.$expandedRows[row[$scope.identifier]]=!$scope.$expandedRows[row[$scope.identifier]]:$scope.$expandedRows[$index]=!$scope.$expandedRows[$index],$scope.calcTbodyHeightForExpandableGrid()},$scope.isRowExpanded=function(row,$index){return $scope.identifier?$scope.$expandedRows[row[$scope.identifier]]:$scope.$expandedRows[$index]}}}],compile:function(element,attrs,transclude){var _this=this;return element.attr("guid",guid()),function(scope,elem,attr){function is(collection,dataItem,index,offset){if(null==collection||null==dataItem||null==index)return!1;var i=0;return ObjectUtils.isKind(index,"String")?"first"==index?i=0:"last"==index&&(i=collection.length-1):ObjectUtils.isKind(index,"Number")&&(i=index),ObjectUtils.isKind(offset,"Number")&&(i+=offset),collection[i]==dataItem}function onDataChange(newVal,oldVal){var lastObj=null;if(scope.config.keepLastItemPosition&&scope.displayedCollection&&scope.displayedCollection.length>0&&(lastObj=scope.displayedCollection[scope.limitBegin]),updateDisplayedCollection(newVal),applySortingFilter(),scope._setDisplayedDataLength(),newVal&&(scope.tableLogicalContainerStyle.height=scope.displayedDataLength*scope.rowHeight+"px"),null==newVal||0==newVal.length)return scope.api.clearSelection(),void(scope.tableCanvasStyle["padding-top"]=0);if(newVal&&oldVal&&newVal.length<oldVal.length&&scope.limitBegin>newVal.length)scope.api.goToItem(newVal.length-1);else if(oldVal&&newVal&&0!=oldVal.length&&0!=newVal.length){var delta=newVal.length-oldVal.length;0!=delta&&scope.api.insureSelection(),lastObj&&(scope.limitBegin=scope.displayedCollection.indexOf(lastObj),-1==scope.limitBegin&&(scope.limitBegin=0))}scope.handleSelectionConsistency(),setTimeout(function(){scope.showHeader?fixHeaderWidths(!0):fixHeaderHidden(),findMaxRowHeight(elem),scope.api.dataLoaded&&scope.isFirstDataRender&&(scope.api.dataLoaded(),scope.isFirstDataRender=!1)},0)}function updateRenderedRows(newVal){if(newVal&&0!=newVal.length)if(scope.customFilters&&0!=scope.customFilters.length){for(var finalRes=newVal,f=0;f<scope.customFilters.length;f++){var filterName=scope.customFilters[f].trim();0!=filterName.length&&(finalRes=$filter(filterName)(finalRes))}scope.renderedRows=getRowsFromRange(finalRes,scope.limitBegin,scope.itemsPerPage)}else scope.renderedRows=getRowsFromRange(newVal,scope.limitBegin,scope.itemsPerPage);else scope.renderedRows=[]}function getRowsFromRange(rows,start,itemsPerPage){var start=Math.max(0,start),end=Math.min(rows.length,start+itemsPerPage);return rows.slice(start,end)}function adjustRows(displayedRows,newRows){if(displayedRows&&newRows){displayedRows.length=newRows.length;for(var i=0;i<newRows.length;i++)displayedRows[i]=newRows[i]}}function myResizeFn(){if(scope.showHeader){var currentWidth=elem.width();fixHeaderWidths(!0),scope.gridWidth=currentWidth}else fixHeaderHidden();scope.useVirtualScroll&&(findMaxRowHeight(elem),handleHorizontalScroll(elem))}function fixHeaderHidden(){elem.find(".scrollableContainer2").css("padding-top",0)}function needToFixHeaders(){try{return elem.find("th:first .th-inner")[0].offsetWidth!=elem.find("tr td:first")[0].offsetWidth}catch(e){return!1}}function fixHeaderWidths(isFromResizer){var ths=elem.find("thead th"),scrollArea=elem.find(".scrollArea"),headerSpacer=elem.find(".headerSpacer"),scrollableContainer2=elem.find(".scrollableContainer2");ths.each(function(i,thEl){var $thEl=$(thEl);if($thEl.find(".th-inner").length||$thEl.wrapInner('<div class="th-inner"></div>'),$thEl.find(".th-inner:not(:has(.box))").length&&$thEl.find(".th-inner:not(:has(.box))").wrapInner('<div class="box"></div>'),scope.hasVirtualHeaderGroups){headerSpacer.css("height","60px"),scrollableContainer2.css("padding-top","60px");var virtualSubGroups=$thEl.attr("virtual-sub-groups");if(null!=virtualSubGroups&&0!=virtualSubGroups.length){$thEl.find(".VirtualGroups").remove(),$thEl.prepend('<div class="th-inner VirtualGroups" style="top:30px"></div>'),virtualSubGroups=eval(virtualSubGroups);var pWidth=1/virtualSubGroups.length*100;ArrayUtils.each(virtualSubGroups,function(it){var itClass=it.replaceAll(" ","_");$thEl.find(".VirtualGroups").append('<div class="VirtualGroup '+itClass+'" style="width:'+pWidth+'%" title="'+it+'">'+it+"</div>")})}else $thEl.find(".th-inner").css({"max-height":"60px"}),$thEl.find(".th-inner .box").css({height:"60px"})}if(scope.hasHeaderGroups&&!scope.hasVirtualHeaderGroups){var group=$thEl.attr("group-def");if(0==$thEl.find(".hasGroup").length&&(null!=group&&0!=group.length?(headerSpacer.css("height","60px"),scrollableContainer2.css("padding-top","60px"),$thEl.find(".th-inner").css("top","30px"),0==elem.find('.hasGroup[name="'+group+'"]').length&&$thEl.prepend('<div class="th-inner hasGroup" name="'+group+'"><div class="box">'+group+"</div></div>")):scope.hasHeaderGroups&&($thEl.find(".th-inner").css({"max-height":"60px"}),$thEl.find(".th-inner .box").css({height:"60px"}))),null!=group&&0!=group.length){var sameGroupThs=elem.find('th[group-def="'+group+'"]'),totalWidth=0,groupLeft=0;sameGroupThs.each(function(index,itar){totalWidth+=$(itar).width(),0==index&&(groupLeft=$(itar).position().left)}),$thEl.is(":last-child")&&scrollArea[0].scrollHeight>scrollArea.height()&&(totalWidth+=17),elem.find('.hasGroup[name="'+group+'"]').css({width:totalWidth+"px",left:groupLeft+"px"})}}}),0==elem.find(".scrollArea th .hasGroup").length&&!scope.hasVirtualHeaderGroups&&scope.showHeader&&(headerSpacer.css("height","30px"),scrollableContainer2.css("padding-top","30px"),elem.find(".th-inner").css({"max-height":"30px"}),elem.find(".th-inner .box").css({height:"30px"}));var lastCol=elem.find("table th:visible:last"),scrollAreaWidth=scrollArea.width(),scrollAreaHeight=scrollArea.height(),trWidth=elem.find("tbody tr:eq(0)").width(),tableHeight=elem.find("table").height();elem.find("table th .th-inner:visible").each(function(index,el){if(el=angular.element(el),!el.hasClass("hasGroup")){var width=el.parent().width(),headerWidth=width;if("center"!==lastCol.css("text-align")){var hasScrollbar=tableHeight>scrollAreaHeight;lastCol[0]==el.parent()[0]&&hasScrollbar&&(headerWidth+=scrollAreaWidth-trWidth,headerWidth=Math.max(headerWidth,width))}var minWidth=_getScale(el.parent().css("min-width")),title=el.parent().attr("title");headerWidth=Math.max(minWidth,headerWidth),el.css("width",headerWidth+"px"),isFromResizer&&el.css("left",el.parent().position().left+"px"),title||(title=el.find(".title .ng-scope").html()||el.find(".box").html())}}),0==scope.scrollEnable?scrollArea.css("overflow-y","hidden"):tableHeight<=elem.height()&&scope.displayedCollection&&scope.limit<scope.displayedDataLength?scrollArea.css("overflow-y","scroll"):scrollArea.css("overflow-y","auto"),scope.tableMinWidth&&0!=scope.tableMinWidth&&(scope.tableLogicalContainerStyle["min-width"]=scope.tableMinWidth+"px",scope.tableMinWidth>scrollArea.width()&&scrollArea.css("overflow-x","auto"))}function applyHeaderRealState(){element.find(".scrollArea").width();element.find("th").each(function(i,th){var $th=$(th),guid=$th.attr("guid");scope.headersWidths[guid]&&$th.css("width",100*scope.headersWidths[guid].percentage+"%")})}function calcCurrentHeadersRealState(){scope.headersWidths={};var tableWidth=element.find(".scrollArea .tableLogicalContainer").width();element.find("th").each(function(i,th){var $th=$(th),guid=$th.attr("guid");scope.headersWidths[guid]={percentage:$th.width()/tableWidth}})}function persistWidths(){if(scope.gridId){var tableKey=getGridKeyForStorage(scope.gridId),storedData=window.userPreferences.get(tableKey);if(null==storedData)return;{element.find(".scrollArea .tableLogicalContainer").width()}ArrayUtils.each(storedData.columns,function(column){column.width="40px"}),calcCurrentHeadersRealState(),element.find(".scrollArea th").each(function(i,thEl){var $thEl=$(thEl),guid=$thEl.attr("guid"),affectedCol=scope.findColumn("guid",guid),columnKey=getColumnKeyForStorage(affectedCol),updateObj={width:100*scope.headersWidths[guid].percentage+"%"};null==storedData.columns[columnKey]&&(storedData.columns[columnKey]={}),ObjectUtils.deepMixIn(storedData.columns[columnKey],updateObj)}),window.userPreferences.set(tableKey,storedData,scope.config.saveUserPreferencesOnSet)}}function setResizing(){gridResizer=new Resizer(elem,function(){fixHeaderWidths(!0),scope.gridId&&persistWidths()},{getHeadersRealStateMap:function(){return calcCurrentHeadersRealState(),applyHeaderRealState(),scope.headersWidths}})}function onHeadersRendered(){scope.additionalUIData.userPrefsApplied||(applyStoredData(scope.gridId,elem),scope.additionalUIData.userPrefsApplied=!0,scope.updateVisibleColumns())}function calculateTooltip(){var contentTds=elem.find(".td-content");contentTds.each(function(index,el){$(el).height()<=$(el).parent().height()&&($(el).parents("td").removeAttr("ng-attr-title"),$(el).parents("td").removeAttr("title"))})}function unfreezeColumn(){element.find("tr td.frozenTd").removeAttr("style"),element.find("tr td.frozenTd .td-inner").css({"border-right":"initial"}),element.find("th.locked .th-inner").css({"z-index":0}),element.find("th.locked").removeClass("Moved"),element.find("tr td.frozenTd").removeClass("frozenTd")}function applySortingFilter(){var predicate=scope.orderPredicate;if(predicate){var isReverse="-"==scope.orderPredicate.charAt(0),modelPropQuery=scope.orderPredicate;isReverse&&(modelPropQuery=scope.orderPredicate.replace("-",""));var colScope=scope.columnsDict[modelPropQuery];colScope&&null!=colScope.sortProp&&(predicate=(isReverse?"-":"")+colScope.sortProp)}scope.displayedCollection=$filter("gridOrderBy")(scope.displayedCollection,predicate,scope.secondarySortProp)}function updateDisplayedCollection(data,isUpdateViewStateOnly){scope.filtered=!1,null!=data&&(scope.internalFilter&&scope.internalFilter.length>0||ObjectUtils.isKind(scope.internalFilter,"Object")?(scope.filtered=!0,ObjectUtils.isKind(scope.internalFilter,"Object")&&(scope.filtered=!ObjectUtils.isEmpty(ObjectUtils.filter(scope.internalFilter,function(key,val){return""!=val}))),scope.displayedCollection=$filter("gridRowsFilter")(data,scope.columns,scope.internalFilter,scope.preDefinedSearchColumns)):scope.displayedCollection=data.slice(0,data.length),scope.api.info.displayedItemsLength=scope.displayedCollection.length,scope.api.info.displayedCollection=scope.displayedCollection,scope.api.onDisplayedCollectionChanged&&!isUpdateViewStateOnly&&scope.api.onDisplayedCollectionChanged(scope.displayedCollection))}function setDefaultSorting(){null!=scope.orderPredicate&&(scope.orderPredicate=scope.orderPredicate.replaceAll("'","")),0==scope.enableSorting&&null==attrs.orderPredicate&&(scope.orderPredicate=null),scope.enableSorting&&null==scope.orderPredicate&&scope.columns&&null!=scope.columns[0]?scope.orderPredicate=scope.columns[0].modelProp:"undefined"==scope.orderPredicate&&(scope.orderPredicate=null),applySortingFilter()}function applySortingClasses(){var modelPropOfOrded=scope.orderPredicate.replace("-",""),preOrdered=elem.find('th[rel="'+modelPropOfOrded+'"]');elem.find("th").removeClass("st-sort-descent").removeClass("st-sort-ascent"),preOrdered.addClass(0==scope.orderPredicate.indexOf("-")?"st-sort-descent":"st-sort-ascent")}function initColumnReOrdering(){var lastGuid,draggedColIndex=-1,lastTargetIndex=-1,visCols=scope.getVisibleColumns();$(elem).find(".HeaderTr").sortable({refreshPositions:!0,opacity:.95,grid:[20,10],appendTo:document.body,placeholder:"placeholder",helper:function(event,draggedTH){lastGuid=$(draggedTH).attr("guid"),draggedColIndex=$(draggedTH).index();var draggedElem=$('<div style="border: 1px dashed; height: 30px;background: #808080;color: #ffffff"></div>');return-1!=draggedColIndex&&(draggedElem.width($(draggedTH).width()),draggedElem.text(scope.findColumn("guid",lastGuid).displayName),draggedElem.css("top",$(draggedTH).offset().top)),draggedElem[0]},sort:function(event,evObj){if($(evObj.helper).css("top",$(evObj.placeholder).offset().top+"px"),$(event.toElement).is("th")||$(event.toElement).parents("th").length>0){var sortableIndicator=$(".sortableIndicator"),targetPosition=$(event.toElement).offset();sortableIndicator.css("top",targetPosition.top-20+"px"),sortableIndicator.css("left",targetPosition.left+"px"),lastTargetIndex=$(event.toElement).parents("th").index()}},start:function(event,evObj){visCols=scope.getVisibleColumns(),$(evObj.placeholder).append($(evObj.item).find(".th-inner").clone()),$(evObj.placeholder).width($(evObj.item).find(".th-inner").width()),$(evObj.placeholder).css("visibility","visible");var sortableIndicator=$('<div class="sortableIndicator" style="position: absolute;color: #ff0000;font-size: 15px"> <span class="glyphicon glyphicon-arrow-down"></span></div>');$("body").append(sortableIndicator),draggedColIndex=$(evObj.item).index()},stop:function(event){var targetIndex=$(event.toElement).parents("th").index();if(-1==targetIndex&&(targetIndex=lastTargetIndex),-1!=draggedColIndex&&-1!=targetIndex){draggedColIndex=scope.columns.indexOf(scope.findColumn("guid",lastGuid)),targetIndex=scope.columns.indexOf(visCols[targetIndex]);var toChange=scope.columns.splice(draggedColIndex,1);scope.safeApply(function(){scope.columns.splice(targetIndex,0,toChange[0]),updateColumnStoredData(lastGuid,{ordinal:targetIndex},!0),$timeout(function(){fixHeaderWidths(!0)})})}$(".sortableIndicator").remove()}})}function storeInitialColumnsData(columns,gridId){if(null!=gridId){var tableKey=getGridKeyForStorage(gridId);if(null==window.userPreferences.get(tableKey)){var dataToStore={};dataToStore.columns={};for(var i=0;i<columns.length;i++){var columnKey=getColumnKeyForStorage(columns[i]);dataToStore.columns[columnKey]={hidden:columns[i].hidden}}window.userPreferences.set(tableKey,dataToStore,scope.config.saveUserPreferencesOnSet)}}}function updateColumnStoredData(guid,updateObj,saveToStorage){if(scope.gridId){var affectedCol=scope.findColumn("guid",guid),columnKey=getColumnKeyForStorage(affectedCol),tableKey=getGridKeyForStorage(scope.gridId),storedData=window.userPreferences.get(tableKey);if(null==storedData)return;storedData.columns[columnKey]=getColumnObjForStorage(affectedCol),ObjectUtils.deepMixIn(storedData.columns[columnKey],updateObj),window.userPreferences.set(tableKey,storedData,scope.config.saveUserPreferencesOnSet&&saveToStorage)}}function getColumnObjForStorage(col){return{width:col.width,hidden:col.hidden,ordinal:col.ordinal}}function getColumnKeyForStorage(col){return col.modelProp}function getGridKeyForStorage(gridId){return"table_"+gridId}function getStoredData(gridId){var tableKey=getGridKeyForStorage(gridId);return window.userPreferences.get(tableKey)}function getColumnsDataForSettings(){var cols=[],storedData=getStoredData(scope.gridId);return ArrayUtils.each(scope.columns,function(colScope){var colData=getColumnData(colScope);if(storedData){{storedData.columns[colData.modelProp]||{}}cols.push(ObjectUtils.deepMixIn(colData,storedData))}else cols.push(colData)}),cols}function getColumnsData(){var cols=[];return ArrayUtils.each(scope.columns,function(colScope){var colData=getColumnData(colScope);cols.push(colData)}),ObjectUtils.deepClone(cols)}function applyStoredData(gridId){if(null!=gridId){var storedData=getStoredData(gridId);null!=storedData&&(ObjectUtils.forOwn(storedData.columns,function(key,value){var col=scope.findColumn("modelProp",key);col&&(value&&value.width&&(col.style=ObjectUtils.isKind(value.width,"String")&&value.width.indexOf("%")?{width:value.width}:{width:value.width+"px"}),value&&null!=value.ordinal&&(col.ordinal=value.ordinal),value&&null!=value.hidden&&(col.hidden=value.hidden))}),storedData.orderPredicate&&(scope.orderPredicate=storedData.orderPredicate),null!=scope.orderPredicate&&0!=scope.orderPredicate.length&&applySortingFilter(),setTimeout(function(){null!=scope.orderPredicate&&0!=scope.orderPredicate.length&&applySortingClasses()},0))}}function updateOrderPredicate(gridId,orderPredicate){if(null!=gridId){var tableKey=getGridKeyForStorage(gridId),storedData=window.userPreferences.get(tableKey);storedData.orderPredicate=orderPredicate,window.userPreferences.set(tableKey,storedData,scope.config.saveUserPreferencesOnSet)}}function handleHorizontalScroll(gridElem){var tableWidth=gridElem.find("table").width();tableWidth>gridElem.width()?(gridElem.find(".tableLogicalContainer").css("min-width",tableWidth),gridElem.find(".scrollArea").css("overflow-x","auto")):gridElem.find(".scrollArea").css("overflow-x","hidden")
}function findMaxRowHeight(gridElem){if(scope.useVirtualScroll&&scope.displayedCollection&&scope.displayedDataLength>0){var actualRowHeight=0,rows=gridElem.find("tbody tr");rows&&rows.length>0&&(actualRowHeight=rows.eq(0).height()),actualRowHeight&&0!=actualRowHeight&&actualRowHeight!=scope.rowHeight&&(scope.rowHeight=actualRowHeight,scope.tableLogicalContainerStyle.height=scope.displayedDataLength*scope.rowHeight+"px"),scope.itemsPerPage=scope.itemsPerPage||Math.floor(gridElem.find(".scrollArea").height()/scope.rowHeight+1),scope.safeApply(function(){updateRenderedRows(scope.displayedCollection)})}}if("true"==attr.staticMode)return scope.showHeader=!0,scope.parentCtrl=scope.$parent,$compile(element.find(".columnsDef"))(scope.parentCtrl),element.find(".columnsDef").remove(),0==scope.columns.length&&handleColumnsDef(scope.data,scope.columns),void $timeout(function(){elem.removeAttr("att-grid"),$compile(element)(scope)});scope.useVirtualScroll=!0,"false"==attrs.useVirtualScroll&&(scope.useVirtualScroll=!1),scope.scrollEnable=!0,"false"==attrs.scrollEnable&&(scope.scrollEnable=!1),scope.config=scope.configObjGetter(),scope.config||(scope.config={}),scope.exportFn=scope.exportFnGetter(),null==scope.config.saveUserPreferencesOnSet&&(scope.config.saveUserPreferencesOnSet=window.attGridConfig.saveUserPreferencesOnSet),null==scope.config.headerCtxMenuActions&&(scope.config.headerCtxMenuActions={}),scope.selectionPolicy=SelectionPolicyEnum.byIndex,null!=scope.identifier&&"$index"!=scope.identifier&&(scope.selectionPolicy=SelectionPolicyEnum.byId),null!=attrs.customFilter&&(scope.customFilters=attrs.customFilter.split("|")),ObjectUtils.deepFillIn(scope.config.headerCtxMenuActions,window.attGridConfig.headerCtxMenuActions),scope.preDefinedSearchColumns=scope.columnsInSearch(),"true"==attr.allowGrouping&&(scope.allowGrouping=!0),null!=attrs.secondarySortProp&&(scope.secondarySortProp=attrs.secondarySortProp),scope.visibleColumns=[],scope.updateVisibleColumns=function(){scope.visibleColumns=$filter("gridDisplayedColumns")(scope.columns),scope.api&&scope.api.info&&(scope.api.info.totalColumnsLength=scope.columns.length,scope.api.info.visibleColumnsLength=scope.visibleColumns.length),null!=scope.tableMinWidth&&(scope.tableMinWidth=scope.minWidth*scope.api.info.visibleColumnsLength,scope.tableLogicalContainerStyle["min-width"]=scope.tableMinWidth+"px")},scope.lastActionData={lastSelectedRowScope:null,lastSelectedCellScope:null,lastEditModeCellScope:null},scope.additionalUIData={rowClasses:{},treeDataExpanded:{},userPrefsApplied:!1},scope.safeApply=function(fn){var phase=this.$root.$$phase;"$apply"==phase||"$digest"==phase?fn&&"function"==typeof fn&&fn():(fn(),this.$digest())},null==attrs.resizable&&(scope.resizable=!0),scope.rowHeight=30,scope.tableLogicalContainerStyle={},scope.tableCanvasStyle={"padding-top":0},scope.isDynamicColumns=null!=attrs.dynamicColumns,0!=element.find("column").length||scope.isDynamicColumns||(scope.watchColumns=!0,scope.columnsDisplayLimit=15,null!=attrs.columnsDisplayLimit&&(scope.columnsDisplayLimit=parseInt(attrs.columnsDisplayLimit))),scope.showCSFlag=!1,scope.isEditable="true"==attrs.isEditable,"basic"==scope.featurePack&&(scope.enableSelection=!0,scope.multipleSelection=!0,scope.resizable=!0),null==scope.enableSorting?scope.enableSorting=!0:scope.enableSorting===!1&&element.addClass("SortingDisabled");var gridResizer=null;element.removeAttr("att-grid"),element.removeAttr("resizable"),scope.itemsPerPage=scope.itemsPerPageGetter()||100,void 0===scope.showHeader&&(scope.showHeader=!0),void 0===scope.paging&&(scope.paging=!0),scope.parentCtrl=scope.$parent,scope.displayedCollection=[],scope.renderedRows=[],scope.headersCtxMenu=function(ctxMenuEvent,elData){var isFrozen=$(ctxMenuEvent.currentTarget).hasClass("locked"),menuData=[];return scope.enableSorting&&scope.config.headerCtxMenuActions.sorting&&(menuData.push({id:1,name:"Sort Ascending",clickFunc:function($event,menuItem,elData){scope.orderPredicate=elData.modelProp,applySortingFilter(),applySortingClasses(),updateOrderPredicate(scope.gridId,scope.orderPredicate)},disabled:function(elData){return elData.modelProp==scope.orderPredicate}}),menuData.push({id:2,name:"Sort Descending",clickFunc:function($event,menuItem,elData){scope.orderPredicate="-"+elData.modelProp,applySortingFilter(),applySortingClasses(),updateOrderPredicate(scope.gridId,scope.orderPredicate)},disabled:function(elData){return"-"+elData.modelProp==scope.orderPredicate}}),scope.config.headerCtxMenuActions.defaultSorting&&menuData.push({id:3,name:"Default Sorting",clickFunc:function(){scope.orderPredicate=scope.defaultOrderPredicate,updateDisplayedCollection(scope.data),applySortingClasses(),setDefaultSorting(),updateOrderPredicate(scope.gridId,scope.orderPredicate)}})),scope.config.headerCtxMenuActions.freezeColumn&&elem.find(".tableLogicalContainer").width()>elem.find(".scrollArea").width()&&menuData.push({id:4,name:isFrozen?"Un-Freeze Column":"Freeze Column",clickFunc:function($event,menuItem,elData){var wasLocked=element.find("th[guid="+elData.guid+"]").hasClass("locked");unfreezeColumn(),element.find(".locked").removeClass("locked"),wasLocked||element.find("th[guid="+elData.guid+"]").addClass("locked")}}),scope.config.headerCtxMenuActions.quickColumnSelection&&menuData.push({id:5,name:"Column Selection",clickFunc:function(){scope.api.internalViews.openColumnSelection()}}),scope.config.headerCtxMenuActions.exportToCSV&&menuData.push({id:6,name:window.attGridConfig.exportFormats.CSV.displayName,clickFunc:function(){scope.api.exportGrid(window.attGridConfig.exportFormats.CSV.type)}}),scope.config.headerCtxMenuActions.exportToTSV&&menuData.push({id:16,name:window.attGridConfig.exportFormats.TSV.displayName,clickFunc:function(){scope.api.exportGrid(window.attGridConfig.exportFormats.TSV.type)}}),scope.config.headerCtxMenuActions.exportToHTML&&menuData.push({id:7,name:window.attGridConfig.exportFormats.HTML.displayName,clickFunc:function(){scope.api.exportGrid(window.attGridConfig.exportFormats.HTML.type)}}),scope.config.headerCtxMenuActions.columnSettings&&menuData.push({id:8,name:"Column Settings...",clickFunc:function(){scope.api.internalViews.openColumnSettings()}}),scope.config.headerCtxMenuActions.hideColumn&&!elData.isMandatory&&1!=scope.visibleColumns.length&&menuData.push({id:9,name:"Hide Column",clickFunc:function($event,menuItem,elData){elData.hidden=!0,scope.calcHeaders(elData),scope.updateVisibleColumns()}}),scope.config.headerCtxMenuActions.valuesFilter&&menuData.push({id:10,name:"Filter",clickFunc:function($event,menuItem,elData){scope.api.internalViews.openValuesFilter(elData)}}),menuData},scope.onFilterFn=function(filtered){scope.orginalData||(scope.orginalData=ObjectUtils.clone(scope.data)),scope.data.splice(0,scope.data.length),Array.prototype.push.apply(scope.data,filtered)},scope.selection={},scope.disabledRows={},scope.api||(scope.api={}),scope.api.info={displayedItemsLength:0,selectedItemsLength:0,totalColumnsLength:0,visibleColumnsLength:0,isFirstItemSelected:!1,isLastItemSelected:!1,displayedCollection:[]};var showHideCol=function(elData,showCol){elData.hidden=!showCol,elData.specialHidden=!showCol,scope.calcHeaders(elData),scope.updateVisibleColumns();var defaultCol=ArrayUtils.find(scope.defaultColumns,function(col){return col.displayName===elData.displayName&&col.headerGroup===elData.headerGroup});defaultCol&&(defaultCol.specialHidden=!showCol)};scope.api.showHideColumn=function(colName,showCol){var elData=ArrayUtils.find(scope.columns,function(col){return col.displayName===colName});elData&&showHideCol(elData,showCol)},scope.api.showHideColumnsByGroup=function(header,showCol){var groupColumns=scope.columns.filter(function(col){return col.headerGroup===header});ArrayUtils.each(groupColumns,function(elData){showHideCol(elData,showCol)})},scope.api.selectedItems=[],scope.onRowClick=function(row,col,$event){var rowScope=this.$parent,cellScope=this;scope.lastActionData.lastEditModeCellScope!=cellScope&&scope.isEditable&&($(elem).find(".tdEditMode").removeClass("tdEditMode"),rowScope.$isRowSelected&&(cellScope.$isEditMode=!0),null!=scope.lastActionData.lastSelectedRowScope&&(scope.lastActionData.lastSelectedRowScope.$isRowSelected=!1,scope.lastActionData.lastSelectedCellScope.$isCellSelected=!1),null!=scope.lastActionData.lastEditModeCellScope&&(scope.lastActionData.lastEditModeCellScope.$isEditMode=!1),scope.lastActionData.lastSelectedRowScope=rowScope,scope.lastActionData.lastSelectedCellScope=cellScope,cellScope.$isEditMode&&(scope.lastActionData.lastEditModeCellScope=cellScope,$timeout(function(){$($event.currentTarget).addClass("tdEditMode");$($event.currentTarget).find("input:eq(0)").focus().css({width:"100%",height:$event.currentTarget.offsetHeight+"px",padding:"0",border:"none","border-radius":"0"})})),scope.lastActionData.lastSelectedRowScope.$isRowSelected=!0,scope.lastActionData.lastSelectedCellScope.$isCellSelected=!0),scope.enableSelection&&scope.onTrClick(row,this.$parent.$index,$event),scope.api.onRowClick&&scope.api.onRowClick(row,getColumnData(col),$event)},scope.onExpandCollapse=function(rowData){scope.api.onExpandCollapse&&scope.api.onExpandCollapse(rowData),scope.additionalUIData.treeDataExpanded[rowData[scope.identifier]]=!scope.additionalUIData.treeDataExpanded[rowData[scope.identifier]]},scope.onRowContextMenu=function($event,row){var res=scope.api.rowContextMenu?scope.api.rowContextMenu($event,row):null;return"true"==attrs.isTree&&row.children&&row.children.length>0&&(null==res&&(res=[]),res.push(scope.additionalUIData.treeDataExpanded[row[scope.identifier]]?{id:100,name:"Collapse",clickFunc:function(){scope.additionalUIData.treeDataExpanded[row[scope.identifier]]=!1}}:{id:101,name:"Expand",clickFunc:function(){scope.additionalUIData.treeDataExpanded[row[scope.identifier]]=!0}})),res},scope.api.exportGrid=function(format){format=format||window.attGridConfig.exportFormats.CSV.type,format=format.toUpperCase();var file_name=gridExportName(scope.exportFileName,scope.gridId,"."+format.toLowerCase(),scope.config.headerCtxMenuActions.exportFileNameAddTimestamp),tableString=createGridDataForCSV(scope.columns,scope.displayedCollection,scope.config.headerCtxMenuActions.exportGroupHeaders);null!=scope.exportFn?$timeout(function(){scope.exportFn()}):format==window.attGridConfig.exportFormats.CSV.type?(tableString=createGridDataForCSV(scope.columns,scope.displayedCollection,scope.config.headerCtxMenuActions.exportGroupHeaders),$timeout(function(){Utils.exportToCsv(file_name,tableString)})):format==window.attGridConfig.exportFormats.TSV.type?(tableString=createGridDataForCSV(scope.columns,scope.displayedCollection,scope.config.headerCtxMenuActions.exportGroupHeaders),$timeout(function(){Utils.exportToTsv(file_name,tableString)})):format==window.attGridConfig.exportFormats.HTML.type&&$timeout(function(){tableString=createGridHtmlString(scope.columns,scope.displayedCollection),Utils.exportToHtml(file_name,tableString,createGridStyleString(element.width()))})},scope.onRowDblClick=function(row,col,event){scope.api.onRowDblClick&&scope.api.onRowDblClick(row,getColumnData(col),event)},scope.api.getSelection=function(){var result=[];if(scope.selectionPolicy==SelectionPolicyEnum.byId){if(scope.allSelected)return 0!=ObjectUtils.size(scope.disabledRows)?ArrayUtils.filter(scope.displayedCollection,function(it){return!scope.disabledRows[it[scope.identifier]]}):scope.displayedCollection;result=ArrayUtils.filter(scope.displayedCollection,function(it){return scope.selection[it[scope.identifier]]})}else{var filteredData=scope.displayedCollection;if(scope.allSelected)return filteredData;for(var i in scope.selection)parseInt(i)>=0&&scope.selection[i]&&result.push(filteredData[i])}return result},scope.selectAll=function(){scope.multipleSelection&&(scope.allSelected=!0),scope.updateSelectedItems()},scope.moveSelection=function(addition){(null==scope.lastSelectedIndex||scope.lastSelectedIndex>=scope.displayedCollection.length)&&(scope.lastSelectedIndex=0);var rowSelector=scope.lastSelectedIndex+addition;if(!(0>rowSelector||rowSelector>=scope.displayedCollection.length)){var isHasPreviousSelection=scope.selection[scope.lastSelectedIndex];scope.selectionPolicy==SelectionPolicyEnum.byId&&(rowSelector=scope.displayedCollection[scope.lastSelectedIndex+addition][scope.identifier],isHasPreviousSelection=scope.displayedCollection[scope.lastSelectedIndex][scope.identifier]),isHasPreviousSelection&&(scope.selection={},scope.selection[rowSelector]=!0,scope.api.goToItem(scope.lastSelectedIndex+addition),scope.updateSelectedItems(),scope.lastSelectedIndex=scope.lastSelectedIndex+addition)}},scope.api.moveSelection=scope.moveSelection,scope.api.clearSelection=function(){scope.selection={},scope.updateSelectedItems()},scope.updateSelectedItems=function(){var emitEvent=!0,selection=scope.api.getSelection();if(selection.length==scope.api.selectedItems.length&&null!=scope.identifier){emitEvent=!1;for(var i=0;i<selection.length;i++){var found=ArrayUtils.find(scope.api.selectedItems,function(it){return ObjectUtils.get(it,scope.identifier)==ObjectUtils.get(selection[i],scope.identifier)});if(null==found){emitEvent=!0;break}}}scope.api.selectedItems.splice(0,scope.api.selectedItems.length),scope.displayedCollection.length>0&&(scope.api.info.isFirstItemSelected=-1!=selection.indexOf(scope.displayedCollection[0]),scope.api.info.isLastItemSelected=-1!=selection.indexOf(scope.displayedCollection[scope.displayedCollection.length-1])),scope.api.info.selectedItemsLength=selection.length,scope.api.info.displayedCollection=scope.displayedCollection,Array.prototype.push.apply(scope.api.selectedItems,selection),scope.api.onSelectionChanged&&emitEvent&&scope.api.onSelectionChanged(selection)},scope.hideShowCol=function(col,isHide){if("string"==typeof col){var filColumns=$filter("filter")(scope.columns,{modelProp:col});1==filColumns.length&&(filColumns[0].hidden=isHide)}else"number"==typeof col&&(scope.columns[col].hidden=isHide)},scope.api.hideColumns=function(cols){if(angular.isArray(cols))for(var i=0;i<cols.length;i++)scope.hideShowCol(cols[i],!0);else if(-1==cols)for(var i=0;i<scope.columns.length;i++)scope.hideShowCol(i,!0);else scope.hideShowCol(cols,!0);scope.updateVisibleColumns(),setTimeout(function(){fixHeaderWidths(!0)},0)},scope.api.showColumns=function(cols){if(angular.isArray(cols))for(var i=0;i<cols.length;i++)scope.hideShowCol(cols[i],!1);else if(-1==cols)for(var i=0;i<scope.columns.length;i++)scope.hideShowCol(i,!1);else scope.hideShowCol(cols,!1);scope.updateVisibleColumns(),setTimeout(function(){fixHeaderWidths(!0)},0)},scope.api.resetTableDefaults=function(){$timeout(function(){scope.limit=scope.itemsPerPage,fixHeaderWidths(!0)})},scope.api.fixHeaders=function(){setTimeout(function(){fixHeaderWidths(!0)},0)},scope.api.selectAndGoToItem=function(predicate,keepSelection){if(scope.enableSelection){var item=scope._getGridItem(predicate)[0],index=scope._getGridItemIndex(item);lastTouchedGrid=elem.attr("guid"),scope.safeApply(function(){scope.onTrClick(item,index-scope.limitBegin,{ctrlKey:keepSelection,metaKey:keepSelection}),scope.api.goToItem(index)})}},scope.api.insureSelection=function(){if(1==scope.api.info.selectedItemsLength){var item=scope.api.selectedItems[0],index=scope._getGridItemIndex(item);scope.onTrClick(item,index-scope.limitBegin,{ctrlKey:!1,metaKey:!1})}},scope.api.goToItem=function(index){if(index>scope.limitBegin+scope.itemsPerPage-3||index<=scope.limitBegin){var scrollTop=(index+2)*scope.rowHeight-elem.find(".scrollArea").height();0>scrollTop&&(scrollTop=0),element.find(".scrollArea").scrollTop(scrollTop)}},scope.api.addRowClass=function(rowData,classes){scope.identifier?scope.additionalUIData.rowClasses[rowData[scope.identifier]]=classes:console.log("addRowClass -  works only if the att-grid directive has 'identifier' attribute defined")},scope.api.removeRowClass=function(rowData,classes){if(scope.identifier)try{scope.additionalUIData.rowClasses[rowData[scope.identifier]]=scope.additionalUIData.rowClasses[rowData[scope.identifier]].replace(classes,"")}catch(e){}else console.log("addRowClass -  works only if the att-grid directive has 'identifier' attribute defined")},scope.api.updateViewState=function(){updateDisplayedCollection(scope.displayedCollection,!0),applySortingFilter()},scope.api.sortBy=function(modelProp,isDesc){scope.orderPredicate=(isDesc?"-":"")+modelProp,applySortingFilter(),applySortingClasses()},scope.api.display={},scope.api.display.is=function(dataItem,index,offset){return is(scope.renderedRows,dataItem,index,offset)},scope.api.display.hasScroll=function(){return elem.find(".scrollArea")[0].scrollHeight>elem.find(".scrollArea").height()},scope.api.display.indexOf=function(dataItem){return scope.displayedCollection.indexOf(dataItem)},scope.api.disableRow=function(rowData){if(scope.identifier){var rowId=rowData[scope.identifier];scope.disabledRows[rowId]=!0,scope.additionalUIData.rowClasses[rowId]||(scope.additionalUIData.rowClasses[rowId]=""),scope.additionalUIData.rowClasses[rowId]+="SelectionDisabled",scope.selection[rowId]=!1}else console.log("disableRows -  works only if the att-grid directive has 'identifier' attribute defined")},scope.api.enableRow=function(rowData){var rowId=rowData[scope.identifier];scope.identifier&&rowId&&scope.disabledRows[rowId]?(delete scope.disabledRows[rowId],scope.additionalUIData.rowClasses[rowId]&&(scope.additionalUIData.rowClasses[rowId]=scope.additionalUIData.rowClasses[rowId].replaceAll("SelectionDisabled",""))):console.log("enableRows -  works only if the att-grid directive has 'identifier' attribute defined")},scope.api.selectAllRows=function(){scope.$applyAsync(scope.selectAll)};var _filterElem=null,_filterScope=null;if(scope.api.internalViews={openColumnSettings:function(){var filterScope=$rootScope.$new(),cols=getColumnsDataForSettings();filterScope.onFinishColumnsSettings=scope.onFinishColumnsSettings,filterScope.defaultColumns=scope.defaultColumns,filterScope.updateColumnAfterChange=scope.updateColumnAfterChange,filterScope.columns=scope.columns,filterScope.columnsData=cols;var filterElem=angular.element('<div att-grid-columns-settings on-finish="onFinishColumnsSettings" default-columns="defaultColumns" on-change="updateColumnAfterChange" columns="columns" columns-data="columnsData" style="position: absolute;top: 0px;left:10px;background: #ffffff"></div>');$compile(filterElem)(filterScope),$("body").append(filterElem),_filterElem=filterElem,_filterScope=filterScope},openColumnSelection:function(){var filterScope=scope.$new(),cols=getColumnsDataForSettings();filterScope.columnsData=cols;var filterElem=angular.element('<att-grid-column-selection columns="columns" columns-data="columnsData"  on-finish="fixHeadersAfterShowHide" on-change="updateColumnAfterChange" style="position: absolute;top: 0px;left:10px;background: #ffffff"></att-grid-column-selection>');$compile(filterElem)(filterScope),elem.append(filterElem)},openValuesFilter:function(colData){var elData;elData=ObjectUtils.isKind(colData,"Number")?scope.columns[colData]:colData;var filterScope=scope.$new();filterScope.column=elData,filterScope.gridData=scope.orginalData||scope.data,filterScope.onFilterFn=scope.onFilterFn;var filterElem=angular.element('<div att-grid-values-filter column="column" grid-data="gridData" on-filter-fn="onFilterFn" style="position: absolute;top: 0;left:0;background: #ffffff"></div>');$compile(filterElem)(filterScope),elem.append(filterElem)},closeColumnSettings:function(){null!=_filterScope&&(_filterScope.$destroy(),_filterScope=null),null!=_filterElem&&(_filterElem.remove(),_filterElem=null)}},scope.lastSelectedIndex=0,scope.enableSelection&&(scope.onTrClick=function(rowData,$index,$event){scope.allSelected&&($event.ctrlKey||$event.metaKey)&&scope.moveAllRowsToSelectionObj(),scope.selectRow(rowData,$index,$event.ctrlKey||$event.metaKey,$event.shiftKey)}),scope.moveAllRowsToSelectionObj=function(){scope.selection={};for(var i=0;i<scope.displayedCollection.length;i++)if(scope.selectionPolicy==SelectionPolicyEnum.byId){var rowId=scope.displayedCollection[i][scope.identifier];scope.disabledRows[rowId]||(scope.selection[rowId]=!0)}else scope.selection[i]=!0},scope.selectRow=function(rowData,$index,isCtrlPressed,isShiftPressed){if(null!=rowData){scope.allSelected=!1;var index=scope.limitBegin+$index,singleRowSelector=index;if(scope.selectionPolicy!=SelectionPolicyEnum.byId||(singleRowSelector=rowData[scope.identifier],isShiftPressed||!scope.disabledRows[singleRowSelector])){if(scope.multipleSelection)if(isShiftPressed){var startIndex=scope.lastSelectedIndex+1,endIndex=index;scope.lastSelectedIndex>index&&(startIndex=index,endIndex=scope.lastSelectedIndex-1);for(var j=startIndex;endIndex>=j;j++)if(scope.selectionPolicy==SelectionPolicyEnum.byId){var rowId=scope.displayedCollection[j][scope.identifier];rowId&&!scope.disabledRows[rowId]&&(scope.selection[rowId]=!scope.selection[rowId])}else scope.selection[j]=!scope.selection[j];_clearTextSelection()}else isCtrlPressed?(scope.selection[singleRowSelector]=!scope.selection[singleRowSelector],_clearTextSelection()):(scope.selection={},scope.selection[singleRowSelector]=!0);else scope.selection={},scope.selection[singleRowSelector]=!0;scope.lastSelectedIndex=index,scope.updateSelectedItems()}}},scope.shouldShowRowTip=function(el){var elScope=angular.element(el).scope();if(elScope&&elScope.rowData){var fnHndl=scope.rowTooltipFn();return fnHndl?fnHndl(elScope.rowData):!1}return!1},scope._getGridItem=function(predicate){var filteredData=scope.displayedCollection;return ObjectUtils.isKind(predicate,"Number")?[filteredData[predicate]]:$filter("filter")(scope.displayedCollection,predicate,!0)},scope._getGridItemIndex=function(item){var filteredData=scope.displayedCollection;return filteredData.indexOf(item)},scope._setDisplayedDataLength=function(){var filteredData=scope.displayedCollection;scope.displayedDataLength=filteredData?filteredData.length:0},scope.getVisibleColumns=function(){return ArrayUtils.filter(scope.columns,function(it){return!it.hidden})},scope.findColumn=function(prop,value,ignoreCase){return ArrayUtils.filter(scope.columns,function(it){return ignoreCase?it[prop].toLowerCase()==value.toLowerCase():it[prop]==value})[0]},scope.onShowCSFlag=function(){scope.showCSFlag=!0},scope.$watchCollection("filter",function(newVal){scope.internalFilter=newVal,updateDisplayedCollection(scope.data),applySortingFilter(),scope._setDisplayedDataLength(),scope.tableLogicalContainerStyle.height=scope.displayedDataLength*scope.rowHeight+"px",scope.tableLogicalContainerStyle.height&&scope.tableCanvasStyle["padding-top"]?_getScale(scope.tableLogicalContainerStyle.height)<_getScale(scope.tableCanvasStyle["padding-top"])&&(scope.tableCanvasStyle["padding-top"]=scope.tableLogicalContainerStyle.height):scope.tableCanvasStyle["padding-top"]=0,null!=newVal&&(scope.selectionPolicy==SelectionPolicyEnum.byIndex?scope.api.clearSelection():scope.handleSelectionConsistency(),setTimeout(function(){fixHeaderWidths(!0)},0))}),scope.calcTbodyHeightForExpandableGrid=function(){scope.tableLogicalContainerStyle.height=elem.find("tbody").height()+"px"},scope.isFirstDataRender=!0,scope.config.isImmutableSource?scope.$watch("data",onDataChange):scope.$watchCollection("data",onDataChange),scope.handleSelectionConsistency=function(){if(scope.selectionPolicy==SelectionPolicyEnum.byId&&scope.api.info.selectedItemsLength>0){var notFoundLength=0;scope.selectionNotFound={},ObjectUtils.forOwn(scope.selection,function(key){scope.selectionNotFound[key]=!0,notFoundLength++});for(var k=0;k<scope.displayedCollection.length;k++){var key=scope.displayedCollection[k][scope.identifier];if(null!=scope.selectionNotFound[key]&&(delete scope.selectionNotFound[key],notFoundLength--),0==notFoundLength)break}ObjectUtils.forOwn(scope.selectionNotFound,function(key){delete scope.selection[key]}),delete scope.selectionNotFound,scope.updateSelectedItems()}scope.selectionPolicy==SelectionPolicyEnum.byId&&scope.allSelected&&scope.updateSelectedItems()},scope.$watch("displayedCollection",function(newVal,oldVal){updateRenderedRows(newVal,oldVal)}),scope.isDynamicColumns&&(scope.prepareColumns=function(newVal,oldVal){null!=newVal&&null!=oldVal&&(scope.columns=[],ArrayUtils.each(newVal,function(col){col.guid=guid(),col.tooltipProp=col.tooltipProp?col.tooltipProp:col.modelProp,col.hidden=1==col.hidden,scope.columns.push(col)}),scope.fixHeadersAfterShowHide())},scope.$watchCollection("dynamicColumns",scope.prepareColumns)),scope.watchColumns&&scope.$watchCollection("data",function(newVal,oldVal){if(null!=newVal&&0!=newVal.length&&(newVal!=oldVal||0==scope.columns.length)){scope.columns=[];for(var maxWidthsArr={},keys=[],i=0;i<scope.data.length;i++)for(var iKeys=Object.keys(scope.data[i]),j=0;j<iKeys.length;j++)null==maxWidthsArr[iKeys[j]]&&(maxWidthsArr[iKeys[j]]=0),maxWidthsArr[iKeys[j]]=Math.max(maxWidthsArr[iKeys[j]],scope.data[i][iKeys[j]].toString().length),keys.indexOf(iKeys[j])<0&&"$$hashKey"!=iKeys[j]&&keys.push(iKeys[j]);for(var k=0;k<keys.length;k++)scope.columns.push({modelProp:keys[k],tooltipProp:keys[k],displayName:keys[k][0].toUpperCase()+keys[k].substring(1),headerTooltip:keys[k][0].toUpperCase()+keys[k].substring(1),hidden:k>=scope.columnsDisplayLimit,guid:guid(),ordinal:k,hiddenForCSFn:function(val){return 0==arguments.length?!this.hidden:void(this.hidden=!val)}});var tableColsLength=Math.min(scope.columnsDisplayLimit,scope.columns.length);scope.minWidth&&!isNaN(parseInt(scope.minWidth))&&(scope.tableMinWidth=scope.minWidth*tableColsLength),scope.updateVisibleColumns(),scope.defaultColumns=getColumnsData(),updateDisplayedCollection(newVal),applySortingFilter()}}),scope.gridWidth=0,scope.calcHeaders=function(col){scope.fixHeadersAfterShowHide(),scope.updateColumnAfterChange(col,!0)},scope.updateColumnAfterChange=function(col,saveToStorage){col.hidden&&elem.find('[guid="'+col.guid+'"]').hide();var updateObject={hidden:col.hidden,specialHidden:col.specialHidden};null!=col.ordinal&&(updateObject.ordinal=col.ordinal),updateColumnStoredData(col.guid,updateObject,saveToStorage)},scope.onFinishColumnsSettings=function(isRestore){isRestore&&(window.userPreferences.set(getGridKeyForStorage(scope.gridId),{columns:{}},scope.config.saveUserPreferencesOnSet),element.find(".scrollArea th").attr("style",""),scope.headersWidths={}),scope.fixHeadersAfterShowHide()},scope.fixHeadersAfterShowHide=function(){var previousCols=scope.visibleColumns;scope.updateVisibleColumns();var addDifference,removedDifference;removedDifference=ArrayUtils.difference(previousCols,scope.visibleColumns),addDifference=ArrayUtils.difference(scope.visibleColumns,previousCols),calcCurrentHeadersRealState(),setTimeout(function(){if(null!=removedDifference&&removedDifference.length>0){for(var difLength=removedDifference.length,colEqPercentTotal=0,i=0;difLength>i;i++)scope.headersWidths[removedDifference[i].guid]&&(colEqPercentTotal+=scope.headersWidths[removedDifference[i].guid].percentage,delete scope.headersWidths[removedDifference[i].guid]);var totalRemaining=0;ArrayUtils.each(scope.visibleColumns,function(vc){scope.headersWidths.hasOwnProperty(vc.guid)&&(totalRemaining+=scope.headersWidths[vc.guid].percentage)}),ArrayUtils.each(scope.visibleColumns,function(c){scope.headersWidths.hasOwnProperty(c.guid)&&(scope.headersWidths[c.guid].percentage=colEqPercentTotal*scope.headersWidths[c.guid].percentage/totalRemaining+scope.headersWidths[c.guid].percentage)})}if(null!=addDifference&&addDifference.length>0){var difLength=addDifference.length,colEqPercent=1/scope.visibleColumns.length,remaining=1-colEqPercent*difLength;ObjectUtils.forOwn(scope.headersWidths,function(key,val,obj){obj[key].percentage=remaining*obj[key].percentage});for(var i=0;difLength>i;i++)scope.headersWidths[addDifference[i].guid]={percentage:colEqPercent}}applyHeaderRealState(),fixHeaderWidths(!0),persistWidths(),gridResizer&&gridResizer.setEvents&&gridResizer.setEvents()},0)},scope.checkUncheckAll=function(col){col.headerHandler({value:col.checkAll})},scope.limitBegin=0,scope.paging){scope.lastScrollTop=0,scope.lastScrollLeft=0;var virtualScrollHandlerFn=function(){var scrollTop=$(this).scrollTop(),scrollLeft=$(this).scrollLeft();if(scope.lastScrollTop!=scrollTop){scope.lastScrollTop=scrollTop;var tableContainerHeight=_getScale(scope.tableLogicalContainerStyle.height);scope.safeApply(function(){var limitBegin=Math.floor(scrollTop/tableContainerHeight*scope.displayedDataLength);scope.limitBegin=limitBegin&&!isNaN(limitBegin)?limitBegin:0,limitBegin<scope.displayedDataLength&&(scope.tableCanvasStyle["padding-top"]=limitBegin*scope.rowHeight+"px"),updateRenderedRows(scope.displayedCollection)})}if(scope.lastScrollLeft!=scrollLeft&&(fixHeaderWidths(!0),scope.lastScrollLeft=scrollLeft),element.find("th.locked").length>0){var lockedElemIndex=element.find("th.locked").index()+1,previousElementIndex=element.find("th.locked").index()-1,lockedElemPosLeft=0;if(previousElementIndex>=0){var previousElement=element.find("th.locked").parents("tr").find("th").eq(previousElementIndex);lockedElemPosLeft=previousElement.position().left+previousElement.width()+scrollLeft}scrollLeft>lockedElemPosLeft?(element.find("tr td:nth-child("+lockedElemIndex+")").css({"z-index":5,position:"relative",left:scrollLeft-lockedElemPosLeft+"px",background:"white"}),element.find("tr td:nth-child("+lockedElemIndex+") .td-inner").css({"border-right":"1px solid #9F9F9F"}),element.find("tr td:nth-child("+lockedElemIndex+")").addClass("frozenTd"),element.find("th.locked .th-inner").css({"z-index":5,left:"1px",background:"#f0f0f0"}),element.find("th.locked").addClass("Moved")):element.find("th.locked").hasClass("Moved")&&unfreezeColumn()}};Utils.detectIE()?element.find(".scrollArea").on("scroll",debounce(virtualScrollHandlerFn,10)):scope.useVirtualScroll&&element.find(".scrollArea").on("scroll",virtualScrollHandlerFn),scope.allowGrouping&&element.find(".scrollArea").off("scroll")}scope.onHeaderClick=function($event,col){var currentSelection=scope.api.selectedItems;if(null!=col.modelProp&&!$($event.target).hasClass("checkBoxSpan")&&0!=scope.enableSorting){var orderElem=$($event.currentTarget).parents("th");elem.find(".st-sort-descent").removeClass("st-sort-descent"),elem.find(".st-sort-ascent").removeClass("st-sort-ascent"),scope.orderPredicate==col.modelProp?(scope.orderPredicate="-"+col.modelProp,orderElem.addClass("st-sort-descent")):(scope.orderPredicate=col.modelProp,orderElem.addClass("st-sort-ascent")),updateOrderPredicate(scope.gridId,scope.orderPredicate),applySortingFilter(),currentSelection.length>0&&(scope.selectionPolicy==SelectionPolicyEnum.byId?setTimeout(function(){scope.api.goToItem(scope._getGridItemIndex(currentSelection[0]))},0):setTimeout(function(){scope.api.selectAndGoToItem(scope._getGridItemIndex(currentSelection[0]))},0))}},window.DO&&(scope.DO=window.DO),storeInitialColumnsData(scope.columns,scope.gridId),setTimeout(function(){scope.defaultOrderPredicate=scope.orderPredicate,setDefaultSorting(),null!=scope.orderPredicate&&0!=scope.orderPredicate.length&&applySortingClasses(),scope.showHeader?(fixHeaderWidths(),scope.columnsOrdering&&initColumnReOrdering()):fixHeaderHidden(),1==scope.resizable&&setResizing(),$(elem).find(".scrollArea").css("visibility","visible"),findMaxRowHeight(elem),calcCurrentHeadersRealState(),applyHeaderRealState(),handleHorizontalScroll(elem),scope.api.gridLoaded&&scope.api.gridLoaded(),$(elem).on("click","td",function(event){var elScope=angular.element(this).scope();$timeout(function(){scope.onRowClick.call(elScope,elScope.$parent.rowData,elScope.col,event)})}),$(elem).on("dblclick","td",function(event){var elScope=angular.element(this).scope();$timeout(function(){scope.onRowDblClick.call(elScope,elScope.$parent.rowData,elScope.col,event)})}),$(elem).on("click",".VirtualGroups",function(){$(this).parent().find(".thContent").click()}),$(elem).on("click",".th-inner",function(event){var guid=$(this).parents("th").attr("guid"),col=scope.findColumn("guid",guid);
scope.safeApply(function(){scope.onHeaderClick(event,col)})})},0),scope.getColumnKeyForStorage=getColumnKeyForStorage,elem.on("click",function(){lastTouchedGrid=$(this).attr("guid")});var keyHandler=keyEvents.handler(1).keydown(function(event){var gridInTopLayer=!0,containingModal=elem.parents(".modal"),modals=$(".modal");0!=containingModal.length?gridInTopLayer=containingModal[0]==modals[modals.length-1]:0!=modals.length&&(gridInTopLayer=!1),lastTouchedGrid==elem.attr("guid")&&!event.is.input&&gridInTopLayer&&(event.is.a&&(event.ctrlKey||event.metaKey)?(scope.$applyAsync(scope.selectAll),event.preventDefault()):40==event.keyCode?(scope.$applyAsync(function(){scope.moveSelection(1,event.ctrlKey||event.metaKey)}),event.preventDefault()):38==event.keyCode&&(scope.$applyAsync(function(){scope.moveSelection(-1,event.ctrlKey||event.metaKey)}),event.preventDefault()))});scope.$on("$destroy",function(){removeResizeListener(elem[0],myResizeFn),keyHandler.teardown(),scope.api.internalViews.closeColumnSettings()}),elem.width()>0&&elem.height()>0&&elem.find(".scrollArea").height()>=scope.rowHeight*scope.itemsPerPage&&(scope.itemsPerPage=Math.floor(elem.find(".scrollArea").height()/scope.rowHeight+1)),$compile(element.find(".columnsDef"))(scope.parentCtrl),scope.updateVisibleColumns(),element.find(".columnsDef").remove(),scope.$evalAsync(function(){addResizeListener(elem[0],myResizeFn),scope.defaultColumns=getColumnsData(),applyStoredData(scope.gridId,elem),scope.updateVisibleColumns(),$compile(element)(scope),element.find(".ExpandableRowDef").remove()})}}}}]),gridDirectives.directive("column",[function(){return{restrict:"E",template:"<div></div>",require:"^attGrid",priority:0,terminal:!0,transclude:!0,scope:{displayName:"@",modelProp:"@",cssClass:"@",headerGroup:"@",subHeaderDisplayGroupsGetter:"&subHeaderDisplayGroups",headerType:"@",sortProp:"@",headerHandler:"&",headerDisabled:"&",checkAll:"=?",hiddenGetter:"&hidden",valuesFilterFn:"&",exportHeaderGetter:"&exportHeader",exportFnGetter:"&exportFn"},compile:function(element,attrs,childTranscludeFn){return function(scope,elemnt,attrs,attGridCtrl){scope.$gridTransclude=childTranscludeFn,scope.hidden=scope.hiddenGetter(),scope.exportHeader=scope.exportHeaderGetter(),scope.exportFn=scope.exportFnGetter(),null==attrs.hidden&&(scope.hidden=!1),scope.headerTooltip=null==attrs.headerTooltip?scope.displayName:attrs.headerTooltip,scope.isMandatory="true"==attrs.isMandatory?!0:!1,scope.guid=guid(),null==scope.modelProp&&(scope.modelProp="Column"+elemnt.index()),scope.subHeaderDisplayGroups=scope.subHeaderDisplayGroupsGetter(),scope.hiddenForCSFn=function(val){return 0==arguments.length?!this.hidden:void(this.hidden=!val)},null==scope.tooltipProp&&(scope.tooltipProp=scope.modelProp),scope.specialHidden=!1,attGridCtrl.addColumn(scope)}}}}]),gridDirectives.directive("expandableRow",[function(){return{restrict:"E",template:"<div></div>",require:"^attGrid",priority:0,terminal:!0,transclude:!0,scope:{offset:"=?"},compile:function(element,attrs,childTranscludeFn){return function(scope,elemnt,attrs,attGridCtrl){scope.offset||(scope.offset=0),attGridCtrl.addExpandableRowTransclution(childTranscludeFn,scope.offset)}}}}]),gridDirectives.directive("expandableRowTransclude",["$compile",function($compile){return{link:function(scope,element){scope.$expandableRowTransclude&&scope.$expandableRowTransclude(scope,function(clone,childScope){clone.length&&(element.empty(),element.append($compile(clone)(childScope)))})}}}]),gridDirectives.directive("gridTransclude",["$compile",function($compile){return{link:function(scope,element){function attachTooltipsAndCompile(el,scopeObj){el.attr("att-custom-tooltip",!0),el.attr("strict-text","{{"+buildCellDataString(scopeObj.col.tooltipProp)+"}}"),el.attr("only-if-needed","true"),el.prop("grid-transclude",!1),el.text("{{"+buildCellDataString(scopeObj.col.modelProp)+"}}"),el.removeAttr("grid-transclude"),$compile(el)(scopeObj),scope.noCellBindings}function buildCellDataString(prop){var nested=prop.split("."),str="rowData";if(nested.length>0)for(var i=0;i<nested.length;i++)str+='["'+nested[i]+'"]';else str+='["'+prop+'"]';return str}scope.$evalAsync(function(){null!=scope.col.template?(element.append(scope.col.template),element.prop("grid-transclude",!1),element.removeAttr("grid-transclude"),$compile(element)(scope)):scope.col.$gridTransclude?scope.col.$gridTransclude(scope,function(clone){clone.length?(element.empty(),element.append(clone)):attachTooltipsAndCompile(element,scope)}):attachTooltipsAndCompile(element,scope)})}}}]),gridDirectives.directive("attGridColumnSelection",["$timeout",function(){return{template:"<div class='AttGridColumnsSelection'><div class='ColumnsSelectionHeader'><h3>Show Columns</h3><div style='float: right;margin-right: 5px'><span ng-click='onClose()' class='glyphicons glyphicons-remove-2'></span></div></div><div class='CSBody' style='padding:20px'><div class=\"searchBar\" style='margin-top:15px'><att-search place-holder=\"\"  ng-model=\"csSearch.displayName\"></att-search></div><div class='ColumnsContainer'><ul><li ng-repeat=\"(keyGroup,valueGroup) in columnsData| filter:csSearch | groupBy :'headerGroup'\"><uib-accordion close-others=\"true\" class=\"plusMinusAccordion\"><div uib-accordion-group ng-init='isOpen1= true' is-open='isOpen1' isGroupOpened='{{isOpen1}}' heading=\"{{ (keyGroup==null || keyGroup=='undefined' || keyGroup.length==0)?'General':keyGroup}}\"><ul><li ng-repeat='col in valueGroup ' class='ColumnDataRow'><att-checkbox  ng-model=\"col.hiddenForCSFn\" title='{{col.displayName}}' ng-model-options='{getterSetter:true}' ng-change='onCheckbox(col)' strict-label=\"{{col.displayName}}\"></att-checkbox></li></ul></div></uib-accordion></li></ul></div></div><div class=\"modal-footer\">"+'<button type="button" class="modal-attBtn" tabindex="0" data-ng-click="onClose()">Cancel</button>\n<button type="button" class="modal-attBtn" tabindex="0" data-ng-click="onOk()">Ok</button>\n</div>\n</div>',scope:{columnsData:"=",columns:"=",show:"=?",onChange:"&",onFinish:"&"},link:function(scope,element){scope.onCheckbox=function(col){var visibleColumns=ArrayUtils.filter(scope.columnsData,function(it){return!it.hidden});(0==visibleColumns.length||col.isMandatory)&&(col.hidden=!col.hidden)},scope.onOk=function(){ArrayUtils.each(scope.columnsData,function(colData){var colScope=ArrayUtils.find(scope.columns,function(it){return colData.guid==it.guid});colScope.hidden=colData.hidden,scope.onChange()(colScope)}),scope.onFinish()(),scope.$destroy(),element.remove()},scope.onClose=function(){scope.$destroy(),element.remove()},setTimeout(function(){$(element).find(".AttGridColumnsSelection").movable({attachElementSelector:".ColumnsSelectionHeader"})},0)}}}]),gridDirectives.directive("attGridColumnsSettings",["$filter","keyEvents",function($filter,keyEvents){return{template:"<div class='AttGridColumnsSelection' style='max-width: none;height: 484px;    visibility: hidden;'><div class='ColumnsSelectionHeader  '><span class='modalHeaderStyle' style='font-weight:normal'>Columns Settings</span><div style='float: right;margin-right: 5px'><span ng-click='onClose()' style='margin-top: 6px;' class='glyphicons glyphicons-remove-2'></span></div></div><div class='ColumnsSettingsBody row' style='width: 600px;height: 300px;'><div class='col-md-5' style='padding-left:0'><div class=\"searchBar\"><label>Available Columns</label><att-search place-holder=\"Search\"  ng-model=\"searchAvailable.displayName\"></att-search></div><div class='AvailableColumns ColumnsGroupsSection'><ul><li ng-repeat=\"(keyGroup,valueGroup) in columnsData| groupBy :'headerGroup'\"><uib-accordion close-others=\"true\"   class=\"plusMinusAccordion\"><div uib-accordion-group ng-init='isOpen1= true' is-open='isOpen1' isGroupOpened='{{isOpen1}}' heading=\"{{ (keyGroup==null || keyGroup=='undefined' || keyGroup.length==0)?'General':keyGroup}}\"><ul><li ng-repeat='col in valueGroup| filter:searchAvailable' ng-click='onAvailableClick(col,$event)'  class='ColumnDataRow' ng-class='{active: uiObj.available[col.guid].isActive,disabled:col.specialHidden || !col.hidden}'><label for='col_{{col.guid}}'  title='{{col.displayName}}'>{{col.displayName}}</label></li></ul></div></uib-accordion></li></ul></div></div><div class='buttonsContainer  col-md-2'><button class=\"modal-attBtn showColumns\"  ng-disabled=\"uiObj.isSelectedActive || uiObj.activeColumns.length == 0\"  ng-click='onRightButton()'><span class=\"bootstrapGlyphicon glyphicon-triangle-right\"></span></button><button class=\"modal-attBtn hideColumns\"  ng-disabled=\"!uiObj.isSelectedActive || uiObj.activeColumns.length == 0 || uiObj.isSelectedMandatory\"  ng-click='onLeftButton()'><span class=\"bootstrapGlyphicon glyphicon-triangle-left\"></span></button><button style=\"margin-top:65px;\" class=\"modal-attBtn upButton\"  ng-disabled=\"!uiObj.isSelectedActive || uiObj.activeColumns.length != 1\"  ng-click='onUpButton()'><span class=\"bootstrapGlyphicon glyphicon-triangle-top\"></span></button><button class=\"modal-attBtn downButton\"  ng-disabled=\"!uiObj.isSelectedActive || uiObj.activeColumns.length != 1\"  ng-click='onDownButton()'><span class=\"bootstrapGlyphicon glyphicon-triangle-bottom\"></span></button></div><div class='col-md-5' style='padding-right:0'><div class=\"searchBar\"><label>Selected Columns</label><att-search place-holder=\"Search\" ng-model-options=\"{debounce:100}\" ng-model=\"searchSelected.displayName\"></att-search></div><div class='SelectedColumnsContainer ColumnsGroupsSection'><ul><li ng-repeat=\"(keyGroup,valueGroup) in columnsData| groupBy :'headerGroup'\" class='GroupLiContainer'><uib-accordion close-others=\"true\" class=\"plusMinusAccordion\"><div uib-accordion-group ng-init='isOpen1= true' is-open='isOpen1' isGroupOpened='{{isOpen1}}' heading=\"{{ (keyGroup==null || keyGroup=='undefined' || keyGroup.length==0)?'General':keyGroup}}\"><ul><li ng-repeat='col in valueGroup|filter:searchSelected' ng-if='!col.hidden && !col.specialHidden' ng-click='onSelectedClick(col,$event)'  class='ColumnDataRow' ng-class='{active: uiObj.selected[col.guid].isActive,MandatoryColumn:col.isMandatory}'><label ng-if='col.isMandatory' class='MandatoryAsterisk'>*</label><label ng-init=\"uiObj.groups[keyGroup]=true\" for='col_{{col.guid}}' title='{{ col.displayName + (col.isMandatory?\" (mandatory)\":\"\")}}'>{{ col.displayName}}</label></li></ul></div></uib-accordion></li></ul></div>"+'<div class=\'ActionsContainer\'><button style=\'width:100%\' class="modal-attBtn" type="button"  tabindex="0" data-ng-click="onRestoreDefaults()">Restore Defaults</button></div></div></div><div class="modal-footer"><button type="button" class="modal-attBtn CancelButton" tabindex="0" data-ng-click="onClose()">Cancel</button>\n<button type="button" class="modal-attBtn OKButton" tabindex="0" data-ng-click="onOk()">OK</button>\n</div>\n</div>',scope:{columns:"=",columnsData:"=",defaultColumns:"=",onChange:"&",onFinish:"&"},link:function(scope,element){$("body").append('<div class="overlay columnsSelectionOverlay" style="z-index: 1095;top:0"></div>');var rejectEl=function(el){var $el=$(el);return!$el.hasClass("disabled")};scope.columnsData=$filter("orderBy")(scope.columnsData,"ordinal"),scope.isRestored=!1,scope.uiObj={available:{},selected:{},groups:{},isSelectedActive:!1,activeColumns:[]},scope.onAvailableClick=function(col,$event){scope.uiObj.selected={},scope.uiObj.isSelectedActive=!1,scope.onSelection(col,"available",$event)},scope.onSelectedClick=function(col,$event){scope.uiObj.available={},scope.uiObj.isSelectedActive=!0,scope.onSelection(col,"selected",$event)},scope.onSelection=function(col,_for,$event){var colSelVal=!1;scope.uiObj.isSelectedMandatory=col.isMandatory,$event.ctrlKey||$event.metaKey?colSelVal=!scope.uiObj[_for][col.guid]||!scope.uiObj[_for][col.guid].isActive:(scope.uiObj[_for]={},colSelVal=!0),colSelVal?(null==scope.uiObj[_for][col.guid]&&(scope.uiObj[_for][col.guid]={}),scope.uiObj[_for][col.guid].isActive=colSelVal,scope.uiObj[_for][col.guid].col=col):delete scope.uiObj[_for][col.guid],scope.uiObj.activeColumns=[],ObjectUtils.forOwn(scope.uiObj[_for],function(key,val){val.isActive&&scope.uiObj.activeColumns.push(val.col)})},scope.goToNextCol=function(){var activeEl=element.find("li.active:last");try{var nextIndex,nextEl,columnsLiList=$($.grep(activeEl.closest("ul").find("li.ColumnDataRow"),rejectEl)),elementIndex=columnsLiList.index(activeEl),isLastChild=columnsLiList.length-1==elementIndex,isOnlyChild=1==columnsLiList.length;if(isLastChild&&isOnlyChild){var lisCollection=$($.grep(activeEl.parents(".ColumnsGroupsSection").find("li.ColumnDataRow"),rejectEl)),indexInCollection=lisCollection.index(activeEl);nextEl=lisCollection.length-1==indexInCollection?lisCollection[indexInCollection-1]:lisCollection[indexInCollection+1],nextEl=angular.element(nextEl)}else nextIndex=isLastChild&&!isOnlyChild?elementIndex-1:elementIndex+1,nextEl=$($.grep(activeEl.parent().find("li.ColumnDataRow"),rejectEl)).eq(nextIndex);var container=activeEl.parents(".ColumnsGroupsSection"),elementTop=nextEl.offset().top,containerTop=container.offset().top,containerScroll=container.scrollTop();(containerTop>elementTop||containerTop+container.height()<elementTop)&&container.scrollTop(elementTop-containerTop+containerScroll),setTimeout(function(){nextEl.click()},0)}catch(e){}},scope.onClose=function(){scope.$destroy(),element.remove()},scope.onOk=function(){var ind=0;ArrayUtils.each(scope.columnsData,function(colData){var colScope=ArrayUtils.find(scope.columns,function(it){return colData.guid==it.guid});colScope.hidden!=colData.hidden&&(colScope.hidden=colData.hidden),colScope.ordinal=ind,ind++,scope.onChange()(colScope)}),scope.onFinish()(scope.isRestored),scope.$destroy(),element.remove()},scope.onLeftButton=function(){ArrayUtils.each(scope.uiObj.activeColumns,function(it){var visCols=scope.getVisibleColumnsData();!it.isMandatory&&visCols.length>1&&(it.hidden=!0)}),1==scope.uiObj.activeColumns.length?scope.goToNextCol():scope.uiObj.selected={},scope.uiObj.activeColumns=[]},scope.onRightButton=function(){ArrayUtils.each(scope.uiObj.activeColumns,function(it){it.hidden=!1}),1==scope.uiObj.activeColumns.length?scope.goToNextCol():scope.uiObj.available={},scope.uiObj.activeColumns=[]},scope.onUpButton=function(){var activeEl=element.find("li.active:last"),columnsLiList=$($.grep(activeEl.closest("ul").find("li.ColumnDataRow"),rejectEl)),elementIndex=columnsLiList.index(activeEl);if(1==scope.uiObj.activeColumns.length&&0!=elementIndex)try{var column=scope.uiObj.activeColumns[0],columnIndex=ArrayUtils.indexOfByProperty(scope.columnsData,"guid",column.guid),visCol=scope.getVisibleColumnsData(),colIndexInVis=ArrayUtils.indexOfByProperty(visCol,"guid",column.guid),nextColInVis=visCol[colIndexInVis-1],newIndex=ArrayUtils.indexOfByProperty(scope.columnsData,"guid",nextColInVis.guid);scope.columnsData.splice(columnIndex,1),scope.columnsData.splice(newIndex,0,column)}catch(e){}},scope.onDownButton=function(){var activeEl=element.find("li.active:last"),columnsLiList=$($.grep(activeEl.closest("ul").find("li.ColumnDataRow"),rejectEl)),elementIndex=columnsLiList.index(activeEl),isLastChild=columnsLiList.length-1==elementIndex;if(1==scope.uiObj.activeColumns.length&&!isLastChild)try{var column=scope.uiObj.activeColumns[0],columnIndex=ArrayUtils.indexOfByProperty(scope.columnsData,"guid",column.guid),visCol=scope.getVisibleColumnsData(),colIndexInVis=ArrayUtils.indexOfByProperty(visCol,"guid",column.guid),nextColInVis=visCol[colIndexInVis+1],newIndex=ArrayUtils.indexOfByProperty(scope.columnsData,"guid",nextColInVis.guid);scope.columnsData.splice(columnIndex,1),scope.columnsData.splice(newIndex,0,column)}catch(e){}},scope.onRestoreDefaults=function(){scope.isRestored=!0,scope.columnsData.splice(0,scope.columnsData.length),scope.columnsData=ObjectUtils.deepClone(scope.defaultColumns).map(function(col){return col.specialHidden&&(col.hidden=!0),col})},scope.getVisibleColumnsData=function(){return ArrayUtils.filter(scope.columnsData,function(itar){return!itar.hidden})};var keyHandler=keyEvents.handler(1).keydown(function(event){13==event.keyCode?element.find(".OKButton").click():event.is.esc&&element.find(".CancelButton").click()});scope.$on("$destroy",function(){setTimeout(function(){keyHandler.teardown()},0),$(".columnsSelectionOverlay").remove()}),setTimeout(function(){$(element).find(".AttGridColumnsSelection").movable({attachElementSelector:".ColumnsSelectionHeader"}),$(element).find(".AttGridColumnsSelection").css("visibility","visible"),$(element).find(".OKButton").addClass("EnterCommand")},0)}}}]),gridServices.directive("attGridValuesFilter",[function(){return{strict:"A",template:'<div class="GridValuesFilter"><div class="filter"><input ng-model="filterValsBy" /></div><div class="list"><ul><li ng-repeat="val in column.values | filter : filterValsBy "><input id=\'val_{{::$index}}\' type=\'checkbox\' ng-model="val.show" \'/><label for=\'val_{{::$index}}\'>{{val.display}}</label></li></ul></div><div class="modal-footer"><button type="button" class="modal-attBtn" tabindex="0" data-ng-click="onClose()">OK</button>\n</div>\n</div>',scope:{column:"=",gridData:"=",onFilterFn:"&"},link:function(scope,elem){if(null==scope.column.values){var values=null,valuesObj={};if(null!=scope.column.valuesFilterFn())values=ArrayUtils.map(scope.column.valuesFilterFn()(),function(it){return{show:!0,display:it}});else{values=[];var displayProp=scope.column.modelProp;ArrayUtils.each(scope.gridData,function(itar){null==valuesObj[itar[displayProp]]&&(values.push({show:!0,display:itar[displayProp]}),valuesObj[itar[displayProp]]=itar[displayProp])})}scope.column.values=values}scope.onClose=function(){scope.onFilterFn()(ArrayUtils.filter(scope.gridData,function(it){var inVals=ArrayUtils.find(scope.column.values,function(itaretor){return it[scope.column.modelProp]==itaretor.display});return null!=inVals&&inVals.show})),scope.$destroy(),elem.remove()}}}}]),gridDirectives.directive("mRepeat",function(){return{transclude:"element",compile:function(element,attr,linker){return function($scope,$element,$attr){function appendWithOnScopeEvalAsync(scope,parent,el){scope.$applyAsync(function(){parent.append(el)})}var myLoop=$attr.mRepeat,match=myLoop.match(/^\s*(.+)\s+in\s+(.*?)\s*(\s+track\s+by\s+(.+)\s*)?$/),indexString=match[1],collectionString=match[2],parent=$element.parent(),elements=[];$scope.$watch(collectionString,function(collection){var i,block,childScope;if(elements.length>0){for(i=0;i<elements.length;i++)elements[i].el.remove(),elements[i].scope.$destroy();elements=[]}for(i=0;i<collection.length;i++)childScope=$scope.$new(),childScope[indexString]=collection[i],linker(childScope,function(clone){appendWithOnScopeEvalAsync($scope,parent,clone),block={},block.el=clone,block.scope=childScope,elements.push(block)})})}}}}),gridDirectives.directive("slyRepeat",["$animate","$parse",function($animate){return{restrict:"A",scope:!0,transclude:"element",priority:1e3,terminal:!0,compile:function(element,attr,linker){return function($scope,$element,$attr){var expression=$attr.slyRepeat,match=expression.match(/^\s*(.+)\s+in\s+(.*?)$/);if(!match)throw Error("Expected slyRepeat in form of '_item_ in _collection_' but got '"+expression+"'.");var iterVar=match[1],collectionExpr=match[2];if(match=iterVar.match(/^(?:([\$\w]+))$/),!match)throw Error("'item' in 'item in collection' should be identifier but got '"+lhs+"'.");var previousElements=[],previousElementBuffer=[],deregisterCallback=$scope.$watch(collectionExpr,function(collection){function appendWithApplyQueue(scope,parent,element){scope.$evalAsync(function(){parent.append(element)})}if(collection){if(!ObjectUtils.isKind(collection,"Array"))throw Error("'collection' did not evaluate to an array.  expression was "+collectionExpr);var originalPreviousElementsLength=previousElements.length;if(previousElements.length<collection.length&&previousElementBuffer.length>0){var limit=previousElements.length+previousElementBuffer.length;limit>collection.length&&(limit=collection.length),previousElements=previousElements.concat(previousElementBuffer.splice(0,limit-previousElements.length))}var currentElements=null,currentElementBuffer=[],newElements=[];if(collection.length>previousElements.length){for(var i=previousElements.length;i<collection.length;++i){var newElement={scope:$scope.$new(),isActiveForRepeat:!0};newElement.scope.$index=i,newElement.scope.$first=0==i,newElements.push(newElement)}currentElements=previousElements.concat(newElements),currentElementBuffer=previousElementBuffer}else if(collection.length<previousElements.length){for(var i=collection.length;i<previousElements.length;++i)previousElements[i].isActiveForRepeat=!1;currentElementBuffer=previousElements.splice(collection.length,previousElements.length-collection.length).concat(previousElementBuffer),currentElements=previousElements}else currentElements=previousElements,currentElementBuffer=previousElementBuffer;if(currentElements.length>0){var firstIndexToFix=currentElements.length-1,lastIndexToFix=currentElements.length-1;originalPreviousElementsLength<currentElements.length&&(firstIndexToFix=originalPreviousElementsLength),firstIndexToFix>0&&(firstIndexToFix-=1);for(var i=firstIndexToFix;lastIndexToFix>=i;++i)currentElements[i].scope.$last=i==currentElements.length-1,currentElements[i].scope.$middle=0!=i&&i!=currentElements.length-1,currentElements[i].isActiveForRepeat||(currentElements[i].isActiveForRepeat=!0,currentElements[i].element.css("display",""))}for(var i=0;i<currentElementBuffer.length&&!currentElementBuffer[i].isActiveForRepeat;++i)currentElementBuffer[i].element.css("display","none");for(var i=0;i<currentElements.length;++i)currentElements[i].scope[iterVar]=collection[i];var prevElement=$element,$parent=$element.parent();previousElements.length>0&&(prevElement=previousElements[previousElements.length-1].element);for(var i=0;i<newElements.length;++i)linker(newElements[i].scope,function(clone){appendWithApplyQueue($scope,$parent,clone),prevElement=clone,newElements[i].element=clone});previousElements=currentElements,previousElementBuffer=currentElementBuffer}});$scope.$on("$destroy",function(){deregisterCallback()})}}}}]),gridServices.filter("gridOrderBy",["$filter",function($filter){return function(items,predicate,secondarySortProp){if("undefined"==predicate||null==predicate||0==predicate.length)return items;var tmpPredicate=predicate;return null!=secondarySortProp&&predicate.replace("-","")!=secondarySortProp.replace("-","")&&(tmpPredicate=[predicate,secondarySortProp]),$filter("attOrderBy")(items,tmpPredicate)}}]),gridServices.filter("gridDisplayedColumns",["$filter",function(){return function(items){function compare(a,b){return a.ordinal<b.ordinal?-1:a.ordinal>b.ordinal?1:0}return ArrayUtils.filter(items,function(it){return!it.hidden}).sort(compare)}}]),gridServices.filter("gridRowsFilter",["$filter",function($filter){return function(items,columns,filterPredicate,preDefinedSearchColumns){var cols=ArrayUtils.map(ArrayUtils.filter(columns,function(it){return!it.hidden}),function(ir){return ir.modelProp});if(null!=filterPredicate){if(ObjectUtils.isKind(filterPredicate,"Object"))return $filter("filter")(items,filterPredicate);var delimeterIndex=filterPredicate.indexOf(":");if(delimeterIndex>0){var searchCol=filterPredicate.substring(0,delimeterIndex),searchTerm=filterPredicate.substring(delimeterIndex+1,filterPredicate.length),findCol=ArrayUtils.find(columns,function(itar){return itar.displayName.toLowerCase()==searchCol.toLowerCase()});if(null!=findCol)return cols=[findCol.modelProp],filterPredicate=searchTerm.trim(),$filter("attFilterBy")(items,cols,filterPredicate)}}return $filter("attFilterBy")(items,preDefinedSearchColumns||cols,filterPredicate)}}]),gridServices.filter("gridLimitFilter",[function(){return function(input,limit,begin){return limit=1/0===Math.abs(Number(limit))?Number(limit):parseInt(limit),isNaN(limit)?input:(isNumber(input)&&(input=input.toString()),Array.isArray(input)||isString(input)?(begin=!begin||isNaN(begin)?0:parseInt(begin),begin=0>begin&&begin>=-input.length?input.length+begin:begin,limit>=0?input.slice(begin,begin+limit):0===begin?input.slice(limit,input.length):input.slice(Math.max(0,begin+limit),begin)):input)}}]);var staticTemplate="<div class='ATTGridControl '><div style='display: none' class='columnsDef'></div>\n <table class='table attGrid'><thead ng-if=\"showHeader\">\n<tr class='HeaderTr'>\n<th ng-repeat='col in columns' ng-if=\"!col.hidden\" class='headerTH {{col.cssClass}}'><div class='thContent'>{{col.displayName}}</div></th>\n</tr>\n</thead>\n<tbody>\n<tr ng-repeat='rowData in data'><td ng-if=\"!col.hidden\" ng-repeat='col in columns' ><div class='td-inner'><div class='td-content' grid-transclude >{{rowData[col.modelProp]}}</div></div> </td></tr></tbody>\n</table></div>",tdRepeater="<td m-repeat='col in visibleColumns track by col.guid' ><div class='td-inner'><div class='td-content' grid-transclude ></div></div></td>\n",rowsRepeaterTemplate='<tr sly-repeat="rowData in renderedRows {0}"  att-context-menu ctx-menu-aslo-click="false" menu-data="onRowContextMenu" el-data="rowData" class=\'DataRow {{additionalUIData.rowClasses[rowData[identifier]]}}\' ng-class="{active:({1})}">\n'+tdRepeater+"</tr>\n",ngRowsRepeaterTemplate='<tr ng-repeat="rowData in displayedCollection {1} | gridLimitFilter:itemsPerPage:limitBegin {0}"  att-context-menu ctx-menu-aslo-click="false" menu-data="onRowContextMenu" el-data="rowData" class=\'DataRow {{additionalUIData.rowClasses[rowData[identifier]]}}\' ng-class="{active:({2})}">\n'+tdRepeater+"</tr>\n",rowsHirercalRepeaterTemplate='<tr ng-repeat-start="rowData in displayedCollection | gridLimitFilter:itemsPerPage:limitBegin {0}"  att-context-menu ctx-menu-aslo-click="false" menu-data="onRowContextMenu" el-data="rowData" class=\'DataRow {{additionalUIData.rowClasses[rowData[identifier]]}}\' ng-class="{active:({3})}">\n'+"<td class='parentTD''><div ng-if='{2}'><span ng-click='onExpandCollapse(rowData)' class='bootstrapGlyphicon' ng-class='{\"glyphicon-minus\":additionalUIData.treeDataExpanded[rowData[identifier]],\"glyphicon-plus\":!additionalUIData.treeDataExpanded[rowData[identifier]]}'></span></div></td>"+tdRepeater+"</tr>\n<tr ng-repeat-end ng-if='additionalUIData.treeDataExpanded[$parent.rowData[identifier]]' ng-repeat='rowData in rowData.{1}'><td  ng-class='{ChildTD:!$last}'></td>"+tdRepeater+"</tr>",groupRowsRepeater="<tr ng-repeat-start=\"(key,value) in displayedCollection |  groupBy: groupByProp \" ng-if=\"groupByProp.length!=0\"><td colspan='{{columns.length}}' class='ContentGroupKey'>{{key}}</td></tr><tr ng-repeat-end ng-repeat=\"rowData in value | orderBy:orderPredicate {0}\"  class='DataRow'  ng-class=\"{active:{1}}\">\n<td ng-repeat='col in visibleColumns'  class='{{col.cssClass}}' ng-dblclick=\"onRowDblClick(rowData,col)\" ng-click='onRowClick(rowData,col,$event)'><div class='td-inner'><div class='td-content' grid-transclude >{{rowData[col.modelProp]}}</div></div></td>\n</tr>\n",rowsExpandableRepeaterTemplate="<tr ng-repeat-start=\"rowData in displayedCollection | limitTo:itemsPerPage:limitBegin {0}\" class='DataRow {{additionalUIData.rowClasses[rowData[identifier]]}}'  ng-class=\"{active:{1}\">\n<td  ng-if=\"showExpandButton\" class='ExpandButtonContainer' ><button class='GridExpandButtonStyle' ng-click=\"toggleExpand(rowData,$index)\"><span class=\"glyphicon\" ng-class=\"{'glyphicon-triangle-right':!isRowExpanded(rowData,$index),'glyphicon-triangle-bottom':isRowExpanded(rowData,$index)}\"></span></button></td>\n<td ng-repeat='col in visibleColumns'  class='{{col.cssClass}}' ng-dblclick=\"onRowDblClick(rowData,col)\" ng-click='onRowClick(rowData,col,$event)'><div class='td-inner'><div class='td-content' grid-transclude >{{rowData[col.modelProp]}}</div></div></td>\n</tr>\n<tr ng-repeat-end ng-if=\"isRowExpanded(rowData,$index)\" >\n<td ng-repeat='i in getOffsetNumber() track by $index'></td><td colspan='{{columns.length - offset}}' expandable-row-transclude></td></tr>\n",gridBasicTemplate2="<div class='ATTGridControl'  >\n<div style='display: none' class='columnsDef'></div>\n<div style='display: none' class='ExpandableRowDef'></div>\n<div class=\"scrollableContainer2\">\n<div ng-if=\"showHeader\" class=\"headerSpacer\"></div>\n<div class=\"scrollArea\" id='scrollAreaID' style='visibility: hidden' ><div class=\"tableLogicalContainer\" ng-style='tableLogicalContainerStyle'><div class=\"tableCanvas\" ng-style='tableCanvasStyle'><table  class=\"table attGrid DataTable\">\n<thead ng-if=\"showHeader\">\n<tr class='HeaderTr'>\n<th ng-if=\"showExpandButton\" class='ExpandButtonContainer'></th>\n<th ng-if=\"isTree\" class='ExpandButtonContainer'></th>\n<th ng-repeat='col in visibleColumns' class='headerTH {{col.cssClass}}' rel=\"{{::col.modelProp}}\" guid=\"{{::col.guid}}\" group-def=\"{{col.headerGroup}}\" virtual-sub-groups='{{::col.subHeaderDisplayGroups}}' ng-style='col.style' att-context-menu ctx-menu-aslo-click=\"false\" menu-data=\"::headersCtxMenu\" el-data=\"::col\"><div ng-if=\"col.headerType==undefined || col.headerType=='text' \" class='thContent' att-custom-tooltip strict-text='{{col.headerTooltip}}'>{{col.displayName}}</div><div ng-if=\"col.headerType=='checkbox' \" style=\"padding-left: 2px \" class='thContent'><att-checkbox ng-model='col.checkAll' ng-change='checkUncheckAll(col)' ng-class=\"{disabled : col.headerDisabled()}\"  ng-disabled='col.headerDisabled()'></att-checkbox><span class='checkBoxHeaderText'>{{col.displayName}}</span></div></th>\n</tr>\n</thead>\n<tbody ng-class='{AllSelected:allSelected}' {1}>\n{0}</tbody>\n</table><div ng-if='displayedCollection.length==0 &&filtered' class='EmptyResultMessageContainer'><p>{2}</p></div></div></div></div>\n</div>\n</div>\n";!function(){function resizeListener(e){var win=e.target||e.srcElement;win.__resizeRAF__&&cancelFrame(win.__resizeRAF__),win.__resizeRAF__=requestFrame(function(){var trigger=win.__resizeTrigger__;trigger.__resizeListeners__.forEach(function(fn){fn.call(trigger,e)})})}function objectLoad(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",resizeListener)}var attachEvent=document.attachEvent,isIE=navigator.userAgent.match(/Trident/),requestFrame=function(){var raf=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(fn){return window.setTimeout(fn,20)};return function(fn){return raf(fn)}}(),cancelFrame=function(){var cancel=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(id){return cancel(id)}}();window.addResizeListener=function(element,fn){if(element&&element.tagName&&0!=element.tagName.length&&!element.__resizeListeners__){if(element.__resizeListeners__=[],attachEvent)element.__resizeTrigger__=element,element.attachEvent("onresize",resizeListener);else{"static"==getComputedStyle(element).position&&(element.style.position="relative");var obj=element.__resizeTrigger__=document.createElement("object");obj.setAttribute("style","display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; pointer-events: none; z-index: -1;opacity:0;"),obj.__resizeElement__=element,obj.onload=objectLoad,obj.type="text/html",isIE&&element.appendChild(obj),obj.data="about:blank",isIE||element.appendChild(obj)}element.__resizeListeners__.push(fn)}},window.removeResizeListener=function(element,fn){element&&element.__resizeListeners__&&(element.__resizeListeners__.splice(element.__resizeListeners__.indexOf(fn),1),element.__resizeListeners__.length||(attachEvent?element.detachEvent("onresize",resizeListener):(element.__resizeTrigger__&&element.__resizeTrigger__.contentDocument&&element.__resizeTrigger__.contentDocument.defaultView&&element.__resizeTrigger__.contentDocument.defaultView.removeEventListener("resize",resizeListener),element.__resizeTrigger__=!element.removeChild(element.__resizeTrigger__))))
}}()}(angular);
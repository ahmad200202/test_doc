!function(){!function(){var that,ServerSettingsService,server,TaskService,DatabasesService,__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),"throw":verb(1),"return":verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g},__spreadArrays=this&&this.__spreadArrays||function(){for(var s=0,i=0,il=arguments.length;il>i;i++)s+=arguments[i].length;for(var r=Array(s),k=0,i=0;il>i;i++)for(var a=arguments[i],j=0,jl=a.length;jl>j;j++,k++)r[k]=a[j];return r},injections=["ServerSettingsService","server","TaskService","DatabasesService"],createService=function(_ServerSettingsService,_server,_TaskService,_DatabasesService){return ServerSettingsService=_ServerSettingsService,server=_server,TaskService=_TaskService,DatabasesService=_DatabasesService,that=new FeatureFlagService},FeatureFlagModule=angular.module("attCommon.featureFlagModule",[]);FeatureFlagModule.factory("FeatureFlagService",__spreadArrays(injections,[createService]));var attCommonServices=angular.module("attCommon.attCommonServices"),FeatureFlagService=function(){function FeatureFlagService(){}return FeatureFlagService.prototype.isFeatureFlagEnabled=function(ffName,ffLevels,serverName,taskName,endPointName,acceptEmptyName){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r,_s,_t,_u,_v,_w,_x,_y,_z,_0,_1;return void 0===acceptEmptyName&&(acceptEmptyName=!1),__awaiter(this,void 0,void 0,function(){var resultServerFF,resultTaskFF,resultEPFF,shouldLoadServerFF,serverFF,shouldLoadTaskFF,taskFF,endpointDBDef,epFF,result,ex_1;return __generator(this,function(_2){switch(_2.label){case 0:if(_2.trys.push([0,10,,11]),0==ffName.length&&acceptEmptyName)return[2,!0];if(resultServerFF=void 0,resultTaskFF=void 0,resultEPFF=void 0,console.debug("isFeatureFlagEnabled: name:'"+ffName+", levels:'"+ffLevels+"', "+(serverName?"server: "+serverName:"")+" "+(taskName?"task: "+taskName:"")+" "+(endPointName?"endpoint: "+endPointName:"")),ffLevels.indexOf("server")<0&&ffLevels.indexOf("task")<0&&ffLevels.indexOf("endpoint")<0)throw"feature-flag-levels should contains one or some of 'server', 'task' or 'endpoint'. Got '"+ffLevels+"'";if(!(ffLevels.indexOf("server")>=0))return[3,3];if(!serverName&&!server.Name)throw"server name wasn't specified";return shouldLoadServerFF=!1,serverName&&serverName!==server.Name||(null===(_b=null===(_a=ServerSettingsService.data.replication_environment)||void 0===_a?void 0:_a.rep_env)||void 0===_b?!0:!_b.feature_flag_values)?(attCommonServices.value("server",{Name:serverName}),console.debug("server '"+server.Name+"' FF wasn't found. loading its FF..."),[4,ServerSettingsService.REQ_GetReplicationEnvironment()]):[3,2];case 1:_2.sent(),_2.label=2;case 2:serverFF=null===(_e=null===(_d=null===(_c=ServerSettingsService.data.replication_environment)||void 0===_c?void 0:_c.rep_env)||void 0===_d?void 0:_d.feature_flag_values)||void 0===_e?void 0:_e.find(function(ff){return ff.name===ffName}),serverFF?resultServerFF=serverFF.array_values&&serverFF.array_values[0]:console.debug("server '"+server.Name+"' doesn't hold FF '"+ffName+"'"),_2.label=3;case 3:if(!(ffLevels.indexOf("task")>=0))return[3,6];if(!taskName&&!(null===(_h=null===(_g=null===(_f=TaskService.data)||void 0===_f?void 0:_f.currentFullTask)||void 0===_g?void 0:_g.task)||void 0===_h?void 0:_h.name))throw"task name wasn't specified";return shouldLoadTaskFF=!1,taskName&&taskName!==(null===(_l=null===(_k=null===(_j=TaskService.data)||void 0===_j?void 0:_j.currentFullTask)||void 0===_k?void 0:_k.task)||void 0===_l?void 0:_l.name)||(null===(_q=null===(_p=null===(_o=null===(_m=TaskService.data)||void 0===_m?void 0:_m.currentFullTask)||void 0===_o?void 0:_o.task_settings)||void 0===_p?void 0:_p.common_settings)||void 0===_q?!0:!_q.feature_flag_values)?(console.debug("task FF wasn't found. loading its FF..."),[4,TaskService.getTaskSettings(taskName)]):[3,5];case 4:_2.sent(),_2.label=5;case 5:taskFF=null===(_v=null===(_u=null===(_t=null===(_s=null===(_r=TaskService.data)||void 0===_r?void 0:_r.currentFullTask)||void 0===_s?void 0:_s.task_settings)||void 0===_t?void 0:_t.common_settings)||void 0===_u?void 0:_u.feature_flag_values)||void 0===_v?void 0:_v.find(function(ff){return ff.name===ffName}),resultTaskFF=null===taskFF||void 0===taskFF?void 0:taskFF.array_values[0],taskFF||console.debug("task '"+(null===(_y=null===(_x=null===(_w=TaskService.data)||void 0===_w?void 0:_w.currentFullTask)||void 0===_x?void 0:_x.task)||void 0===_y?void 0:_y.name)+"' doesn't hold FF '"+ffName+"'"),_2.label=6;case 6:if(!(ffLevels.indexOf("endpoint")>=0))return[3,9];if(!endPointName)throw"endpoint name wasn't specified";return(endpointDBDef=null===(_z=DatabasesService.data.databases)||void 0===_z?void 0:_z.find(function(db){return db.model.name===endPointName}))?[3,8]:(console.debug("FF: endpoint data wasn't loaded ye. loading its FF..."),[4,DatabasesService.REQ_GetDatabases()]);case 7:_2.sent(),endpointDBDef=null===(_0=DatabasesService.data.databases)||void 0===_0?void 0:_0.find(function(db){return db.model.name===endPointName}),endpointDBDef||console.error("Endpoint '"+endPointName+"' couldn't be loaded"),_2.label=8;case 8:epFF=null===(_1=null===endpointDBDef||void 0===endpointDBDef?void 0:endpointDBDef.model.feature_flag_values)||void 0===_1?void 0:_1.find(function(ff){return ff.name===ffName}),resultEPFF=null===epFF||void 0===epFF?void 0:epFF.array_values[0],epFF||console.debug("endpoint '"+endPointName+"' doesn't hold FF '"+ffName+"'"),_2.label=9;case 9:return result=void 0,resultTaskFF?result="1"===resultTaskFF:resultEPFF?result="1"===resultEPFF:resultServerFF&&(result="1"===resultServerFF),void 0===result&&(result=!1),console.debug("FF found for FF name '"+ffName+"', levels='"+ffLevels+"' of: "+((ffLevels.indexOf("server")>=0?"serverFF="+resultServerFF:"")+" ")+((ffLevels.indexOf("task")>=0?"taskFF="+resultTaskFF:"")+" ")+((ffLevels.indexOf("endpoint")>=0?"endpointFF="+resultEPFF:"")+". ==result== "+result)),[2,result];case 10:return ex_1=_2.sent(),console.error("",ex_1),[3,11];case 11:return[2]}})})},FeatureFlagService}();FeatureFlagModule.directive("featureFlag",["FeatureFlagService","server",function(FeatureFlagService){function worker(element,scope,ffName,ffLevels,ffServer,ffTask,ffEP,acceptEmptyName){var _this=this;void 0===acceptEmptyName&&(acceptEmptyName=!1),function(){return __awaiter(_this,void 0,void 0,function(){var isFFEnabled;return __generator(this,function(_a){switch(_a.label){case 0:return[4,FeatureFlagService.isFeatureFlagEnabled(ffName,ffLevels,ffServer,ffTask,ffEP,acceptEmptyName)];case 1:return isFFEnabled=_a.sent(),setTimeout(function(){return isFFEnabled?onAccept(element,scope):onReject(element,scope)}),[2]}})})}()}function onReject(element,scope){scope.$apply(function(){return element.hide()})}function onAccept(element,scope){scope.$apply(function(){return element.show()})}return{restrict:"A",scope:!1,link:function(scope,element,attrs){var _this=this,ffName=attrs.featureFlagName,ffLevels=attrs.featureFlagLevels,ffServer=attrs.featureFlagServer,ffTask=attrs.featureFlagTask,ffEP=attrs.featureFlagEndpoint,acceptEmptyName=attrs.acceptEmptyName;!function(){return __awaiter(_this,void 0,void 0,function(){var _this=this;return __generator(this,function(){return setTimeout(function(){return onReject(element,scope)},0),worker(element,scope,ffName,ffLevels,ffServer,ffTask,ffEP,acceptEmptyName),scope.intervalHnd=setInterval(function(){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(){return worker(element,scope,ffName,ffLevels,ffServer,ffTask,ffEP,acceptEmptyName),[2]})})},1e3),[2]})})}(),scope.$on("$destroy",function(){clearInterval(scope.intervalHnd)})}}}])}()}();
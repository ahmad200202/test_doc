(function(){var callWithJQuery;(callWithJQuery=function(pivotModule){return"object"==typeof exports&&"object"==typeof module?pivotModule(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],pivotModule):pivotModule(jQuery)})(function($){var makeGoogleChart;return makeGoogleChart=function(chartType,extraOptions){return function(pivotData,opts){var agg,base,base1,colKey,colKeys,dataArray,dataTable,defaults,fullAggName,groupByTitle,h,hAxisTitle,headers,i,j,len,len1,numCharsInHAxis,options,ref,result,row,rowKey,rowKeys,title,tree2,vAxisTitle,val,wrapper,x,y;if(defaults={localeStrings:{vs:"vs",by:"by"},gchart:{}},opts=$.extend(!0,{},defaults,opts),null==(base=opts.gchart).width&&(base.width=window.innerWidth/1.4),null==(base1=opts.gchart).height&&(base1.height=window.innerHeight/1.4),rowKeys=pivotData.getRowKeys(),0===rowKeys.length&&rowKeys.push([]),colKeys=pivotData.getColKeys(),0===colKeys.length&&colKeys.push([]),fullAggName=pivotData.aggregatorName,pivotData.valAttrs.length&&(fullAggName+="("+pivotData.valAttrs.join(", ")+")"),headers=function(){var i,len,results;for(results=[],i=0,len=rowKeys.length;len>i;i++)h=rowKeys[i],results.push(h.join("-"));return results}(),headers.unshift(""),numCharsInHAxis=0,"ScatterChart"===chartType){dataArray=[],ref=pivotData.tree;for(y in ref){tree2=ref[y];for(x in tree2)agg=tree2[x],dataArray.push([parseFloat(x),parseFloat(y),fullAggName+": \n"+agg.format(agg.value())])}dataTable=new google.visualization.DataTable,dataTable.addColumn("number",pivotData.colAttrs.join("-")),dataTable.addColumn("number",pivotData.rowAttrs.join("-")),dataTable.addColumn({type:"string",role:"tooltip"}),dataTable.addRows(dataArray),hAxisTitle=pivotData.colAttrs.join("-"),vAxisTitle=pivotData.rowAttrs.join("-"),title=""}else{for(dataArray=[headers],i=0,len=colKeys.length;len>i;i++){for(colKey=colKeys[i],row=[colKey.join("-")],numCharsInHAxis+=row[0].length,j=0,len1=rowKeys.length;len1>j;j++)rowKey=rowKeys[j],agg=pivotData.getAggregator(rowKey,colKey),null!=agg.value()?(val=agg.value(),row.push($.isNumeric(val)?1>val?parseFloat(val.toPrecision(3)):parseFloat(val.toFixed(3)):val)):row.push(null);dataArray.push(row)}dataTable=google.visualization.arrayToDataTable(dataArray),title=vAxisTitle=fullAggName,hAxisTitle=pivotData.colAttrs.join("-"),""!==hAxisTitle&&(title+=" "+opts.localeStrings.vs+" "+hAxisTitle),groupByTitle=pivotData.rowAttrs.join("-"),""!==groupByTitle&&(title+=" "+opts.localeStrings.by+" "+groupByTitle)}return options={title:title,hAxis:{title:hAxisTitle,slantedText:numCharsInHAxis>50},vAxis:{title:vAxisTitle},tooltip:{textStyle:{fontName:"Arial",fontSize:12}}},"ColumnChart"===chartType&&(options.vAxis.minValue=0),"ScatterChart"===chartType?(options.legend={position:"none"},options.chartArea={width:"80%",height:"80%"}):2===dataArray[0].length&&""===dataArray[0][1]&&(options.legend={position:"none"}),options=$.extend(!0,{},options,opts.gchart,extraOptions),result=$("<div>").css({width:"100%",height:"100%"}),wrapper=new google.visualization.ChartWrapper({dataTable:dataTable,chartType:chartType,options:options}),wrapper.draw(result[0]),result.bind("dblclick",function(){var editor;return editor=new google.visualization.ChartEditor,google.visualization.events.addListener(editor,"ok",function(){return editor.getChartWrapper().draw(result[0])}),editor.openDialog(wrapper)}),result}},$.pivotUtilities.gchart_renderers={"Line Chart":makeGoogleChart("LineChart"),"Bar Chart":makeGoogleChart("ColumnChart"),"Stacked Bar Chart":makeGoogleChart("ColumnChart",{isStacked:!0}),"Area Chart":makeGoogleChart("AreaChart",{isStacked:!0}),"Scatter Chart":makeGoogleChart("ScatterChart")}})}).call(this);
!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("angular")):"function"==typeof define&&define.amd?define(["exports","angular"],factory):(global=global||self,factory(global["@uirouter/angularjs"]={},global.angular))}(this,function(exports,ng_from_import){"use strict";function curry(fn){return function curried(){if(arguments.length>=fn.length)return fn.apply(this,arguments);var args=Array.prototype.slice.call(arguments);return curried.bind.apply(curried,__spreadArrays([this],args))}}function compose(){var args=arguments,start=args.length-1;return function(){for(var i=start,result=args[start].apply(this,arguments);i--;)result=args[i].call(this,result);return result}}function pipe(){for(var funcs=[],_i=0;_i<arguments.length;_i++)funcs[_i]=arguments[_i];return compose.apply(null,[].slice.call(arguments).reverse())}function and(fn1,fn2){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return fn1.apply(null,args)&&fn2.apply(null,args)}}function or(fn1,fn2){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return fn1.apply(null,args)||fn2.apply(null,args)}}function invoke(fnName,args){return function(obj){return obj[fnName].apply(obj,args)}}function pattern(struct){return function(x){for(var i=0;i<struct.length;i++)if(struct[i][0](x))return struct[i][1](x)}}function isInjectable(val){if(isArray(val)&&val.length){var head=val.slice(0,-1),tail=val.slice(-1);return!(head.filter(not(isString)).length||tail.filter(not(isFunction)).length)}return isFunction(val)}function identity(x){return x}function noop(){}function createProxyFunctions(source,target,bind,fnNames,latebind){void 0===latebind&&(latebind=!1);var bindFunction=function(fnName){return source()[fnName].bind(bind())},makeLateRebindFn=function(fnName){return function(){return target[fnName]=bindFunction(fnName),target[fnName].apply(null,arguments)}};return fnNames=fnNames||Object.keys(source()),fnNames.reduce(function(acc,name){return acc[name]=latebind?makeLateRebindFn(name):bindFunction(name),acc},target)}function _inArray(array,obj){return-1!==array.indexOf(obj)}function _removeFrom(array,obj){var idx=array.indexOf(obj);return idx>=0&&array.splice(idx,1),array}function _pushTo(arr,val){return arr.push(val),val}function defaults(opts){for(var defaultsList=[],_i=1;_i<arguments.length;_i++)defaultsList[_i-1]=arguments[_i];var defaultVals=extend.apply(void 0,__spreadArrays$1([{}],defaultsList.reverse()));return extend(defaultVals,pick(opts||{},Object.keys(defaultVals)))}function ancestors(first,second){var path=[];for(var n in first.path){if(first.path[n]!==second.path[n])break;path.push(first.path[n])}return path}function pick(obj,propNames){var objCopy={};for(var _prop in obj)-1!==propNames.indexOf(_prop)&&(objCopy[_prop]=obj[_prop]);return objCopy}function omit(obj,propNames){return Object.keys(obj).filter(not(inArray(propNames))).reduce(function(acc,key){return acc[key]=obj[key],acc},{})}function pluck(collection,propName){return map(collection,prop(propName))}function filter(collection,callback){var arr=isArray(collection),result=arr?[]:{},accept=arr?function(x){return result.push(x)}:function(x,key){return result[key]=x};return forEach(collection,function(item,i){callback(item,i)&&accept(item,i)}),result}function find(collection,callback){var result;return forEach(collection,function(item,i){result||callback(item,i)&&(result=item)}),result}function map(collection,callback,target){return target=target||(isArray(collection)?[]:{}),forEach(collection,function(item,i){return target[i]=callback(item,i)}),target}function pushR(arr,obj){return arr.push(obj),arr}function assertFn(predicateOrMap,errMsg){return void 0===errMsg&&(errMsg="assert failure"),function(obj){var result=predicateOrMap(obj);if(!result)throw new Error(isFunction(errMsg)?errMsg(obj):errMsg);return result}}function arrayTuples(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];if(0===args.length)return[];for(var maxArrayLen=args.reduce(function(min,arr){return Math.min(arr.length,min)},9007199254740991),result=[],_loop_1=function(i){switch(args.length){case 1:result.push([args[0][i]]);break;case 2:result.push([args[0][i],args[1][i]]);break;case 3:result.push([args[0][i],args[1][i],args[2][i]]);break;case 4:result.push([args[0][i],args[1][i],args[2][i],args[3][i]]);break;default:result.push(args.map(function(array){return array[i]}))}},i=0;maxArrayLen>i;i++)_loop_1(i);return result}function applyPairs(memo,keyValTuple){var key,value;if(isArray(keyValTuple)&&(key=keyValTuple[0],value=keyValTuple[1]),!isString(key))throw new Error("invalid parameters to applyPairs");return memo[key]=value,memo}function tail(arr){return arr.length&&arr[arr.length-1]||void 0}function copy(src,dest){return dest&&Object.keys(dest).forEach(function(key){return delete dest[key]}),dest||(dest={}),extend(dest,src)}function _forEach(obj,cb,_this){return isArray(obj)?obj.forEach(cb,_this):void Object.keys(obj).forEach(function(key){return cb(obj[key],key)})}function _extend(toObj){for(var i=1;i<arguments.length;i++){var obj=arguments[i];if(obj)for(var keys=Object.keys(obj),j=0;j<keys.length;j++)toObj[keys[j]]=obj[keys[j]]}return toObj}function _equals(o1,o2){if(o1===o2)return!0;if(null===o1||null===o2)return!1;if(o1!==o1&&o2!==o2)return!0;var t1=typeof o1,t2=typeof o2;if(t1!==t2||"object"!==t1)return!1;var tup=[o1,o2];if(all(isArray)(tup))return _arraysEq(o1,o2);if(all(isDate)(tup))return o1.getTime()===o2.getTime();if(all(isRegExp)(tup))return o1.toString()===o2.toString();if(all(isFunction)(tup))return!0;var predicates=[isFunction,isArray,isDate,isRegExp];if(predicates.map(any).reduce(function(b,fn){return b||!!fn(tup)},!1))return!1;var keys={};for(var key in o1){if(!_equals(o1[key],o2[key]))return!1;keys[key]=!0}for(var key in o2)if(!keys[key])return!1;return!0}function _arraysEq(a1,a2){return a1.length!==a2.length?!1:arrayTuples(a1,a2).reduce(function(b,t){return b&&_equals(t[0],t[1])},!0)}function maxLength(max,str){return str.length<=max?str:str.substr(0,max-3)+"..."}function padString(length,str){for(;str.length<length;)str+=" ";return str}function kebobString(camelCase){return camelCase.replace(/^([A-Z])/,function($1){return $1.toLowerCase()}).replace(/([A-Z])/g,function($1){return"-"+$1.toLowerCase()})}function functionToString(fn){var fnStr=fnToString(fn),namedFunctionMatch=fnStr.match(/^(function [^ ]+\([^)]*\))/),toStr=namedFunctionMatch?namedFunctionMatch[1]:fnStr,fnName=fn.name||"";return fnName&&toStr.match(/function \(/)?"function "+fnName+toStr.substr(9):toStr}function fnToString(fn){var _fn=isArray(fn)?fn.slice(-1)[0]:fn;return _fn&&_fn.toString()||"undefined"}function stringify(o){function format(value){if(isObject(value)){if(-1!==seen.indexOf(value))return"[circular ref]";seen.push(value)}return stringifyPattern(value)}var seen=[];return isUndefined(o)?format(o):JSON.stringify(o,function(key,value){return format(value)}).replace(/\\"/g,'"')}function splitOnDelim(delim){var re=new RegExp("("+delim+")","g");return function(str){return str.split(re).filter(identity)}}function joinNeighborsR(acc,x){return isString(tail(acc))&&isString(x)?acc.slice(0,-1).concat(tail(acc)+x):pushR(acc,x)}function ie9Console(console){var bound=function(fn){return Function.prototype.bind.call(fn,console)};return{log:bound(console.log),error:bound(console.log),table:bound(console.log)}}function fallbackConsole(console){var log=console.log.bind(console),error=console.error?console.error.bind(console):log,table=console.table?console.table.bind(console):log;return{log:log,error:error,table:table}}function getSafeConsole(){var isIE9="undefined"!=typeof document&&document.documentMode&&9===document.documentMode;return isIE9?window&&window.console?ie9Console(window.console):noopConsoleStub:console.table&&console.error?console:fallbackConsole(console)}function uiViewString(uiview){if(!uiview)return"ui-view (defunct)";var state=uiview.creationContext?uiview.creationContext.name||"(root)":"(none)";return"[ui-view#"+uiview.id+" "+uiview.$type+":"+uiview.fqn+" ("+uiview.name+"@"+state+")]"}function normalizedCat(input){return isNumber(input)?exports.Category[input]:exports.Category[exports.Category[input]]}function ArrayType(type,mode){function arrayWrap(val){return isArray(val)?val:isDefined(val)?[val]:[]}function arrayUnwrap(val){switch(val.length){case 0:return void 0;case 1:return"auto"===mode?val[0]:val;default:return val}}function arrayHandler(callback,allTruthyMode){return function(val){if(isArray(val)&&0===val.length)return val;var arr=arrayWrap(val),result=map(arr,callback);return allTruthyMode===!0?0===filter(result,function(x){return!x}).length:arrayUnwrap(result)}}function arrayEqualsHandler(callback){return function(val1,val2){var left=arrayWrap(val1),right=arrayWrap(val2);if(left.length!==right.length)return!1;for(var i=0;i<left.length;i++)if(!callback(left[i],right[i]))return!1;return!0}}var _this=this;["encode","decode","equals","$normalize"].forEach(function(name){var paramTypeFn=type[name].bind(type),wrapperFn="equals"===name?arrayEqualsHandler:arrayHandler;_this[name]=wrapperFn(paramTypeFn)}),extend(this,{dynamic:type.dynamic,name:type.name,pattern:type.pattern,inherit:type.inherit,raw:type.raw,is:arrayHandler(type.is.bind(type),!0),$arrayMode:mode})}function getParamDeclaration(paramName,location,state){var noReloadOnSearch=state.reloadOnSearch===!1&&location===exports.DefType.SEARCH||void 0,dynamic=find([state.dynamic,noReloadOnSearch],isDefined),defaultConfig=isDefined(dynamic)?{dynamic:dynamic}:{},paramConfig=unwrapShorthand(state&&state.params&&state.params[paramName]);return extend(defaultConfig,paramConfig)}function unwrapShorthand(cfg){function getStaticDefaultValue(){return cfg.value}cfg=isShorthand(cfg)?{value:cfg}:cfg,getStaticDefaultValue.__cacheable=!0;var $$fn=isInjectable(cfg.value)?cfg.value:getStaticDefaultValue;return extend(cfg,{$$fn:$$fn})}function getType(cfg,urlType,location,id,paramTypes){if(cfg.type&&urlType&&"string"!==urlType.name)throw new Error("Param '"+id+"' has two type configurations.");if(cfg.type&&urlType&&"string"===urlType.name&&paramTypes.type(cfg.type))return paramTypes.type(cfg.type);if(urlType)return urlType;if(!cfg.type){var type=location===exports.DefType.CONFIG?"any":location===exports.DefType.PATH?"path":location===exports.DefType.SEARCH?"query":"string";return paramTypes.type(type)}return cfg.type instanceof ParamType?cfg.type:paramTypes.type(cfg.type)}function getSquashPolicy(config,isOptional,defaultPolicy){var squash=config.squash;if(!isOptional||squash===!1)return!1;if(!isDefined(squash)||null==squash)return defaultPolicy;if(squash===!0||isString(squash))return squash;throw new Error("Invalid squash policy: '"+squash+"'. Valid policies: false, true, or arbitrary string")}function getReplace(config,arrayMode,isOptional,squash){var defaultPolicy=[{from:"",to:isOptional||arrayMode?void 0:""},{from:null,to:isOptional||arrayMode?void 0:""}],replace=isArray(config.replace)?config.replace:[];isString(squash)&&replace.push({from:squash,to:void 0});var configuredKeys=map(replace,prop("from"));return filter(defaultPolicy,function(item){return-1===configuredKeys.indexOf(item.from)}).concat(replace)}function initDefaultTypes(){var makeDefaultType=function(def){var valToString=function(val){return null!=val?val.toString():val},defaultTypeBase={encode:valToString,decode:valToString,is:is(String),pattern:/.*/,equals:function(a,b){return a==b}};return extend({},defaultTypeBase,def)};extend(ParamTypes.prototype,{string:makeDefaultType({}),path:makeDefaultType({pattern:/[^\/]*/}),query:makeDefaultType({}),hash:makeDefaultType({inherit:!1}),"int":makeDefaultType({decode:function(val){return parseInt(val,10)},is:function(val){return!isNullOrUndefined(val)&&this.decode(val.toString())===val},pattern:/-?\d+/}),bool:makeDefaultType({encode:function(val){return val&&1||0},decode:function(val){return 0!==parseInt(val,10)},is:is(Boolean),pattern:/0|1/}),date:makeDefaultType({encode:function(val){return this.is(val)?[val.getFullYear(),("0"+(val.getMonth()+1)).slice(-2),("0"+val.getDate()).slice(-2)].join("-"):void 0},decode:function(val){if(this.is(val))return val;var match=this.capture.exec(val);return match?new Date(match[1],match[2]-1,match[3]):void 0},is:function(val){return val instanceof Date&&!isNaN(val.valueOf())},equals:function(l,r){return["getFullYear","getMonth","getDate"].reduce(function(acc,fn){return acc&&l[fn]()===r[fn]()},!0)},pattern:/[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])/,capture:/([0-9]{4})-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])/}),json:makeDefaultType({encode:toJson,decode:fromJson,is:is(Object),equals:equals,pattern:/[^\/]*/}),any:makeDefaultType({encode:identity,decode:identity,is:function(){return!0},equals:equals})})}function nameBuilder(state){return state.name}function selfBuilder(state){return state.self.$$state=function(){return state},state.self}function dataBuilder(state){return state.parent&&state.parent.data&&(state.data=state.self.data=inherit(state.parent.data,state.data)),state.data}function pathBuilder(state){return state.parent?state.parent.path.concat(state):[state]}function includesBuilder(state){var includes=state.parent?extend({},state.parent.includes):{};return includes[state.name]=!0,includes}function resolvablesBuilder(state){var objects2Tuples=function(resolveObj,resolvePolicies){return Object.keys(resolveObj||{}).map(function(token){return{token:token,val:resolveObj[token],deps:void 0,policy:resolvePolicies[token]}})},annotate=function(fn){var $injector=services.$injector;return fn.$inject||$injector&&$injector.annotate(fn,$injector.strictDi)||"deferred"},isResolveLiteral=function(obj){return!(!obj.token||!obj.resolveFn)},isLikeNg2Provider=function(obj){return!(!obj.provide&&!obj.token||!(obj.useValue||obj.useFactory||obj.useExisting||obj.useClass))},isTupleFromObj=function(obj){return!!(obj&&obj.val&&(isString(obj.val)||isArray(obj.val)||isFunction(obj.val)))},getToken=function(p){return p.provide||p.token},literal2Resolvable=pattern([[prop("resolveFn"),function(p){return new Resolvable(getToken(p),p.resolveFn,p.deps,p.policy)}],[prop("useFactory"),function(p){return new Resolvable(getToken(p),p.useFactory,p.deps||p.dependencies,p.policy)}],[prop("useClass"),function(p){return new Resolvable(getToken(p),function(){return new p.useClass},[],p.policy)}],[prop("useValue"),function(p){return new Resolvable(getToken(p),function(){return p.useValue},[],p.policy,p.useValue)}],[prop("useExisting"),function(p){return new Resolvable(getToken(p),identity,[p.useExisting],p.policy)}]]),tuple2Resolvable=pattern([[pipe(prop("val"),isString),function(tuple){return new Resolvable(tuple.token,identity,[tuple.val],tuple.policy)}],[pipe(prop("val"),isArray),function(tuple){return new Resolvable(tuple.token,tail(tuple.val),tuple.val.slice(0,-1),tuple.policy)}],[pipe(prop("val"),isFunction),function(tuple){return new Resolvable(tuple.token,tuple.val,annotate(tuple.val),tuple.policy)}]]),item2Resolvable=pattern([[is(Resolvable),function(r){return r}],[isResolveLiteral,literal2Resolvable],[isLikeNg2Provider,literal2Resolvable],[isTupleFromObj,tuple2Resolvable],[val(!0),function(obj){throw new Error("Invalid resolve value: "+stringify(obj))}]]),decl=state.resolve,items=isArray(decl)?decl:objects2Tuples(decl,state.resolvePolicy||{});return items.map(item2Resolvable)}function matchState(state,criterion,transition){function matchGlobs(_state){for(var globStrings=toMatch,i=0;i<globStrings.length;i++){var glob=new Glob(globStrings[i]);if(glob&&glob.matches(_state.name)||!glob&&globStrings[i]===_state.name)return!0}return!1}var toMatch=isString(criterion)?[criterion]:criterion,matchFn=isFunction(toMatch)?toMatch:matchGlobs;return!!matchFn(state,transition)}function makeEvent(registry,transitionService,eventType){function hookRegistrationFn(matchObject,callback,options){void 0===options&&(options={});var registeredHook=new RegisteredHook(transitionService,eventType,callback,matchObject,removeHookFn,options);return hooks.push(registeredHook),registeredHook.deregister.bind(registeredHook)}var _registeredHooks=registry._registeredHooks=registry._registeredHooks||{},hooks=_registeredHooks[eventType.name]=[],removeHookFn=removeFrom(hooks);return registry[eventType.name]=hookRegistrationFn,hookRegistrationFn}function tupleSort(reverseDepthSort){return void 0===reverseDepthSort&&(reverseDepthSort=!1),function(l,r){var factor=reverseDepthSort?-1:1,depthDelta=(l.node.state.path.length-r.node.state.path.length)*factor;return 0!==depthDelta?depthDelta:r.hook.priority-l.hook.priority}}function quoteRegExp(str,param){var surroundPattern=["",""],result=str.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!param)return result;switch(param.squash){case!1:surroundPattern=["(",")"+(param.isOptional?"?":"")];break;case!0:result=result.replace(/\/$/,""),surroundPattern=["(?:/(",")|/)?"];break;default:surroundPattern=["("+param.squash+"|",")?"]}return result+surroundPattern[0]+param.type.pattern.source+surroundPattern[1]}function appendBasePath(url,isHtml5,absolute,baseHref){return"/"===baseHref?url:isHtml5?stripLastPathElement(baseHref)+url:absolute?baseHref.slice(1)+url:url}function getHandlerFn(handler){if(!(isFunction(handler)||isString(handler)||is(TargetState)(handler)||TargetState.isDef(handler)))throw new Error("'handler' must be a string, function, TargetState, or have a state: 'newtarget' property");return isFunction(handler)?handler:val(handler)}function addCoreResolvables(trans){trans.addResolvable(Resolvable.fromData(UIRouter,trans.router),""),trans.addResolvable(Resolvable.fromData(Transition,trans),""),trans.addResolvable(Resolvable.fromData("$transition$",trans),""),trans.addResolvable(Resolvable.fromData("$stateParams",trans.params()),""),trans.entering().forEach(function(state){trans.addResolvable(Resolvable.fromData("$state$",state),state)})}function makeEnterExitRetainHook(hookName){return function(transition,state){var _state=state.$$state(),hookFn=_state[hookName];return hookFn(transition,state)}}function lazyLoadState(transition,state){function updateStateRegistry(result){return result&&Array.isArray(result.states)&&result.states.forEach(function(_state){return transition.router.stateRegistry.register(_state)}),result}var lazyLoadFn=state.$$state().lazyLoad,promise=lazyLoadFn._promise;if(!promise){var success=function(result){return delete state.lazyLoad,delete state.$$state().lazyLoad,delete lazyLoadFn._promise,result},error=function(err){return delete lazyLoadFn._promise,services.$q.reject(err)};promise=lazyLoadFn._promise=services.$q.when(lazyLoadFn(transition,state)).then(updateStateRegistry).then(success,error)}return promise}function ignoredHook(trans){var ignoredReason=trans._ignoredReason();if(ignoredReason){trace.traceTransitionIgnored(trans);var pending=trans.router.globals.transition;return"SameAsCurrent"===ignoredReason&&pending&&pending.abort(),Rejection.ignored().toPromise()}}function invalidTransitionHook(trans){if(!trans.valid())throw new Error(trans.error().toString())}function parseUrl$1(url){var orEmptyString=function(x){return x||""},_a=splitHash(url).map(orEmptyString),beforehash=_a[0],hash=_a[1],_b=splitQuery(beforehash).map(orEmptyString),path=_b[0],search=_b[1];return{path:path,search:search,hash:hash,url:url}}function locationPluginFactory(name,isHtml5,serviceClass,configurationClass){return function(uiRouter){function dispose(router){router.dispose(service),router.dispose(configuration)}var service=uiRouter.locationService=new serviceClass(uiRouter),configuration=uiRouter.locationConfig=new configurationClass(uiRouter,isHtml5);return{name:name,service:service,configuration:configuration,dispose:dispose}}}function servicesPlugin(){return services.$injector=$injector,services.$q=$q,{name:"vanilla.services",$q:$q,$injector:$injector,dispose:function(){return null}}}function getNg1ViewConfigFactory(){var templateFactory=null;return function(path,view){return templateFactory=templateFactory||services.$injector.get("$templateFactory"),[new Ng1ViewConfig(path,view,templateFactory)]}}function ng1ViewsBuilder(state){if(!state.parent)return{};var tplKeys=["templateProvider","templateUrl","template","notify","async"],ctrlKeys=["controller","controllerProvider","controllerAs","resolveAs"],compKeys=["component","bindings","componentProvider"],nonCompKeys=tplKeys.concat(ctrlKeys),allViewKeys=compKeys.concat(nonCompKeys);if(isDefined(state.views)&&hasAnyKey(allViewKeys,state))throw new Error("State '"+state.name+"' has a 'views' object. It cannot also have \"view properties\" at the state level.  Move the following properties into a view (in the 'views' object):  "+allViewKeys.filter(function(key){return isDefined(state[key])}).join(", "));var views={},viewsObject=state.views||{$default:pick(state,allViewKeys)};return forEach(viewsObject,function(config,name){if(name=name||"$default",isString(config)&&(config={component:config}),config=extend({},config),hasAnyKey(compKeys,config)&&hasAnyKey(nonCompKeys,config))throw new Error("Cannot combine: "+compKeys.join("|")+" with: "+nonCompKeys.join("|")+" in stateview: '"+name+"@"+state.name+"'");config.resolveAs=config.resolveAs||"$resolve",config.$type="ng1",config.$context=state,config.$name=name;var normalized=ViewService.normalizeUIViewTarget(config.$context,config.$name);config.$uiViewName=normalized.uiViewName,config.$uiViewContextAnchor=normalized.uiViewContextAnchor,views[name]=config}),views}function getComponentBindings(name){var cmpDefs=services.$injector.get(name+"Directive");if(!cmpDefs||!cmpDefs.length)throw new Error("Unable to find component named '"+name+"'");return cmpDefs.map(getBindings).reduce(unnestR,[])}function $uiRouterProvider($locationProvider){function $get($location,$browser,$window,$sniffer,$rootScope){return ng1LocationService._runtimeServices($rootScope,$location,$sniffer,$browser,$window),delete router.router,delete router.$get,router}router=this.router=new UIRouter,router.stateProvider=new StateProvider(router.stateRegistry,router.stateService),router.stateRegistry.decorator("views",ng1ViewsBuilder),router.stateRegistry.decorator("onExit",getStateHookBuilder("onExit")),router.stateRegistry.decorator("onRetain",getStateHookBuilder("onRetain")),router.stateRegistry.decorator("onEnter",getStateHookBuilder("onEnter")),router.viewService._pluginapi._viewConfigFactory("ng1",getNg1ViewConfigFactory()),router.urlService.config._decodeParams=!1;var ng1LocationService=router.locationService=router.locationConfig=new Ng1LocationServices($locationProvider);return Ng1LocationServices.monkeyPatchPathParameterType(router),router.router=router,router.$get=$get,$get.$inject=["$location","$browser","$window","$sniffer","$rootScope","$http","$templateCache"],router}function runBlock($injector,$q,$uiRouter){if(services.$injector=$injector,services.$q=$q,!Object.prototype.hasOwnProperty.call($injector,"strictDi"))try{$injector.invoke(function(){})}catch(error){$injector.strictDi=!!/strict mode/.exec(error&&error.toString())}$uiRouter.stateRegistry.get().map(function(x){return x.$$state().resolvables}).reduce(unnestR,[]).filter(function(x){return"deferred"===x.deps}).forEach(function(resolvable){return resolvable.deps=$injector.annotate(resolvable.resolveFn,$injector.strictDi)})}function watchDigests($rootScope){$rootScope.$watch(function(){trace.approximateDigests++})}function parseStateRef(ref){var paramsOnly=ref.match(/^\s*({[^}]*})\s*$/);paramsOnly&&(ref="("+paramsOnly[1]+")");var parsed=ref.replace(/\n/g," ").match(/^\s*([^(]*?)\s*(\((.*)\))?\s*$/);if(!parsed||4!==parsed.length)throw new Error("Invalid state ref '"+ref+"'");return{state:parsed[1]||null,paramExpr:parsed[3]||null}}function stateContext(el){var $uiView=el.parent().inheritedData("$uiView"),path=parse("$cfg.path")($uiView);return path?tail(path).state.name:void 0}function processedDef($state,$element,def){var uiState=def.uiState||$state.current.name,uiStateOpts=extend(defaultOpts($element,$state),def.uiStateOpts||{}),href=$state.href(uiState,def.uiStateParams,uiStateOpts);return{uiState:uiState,uiStateParams:def.uiStateParams,uiStateOpts:uiStateOpts,href:href}}function getTypeInfo(el){var isSvg="[object SVGAnimatedString]"===Object.prototype.toString.call(el.prop("href")),isForm="FORM"===el[0].nodeName;return{attr:isForm?"action":isSvg?"xlink:href":"href",isAnchor:"A"===el.prop("tagName").toUpperCase(),clickable:!isForm}}function clickHook(el,$state,$timeout,type,getDef){return function(e){var button=e.which||e.button,target=getDef();if(!(button>1||e.ctrlKey||e.metaKey||e.shiftKey||e.altKey||el.attr("target"))){var transition_1=$timeout(function(){el.attr("disabled")||$state.go(target.uiState,target.uiStateParams,target.uiStateOpts)});e.preventDefault();var ignorePreventDefaultCount_1=type.isAnchor&&!target.href?1:0;e.preventDefault=function(){ignorePreventDefaultCount_1--<=0&&$timeout.cancel(transition_1)}}}}function defaultOpts(el,$state){return{relative:stateContext(el)||$state.$current,inherit:!0,source:"sref"}}function bindEvents(element,scope,hookFn,uiStateOpts){var events;uiStateOpts&&(events=uiStateOpts.events),isArray(events)||(events=["click"]);for(var on=element.on?"on":"bind",_i=0,events_1=events;_i<events_1.length;_i++){var event_1=events_1[_i];element[on](event_1,hookFn)}scope.$on("$destroy",function(){for(var off=element.off?"off":"unbind",_i=0,events_2=events;_i<events_2.length;_i++){var event_2=events_2[_i];element[off](event_2,hookFn)}})}function $IsStateFilter($state){var isFilter=function(state,params,options){return $state.is(state,params,options)};return isFilter.$stateful=!0,isFilter}function $IncludedByStateFilter($state){var includesFilter=function(state,params,options){return $state.includes(state,params,options)};return includesFilter.$stateful=!0,includesFilter}function $ViewDirectiveFill($compile,$controller,$transitions,$view,$q){var getControllerAs=parse("viewDecl.controllerAs"),getResolveAs=parse("viewDecl.resolveAs");return{restrict:"ECA",priority:-400,compile:function(tElement){var initial=tElement.html();return tElement.empty(),function(scope,$element){var data=$element.data("$uiView");if(!data)return $element.html(initial),void $compile($element.contents())(scope);var cfg=data.$cfg||{viewDecl:{},getTemplate:noop},resolveCtx=cfg.path&&new ResolveContext(cfg.path);$element.html(cfg.getTemplate($element,resolveCtx)||initial),trace.traceUIViewFill(data.$uiView,$element.html());var link=$compile($element.contents()),controller=cfg.controller,controllerAs=getControllerAs(cfg),resolveAs=getResolveAs(cfg),locals=resolveCtx&&getLocals(resolveCtx);if(scope[resolveAs]=locals,controller){var controllerInstance=$controller(controller,extend({},locals,{$scope:scope,$element:$element}));controllerAs&&(scope[controllerAs]=controllerInstance,scope[controllerAs][resolveAs]=locals),$element.data("$ngControllerController",controllerInstance),$element.children().data("$ngControllerController",controllerInstance),registerControllerCallbacks($q,$transitions,controllerInstance,scope,cfg)}if(isString(cfg.component))var kebobName=kebobString(cfg.component),tagRegexp_1=new RegExp("^(x-|data-)?"+kebobName+"$","i"),getComponentController=function(){var directiveEl=[].slice.call($element[0].children).filter(function(el){return el&&el.tagName&&tagRegexp_1.exec(el.tagName)});return directiveEl&&ng.element(directiveEl).data("$"+cfg.component+"Controller")},deregisterWatch_1=scope.$watch(getComponentController,function(ctrlInstance){ctrlInstance&&(registerControllerCallbacks($q,$transitions,ctrlInstance,scope,cfg),deregisterWatch_1())});link(scope)}}}}function registerControllerCallbacks($q,$transitions,controllerInstance,$scope,cfg){!isFunction(controllerInstance.$onInit)||(cfg.viewDecl.component||cfg.viewDecl.componentProvider)&&hasComponentImpl||controllerInstance.$onInit();var viewState=tail(cfg.path).state.self,hookOptions={bind:controllerInstance};if(isFunction(controllerInstance.uiOnParamsChanged)){var resolveContext=new ResolveContext(cfg.path),viewCreationTrans_1=resolveContext.getResolvable("$transition$").data,paramsUpdated=function($transition$){if($transition$!==viewCreationTrans_1&&-1===$transition$.exiting().indexOf(viewState)){var toParams=$transition$.params("to"),fromParams=$transition$.params("from"),getNodeSchema=function(node){return node.paramSchema},toSchema=$transition$.treeChanges("to").map(getNodeSchema).reduce(unnestR,[]),fromSchema=$transition$.treeChanges("from").map(getNodeSchema).reduce(unnestR,[]),changedToParams=toSchema.filter(function(param){var idx=fromSchema.indexOf(param);return-1===idx||!fromSchema[idx].type.equals(toParams[param.id],fromParams[param.id])});if(changedToParams.length){var changedKeys_1=changedToParams.map(function(x){return x.id}),newValues=filter(toParams,function(val,key){return-1!==changedKeys_1.indexOf(key)});controllerInstance.uiOnParamsChanged(newValues,$transition$)}}};$scope.$on("$destroy",$transitions.onSuccess({},paramsUpdated,hookOptions))}if(isFunction(controllerInstance.uiCanExit)){var id_1=_uiCanExitId++,cacheProp_1="_uiCanExitIds",prevTruthyAnswer_1=function(trans){return!!trans&&(trans[cacheProp_1]&&trans[cacheProp_1][id_1]===!0||prevTruthyAnswer_1(trans.redirectedFrom()))},wrappedHook=function(trans){var promise,ids=trans[cacheProp_1]=trans[cacheProp_1]||{};return prevTruthyAnswer_1(trans)||(promise=$q.when(controllerInstance.uiCanExit(trans)),promise.then(function(val){return ids[id_1]=val!==!1})),promise},criteria={exiting:viewState.name};$scope.$on("$destroy",$transitions.onBefore(criteria,wrappedHook,hookOptions))}}function $ViewScrollProvider(){var useAnchorScroll=!1;this.useAnchorScroll=function(){useAnchorScroll=!0},this.$get=["$anchorScroll","$timeout",function($anchorScroll,$timeout){return useAnchorScroll?$anchorScroll:function($element){return $timeout(function(){$element[0].scrollIntoView()},0,!1)}}]}var ng_from_global=angular,ng=ng_from_import&&ng_from_import.module?ng_from_import:ng_from_global,__spreadArrays=void 0||function(){for(var s=0,i=0,il=arguments.length;il>i;i++)s+=arguments[i].length;for(var r=Array(s),k=0,i=0;il>i;i++)for(var a=arguments[i],j=0,jl=a.length;jl>j;j++,k++)r[k]=a[j];return r},prop=function(name){return function(obj){return obj&&obj[name]}},propEq=curry(function(name,_val,obj){return obj&&obj[name]===_val}),parse=function(name){return pipe.apply(null,name.split(".").map(prop))},not=function(fn){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return!fn.apply(null,args)}},all=function(fn1){return function(arr){return arr.reduce(function(b,x){return b&&!!fn1(x)},!0)}},any=function(fn1){return function(arr){return arr.reduce(function(b,x){return b||!!fn1(x)},!1)}},is=function(ctor){return function(obj){return null!=obj&&obj.constructor===ctor||obj instanceof ctor}},eq=function(value){return function(other){return value===other}},val=function(v){return function(){return v}},toStr=Object.prototype.toString,tis=function(t){return function(x){return typeof x===t}},isUndefined=tis("undefined"),isDefined=not(isUndefined),isNull=function(o){return null===o},isNullOrUndefined=or(isNull,isUndefined),isFunction=tis("function"),isNumber=tis("number"),isString=tis("string"),isObject=function(x){return null!==x&&"object"==typeof x},isArray=Array.isArray,isDate=function(x){return"[object Date]"===toStr.call(x)},isRegExp=function(x){return"[object RegExp]"===toStr.call(x)},isPromise=and(isObject,pipe(prop("then"),isFunction)),noImpl=function(fnname){return function(){throw new Error("No implementation for "+fnname+". The framework specific code did not implement this method.")}},makeStub=function(service,methods){return methods.reduce(function(acc,key){return acc[key]=noImpl(service+"."+key+"()"),acc},{})},services={$q:void 0,$injector:void 0},__spreadArrays$1=void 0||function(){for(var s=0,i=0,il=arguments.length;il>i;i++)s+=arguments[i].length;
for(var r=Array(s),k=0,i=0;il>i;i++)for(var a=arguments[i],j=0,jl=a.length;jl>j;j++,k++)r[k]=a[j];return r},root="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||void 0,angular$1=root.angular||{},fromJson=angular$1.fromJson||JSON.parse.bind(JSON),toJson=angular$1.toJson||JSON.stringify.bind(JSON),forEach=angular$1.forEach||_forEach,extend=Object.assign||_extend,equals=angular$1.equals||_equals,inherit=function(parent,extra){return extend(Object.create(parent),extra)},inArray=curry(_inArray),removeFrom=curry(_removeFrom),pushTo=curry(_pushTo),deregAll=function(functions){return functions.slice().forEach(function(fn){"function"==typeof fn&&fn(),removeFrom(functions,fn)})},mergeR=function(memo,item){return extend(memo,item)},mapObj=map,values=function(obj){return Object.keys(obj).map(function(key){return obj[key]})},allTrueR=function(memo,elem){return memo&&elem},anyTrueR=function(memo,elem){return memo||elem},unnestR=function(memo,elem){return memo.concat(elem)},flattenR=function(memo,elem){return isArray(elem)?memo.concat(elem.reduce(flattenR,[])):pushR(memo,elem)},uniqR=function(acc,token){return inArray(acc,token)?acc:pushR(acc,token)},unnest=function(arr){return arr.reduce(unnestR,[])},flatten=function(arr){return arr.reduce(flattenR,[])},assertPredicate=assertFn,assertMap=assertFn,pairs=function(obj){return Object.keys(obj).map(function(key){return[key,obj[key]]})},silenceUncaughtInPromise=function(promise){return promise.catch(function(){return 0})&&promise},silentRejection=function(error){return silenceUncaughtInPromise(services.$q.reject(error))},Glob=function(){function Glob(text){this.text=text,this.glob=text.split(".");var regexpString=this.text.split(".").map(function(seg){return"**"===seg?"(?:|(?:\\.[^.]*)*)":"*"===seg?"\\.[^.]*":"\\."+seg}).join("");this.regexp=new RegExp("^"+regexpString+"$")}return Glob.is=function(text){return!!/[!,*]+/.exec(text)},Glob.fromString=function(text){return Glob.is(text)?new Glob(text):null},Glob.prototype.matches=function(name){return this.regexp.test("."+name)},Glob}(),Queue=function(){function Queue(_items,_limit){void 0===_items&&(_items=[]),void 0===_limit&&(_limit=null),this._items=_items,this._limit=_limit,this._evictListeners=[],this.onEvict=pushTo(this._evictListeners)}return Queue.prototype.enqueue=function(item){var items=this._items;return items.push(item),this._limit&&items.length>this._limit&&this.evict(),item},Queue.prototype.evict=function(){var item=this._items.shift();return this._evictListeners.forEach(function(fn){return fn(item)}),item},Queue.prototype.dequeue=function(){return this.size()?this._items.splice(0,1)[0]:void 0},Queue.prototype.clear=function(){var current=this._items;return this._items=[],current},Queue.prototype.size=function(){return this._items.length},Queue.prototype.remove=function(item){var idx=this._items.indexOf(item);return idx>-1&&this._items.splice(idx,1)[0]},Queue.prototype.peekTail=function(){return this._items[this._items.length-1]},Queue.prototype.peekHead=function(){return this.size()?this._items[0]:void 0},Queue}();!function(RejectType){RejectType[RejectType.SUPERSEDED=2]="SUPERSEDED",RejectType[RejectType.ABORTED=3]="ABORTED",RejectType[RejectType.INVALID=4]="INVALID",RejectType[RejectType.IGNORED=5]="IGNORED",RejectType[RejectType.ERROR=6]="ERROR"}(exports.RejectType||(exports.RejectType={}));var id=0,Rejection=function(){function Rejection(type,message,detail){this.$id=id++,this.type=type,this.message=message,this.detail=detail}return Rejection.isRejectionPromise=function(obj){return obj&&"function"==typeof obj.then&&is(Rejection)(obj._transitionRejection)},Rejection.superseded=function(detail,options){var message="The transition has been superseded by a different transition",rejection=new Rejection(exports.RejectType.SUPERSEDED,message,detail);return options&&options.redirected&&(rejection.redirected=!0),rejection},Rejection.redirected=function(detail){return Rejection.superseded(detail,{redirected:!0})},Rejection.invalid=function(detail){var message="This transition is invalid";return new Rejection(exports.RejectType.INVALID,message,detail)},Rejection.ignored=function(detail){var message="The transition was ignored";return new Rejection(exports.RejectType.IGNORED,message,detail)},Rejection.aborted=function(detail){var message="The transition has been aborted";return new Rejection(exports.RejectType.ABORTED,message,detail)},Rejection.errored=function(detail){var message="The transition errored";return new Rejection(exports.RejectType.ERROR,message,detail)},Rejection.normalize=function(detail){return is(Rejection)(detail)?detail:Rejection.errored(detail)},Rejection.prototype.toString=function(){var detailString=function(d){return d&&d.toString!==Object.prototype.toString?d.toString():stringify(d)},detail=detailString(this.detail),_a=this,$id=_a.$id,type=_a.type,message=_a.message;return"Transition Rejection($id: "+$id+" type: "+type+", message: "+message+", detail: "+detail+")"},Rejection.prototype.toPromise=function(){return extend(silentRejection(this),{_transitionRejection:this})},Rejection}(),isRejection=Rejection.isRejectionPromise,hasToString=function(obj){return isObject(obj)&&!isArray(obj)&&obj.constructor!==Object&&isFunction(obj.toString)},stringifyPattern=pattern([[isUndefined,val("undefined")],[isNull,val("null")],[isPromise,val("[Promise]")],[isRejection,function(x){return x._transitionRejection.toString()}],[hasToString,function(x){return x.toString()}],[isInjectable,functionToString],[val(!0),identity]]),beforeAfterSubstr=function(char){return function(str){if(!str)return["",""];var idx=str.indexOf(char);return-1===idx?[str,""]:[str.substr(0,idx),str.substr(idx+1)]}},hostRegex=new RegExp("^(?:[a-z]+:)?//[^/]+/"),stripLastPathElement=function(str){return str.replace(/\/[^\/]*$/,"")},splitHash=beforeAfterSubstr("#"),splitQuery=beforeAfterSubstr("?"),splitEqual=beforeAfterSubstr("="),trimHashVal=function(str){return str?str.replace(/^#/,""):""},noopConsoleStub={log:noop,error:noop,table:noop},safeConsole=getSafeConsole(),viewConfigString=function(viewConfig){var view=viewConfig.viewDecl,state=view.$context.name||"(root)";return"[View#"+viewConfig.$id+" from '"+state+"' state]: target ui-view: '"+view.$uiViewName+"@"+view.$uiViewContextAnchor+"'"};!function(Category){Category[Category.RESOLVE=0]="RESOLVE",Category[Category.TRANSITION=1]="TRANSITION",Category[Category.HOOK=2]="HOOK",Category[Category.UIVIEW=3]="UIVIEW",Category[Category.VIEWCONFIG=4]="VIEWCONFIG"}(exports.Category||(exports.Category={}));var _tid=parse("$id"),_rid=parse("router.$id"),transLbl=function(trans){return"Transition #"+_tid(trans)+"-"+_rid(trans)},Trace=function(){function Trace(){this._enabled={},this.approximateDigests=0}return Trace.prototype._set=function(enabled,categories){var _this=this;categories.length||(categories=Object.keys(exports.Category).map(function(k){return parseInt(k,10)}).filter(function(k){return!isNaN(k)}).map(function(key){return exports.Category[key]})),categories.map(normalizedCat).forEach(function(category){return _this._enabled[category]=enabled})},Trace.prototype.enable=function(){for(var categories=[],_i=0;_i<arguments.length;_i++)categories[_i]=arguments[_i];this._set(!0,categories)},Trace.prototype.disable=function(){for(var categories=[],_i=0;_i<arguments.length;_i++)categories[_i]=arguments[_i];this._set(!1,categories)},Trace.prototype.enabled=function(category){return!!this._enabled[normalizedCat(category)]},Trace.prototype.traceTransitionStart=function(trans){this.enabled(exports.Category.TRANSITION)&&safeConsole.log(transLbl(trans)+": Started  -> "+stringify(trans))},Trace.prototype.traceTransitionIgnored=function(trans){this.enabled(exports.Category.TRANSITION)&&safeConsole.log(transLbl(trans)+": Ignored  <> "+stringify(trans))},Trace.prototype.traceHookInvocation=function(step,trans,options){if(this.enabled(exports.Category.HOOK)){var event=parse("traceData.hookType")(options)||"internal",context=parse("traceData.context.state.name")(options)||parse("traceData.context")(options)||"unknown",name=functionToString(step.registeredHook.callback);safeConsole.log(transLbl(trans)+":   Hook -> "+event+" context: "+context+", "+maxLength(200,name))}},Trace.prototype.traceHookResult=function(hookResult,trans){this.enabled(exports.Category.HOOK)&&safeConsole.log(transLbl(trans)+":   <- Hook returned: "+maxLength(200,stringify(hookResult)))},Trace.prototype.traceResolvePath=function(path,when,trans){this.enabled(exports.Category.RESOLVE)&&safeConsole.log(transLbl(trans)+":         Resolving "+path+" ("+when+")")},Trace.prototype.traceResolvableResolved=function(resolvable,trans){this.enabled(exports.Category.RESOLVE)&&safeConsole.log(transLbl(trans)+":               <- Resolved  "+resolvable+" to: "+maxLength(200,stringify(resolvable.data)))},Trace.prototype.traceError=function(reason,trans){this.enabled(exports.Category.TRANSITION)&&safeConsole.log(transLbl(trans)+": <- Rejected "+stringify(trans)+", reason: "+reason)},Trace.prototype.traceSuccess=function(finalState,trans){this.enabled(exports.Category.TRANSITION)&&safeConsole.log(transLbl(trans)+": <- Success  "+stringify(trans)+", final state: "+finalState.name)},Trace.prototype.traceUIViewEvent=function(event,viewData,extra){void 0===extra&&(extra=""),this.enabled(exports.Category.UIVIEW)&&safeConsole.log("ui-view: "+padString(30,event)+" "+uiViewString(viewData)+extra)},Trace.prototype.traceUIViewConfigUpdated=function(viewData,context){this.enabled(exports.Category.UIVIEW)&&this.traceUIViewEvent("Updating",viewData," with ViewConfig from context='"+context+"'")},Trace.prototype.traceUIViewFill=function(viewData,html){this.enabled(exports.Category.UIVIEW)&&this.traceUIViewEvent("Fill",viewData," with: "+maxLength(200,html))},Trace.prototype.traceViewSync=function(pairs){if(this.enabled(exports.Category.VIEWCONFIG)){var uivheader="uiview component fqn",cfgheader="view config state (view name)",mapping=pairs.map(function(_a){var _b,uiView=_a.uiView,viewConfig=_a.viewConfig,uiv=uiView&&uiView.fqn,cfg=viewConfig&&viewConfig.viewDecl.$context.name+": ("+viewConfig.viewDecl.$name+")";return _b={},_b[uivheader]=uiv,_b[cfgheader]=cfg,_b}).sort(function(a,b){return(a[uivheader]||"").localeCompare(b[uivheader]||"")});safeConsole.table(mapping)}},Trace.prototype.traceViewServiceEvent=function(event,viewConfig){this.enabled(exports.Category.VIEWCONFIG)&&safeConsole.log("VIEWCONFIG: "+event+" "+viewConfigString(viewConfig))},Trace.prototype.traceViewServiceUIViewEvent=function(event,viewData){this.enabled(exports.Category.VIEWCONFIG)&&safeConsole.log("VIEWCONFIG: "+event+" "+uiViewString(viewData))},Trace}(),trace=new Trace,ParamType=function(){function ParamType(def){this.pattern=/.*/,this.inherit=!0,extend(this,def)}return ParamType.prototype.is=function(){return!0},ParamType.prototype.encode=function(val){return val},ParamType.prototype.decode=function(val){return val},ParamType.prototype.equals=function(a,b){return a==b},ParamType.prototype.$subPattern=function(){var sub=this.pattern.toString();return sub.substr(1,sub.length-2)},ParamType.prototype.toString=function(){return"{ParamType:"+this.name+"}"},ParamType.prototype.$normalize=function(val){return this.is(val)?val:this.decode(val)},ParamType.prototype.$asArray=function(mode,isSearch){if(!mode)return this;if("auto"===mode&&!isSearch)throw new Error("'auto' array mode is for query parameters only");return new ArrayType(this,mode)},ParamType}(),hasOwn=Object.prototype.hasOwnProperty,isShorthand=function(cfg){return 0===["value","type","squash","array","dynamic"].filter(hasOwn.bind(cfg||{})).length};!function(DefType){DefType[DefType.PATH=0]="PATH",DefType[DefType.SEARCH=1]="SEARCH",DefType[DefType.CONFIG=2]="CONFIG"}(exports.DefType||(exports.DefType={}));var Param=function(){function Param(id,type,location,urlConfig,state){function getArrayMode(){var arrayDefaults={array:location===exports.DefType.SEARCH?"auto":!1},arrayParamNomenclature=id.match(/\[\]$/)?{array:!0}:{};return extend(arrayDefaults,arrayParamNomenclature,config).array}var config=getParamDeclaration(id,location,state);type=getType(config,type,location,id,urlConfig.paramTypes);var arrayMode=getArrayMode();type=arrayMode?type.$asArray(arrayMode,location===exports.DefType.SEARCH):type;var isOptional=void 0!==config.value||location===exports.DefType.SEARCH,dynamic=isDefined(config.dynamic)?!!config.dynamic:!!type.dynamic,raw=isDefined(config.raw)?!!config.raw:!!type.raw,squash=getSquashPolicy(config,isOptional,urlConfig.defaultSquashPolicy()),replace=getReplace(config,arrayMode,isOptional,squash),inherit=isDefined(config.inherit)?!!config.inherit:!!type.inherit;extend(this,{id:id,type:type,location:location,isOptional:isOptional,dynamic:dynamic,raw:raw,squash:squash,replace:replace,inherit:inherit,array:arrayMode,config:config})}return Param.values=function(params,values){void 0===values&&(values={});for(var paramValues={},_i=0,params_1=params;_i<params_1.length;_i++){var param=params_1[_i];paramValues[param.id]=param.value(values[param.id])}return paramValues},Param.changed=function(params,values1,values2){return void 0===values1&&(values1={}),void 0===values2&&(values2={}),params.filter(function(param){return!param.type.equals(values1[param.id],values2[param.id])})},Param.equals=function(params,values1,values2){return void 0===values1&&(values1={}),void 0===values2&&(values2={}),0===Param.changed(params,values1,values2).length},Param.validates=function(params,values){return void 0===values&&(values={}),params.map(function(param){return param.validates(values[param.id])}).reduce(allTrueR,!0)},Param.prototype.isDefaultValue=function(value){return this.isOptional&&this.type.equals(this.value(),value)},Param.prototype.value=function(value){var _this=this,getDefaultValue=function(){if(_this._defaultValueCache)return _this._defaultValueCache.defaultValue;if(!services.$injector)throw new Error("Injectable functions cannot be called at configuration time");var defaultValue=services.$injector.invoke(_this.config.$$fn);if(null!==defaultValue&&void 0!==defaultValue&&!_this.type.is(defaultValue))throw new Error("Default value ("+defaultValue+") for parameter '"+_this.id+"' is not an instance of ParamType ("+_this.type.name+")");return _this.config.$$fn.__cacheable&&(_this._defaultValueCache={defaultValue:defaultValue}),defaultValue},replaceSpecialValues=function(val){for(var _i=0,_a=_this.replace;_i<_a.length;_i++){var tuple=_a[_i];if(tuple.from===val)return tuple.to}return val};return value=replaceSpecialValues(value),isUndefined(value)?getDefaultValue():this.type.$normalize(value)},Param.prototype.isSearch=function(){return this.location===exports.DefType.SEARCH},Param.prototype.validates=function(value){if((isUndefined(value)||null===value)&&this.isOptional)return!0;var normalized=this.type.$normalize(value);if(!this.type.is(normalized))return!1;var encoded=this.type.encode(normalized);return!(isString(encoded)&&!this.type.pattern.exec(encoded))},Param.prototype.toString=function(){return"{Param:"+this.id+" "+this.type+" squash: '"+this.squash+"' optional: "+this.isOptional+"}"},Param}(),ParamTypes=function(){function ParamTypes(){this.enqueue=!0,this.typeQueue=[],this.defaultTypes=pick(ParamTypes.prototype,["hash","string","query","path","int","bool","date","json","any"]);var makeType=function(definition,name){return new ParamType(extend({name:name},definition))};this.types=inherit(map(this.defaultTypes,makeType),{})}return ParamTypes.prototype.dispose=function(){this.types={}},ParamTypes.prototype.type=function(name,definition,definitionFn){if(!isDefined(definition))return this.types[name];if(this.types.hasOwnProperty(name))throw new Error("A type named '"+name+"' has already been defined.");return this.types[name]=new ParamType(extend({name:name},definition)),definitionFn&&(this.typeQueue.push({name:name,def:definitionFn}),this.enqueue||this._flushTypeQueue()),this},ParamTypes.prototype._flushTypeQueue=function(){for(;this.typeQueue.length;){var type=this.typeQueue.shift();if(type.pattern)throw new Error("You cannot override a type's .pattern at runtime.");extend(this.types[type.name],services.$injector.invoke(type.def))}},ParamTypes}();initDefaultTypes();var StateParams=function(){function StateParams(params){void 0===params&&(params={}),extend(this,params)}return StateParams.prototype.$inherit=function(newParams,$current,$to){var parentParams,parents=ancestors($current,$to),inherited={},inheritList=[];for(var i in parents)if(parents[i]&&parents[i].params&&(parentParams=Object.keys(parents[i].params),parentParams.length))for(var j in parentParams)inheritList.indexOf(parentParams[j])>=0||(inheritList.push(parentParams[j]),inherited[parentParams[j]]=this[parentParams[j]]);return extend({},inherited,newParams)},StateParams}(),PathNode=function(){function PathNode(stateOrNode){if(stateOrNode instanceof PathNode){var node=stateOrNode;this.state=node.state,this.paramSchema=node.paramSchema.slice(),this.paramValues=extend({},node.paramValues),this.resolvables=node.resolvables.slice(),this.views=node.views&&node.views.slice()}else{var state=stateOrNode;this.state=state,this.paramSchema=state.parameters({inherit:!1}),this.paramValues={},this.resolvables=state.resolvables.map(function(res){return res.clone()})}}return PathNode.prototype.clone=function(){return new PathNode(this)},PathNode.prototype.applyRawParams=function(params){var getParamVal=function(paramDef){return[paramDef.id,paramDef.value(params[paramDef.id])]};return this.paramValues=this.paramSchema.reduce(function(memo,pDef){return applyPairs(memo,getParamVal(pDef))},{}),this},PathNode.prototype.parameter=function(name){return find(this.paramSchema,propEq("id",name))},PathNode.prototype.equals=function(node,paramsFn){var diff=this.diff(node,paramsFn);return diff&&0===diff.length},PathNode.prototype.diff=function(node,paramsFn){if(this.state!==node.state)return!1;var params=paramsFn?paramsFn(this):this.paramSchema;return Param.changed(params,this.paramValues,node.paramValues)},PathNode.clone=function(node){return node.clone()},PathNode}(),TargetState=function(){function TargetState(_stateRegistry,_identifier,_params,_options){this._stateRegistry=_stateRegistry,this._identifier=_identifier,this._identifier=_identifier,this._params=extend({},_params||{}),this._options=extend({},_options||{}),this._definition=_stateRegistry.matcher.find(_identifier,this._options.relative)}return TargetState.prototype.name=function(){return this._definition&&this._definition.name||this._identifier},TargetState.prototype.identifier=function(){return this._identifier},TargetState.prototype.params=function(){return this._params},TargetState.prototype.$state=function(){return this._definition},TargetState.prototype.state=function(){return this._definition&&this._definition.self},TargetState.prototype.options=function(){return this._options},TargetState.prototype.exists=function(){return!(!this._definition||!this._definition.self)},TargetState.prototype.valid=function(){return!this.error()},TargetState.prototype.error=function(){var base=this.options().relative;if(!this._definition&&base){var stateName=base.name?base.name:base;return"Could not resolve '"+this.name()+"' from state '"+stateName+"'"}return this._definition?this._definition.self?void 0:"State '"+this.name()+"' has an invalid definition":"No such state '"+this.name()+"'"},TargetState.prototype.toString=function(){return"'"+this.name()+"'"+stringify(this.params())},TargetState.prototype.withState=function(state){return new TargetState(this._stateRegistry,state,this._params,this._options)},TargetState.prototype.withParams=function(params,replace){void 0===replace&&(replace=!1);var newParams=replace?params:extend({},this._params,params);return new TargetState(this._stateRegistry,this._identifier,newParams,this._options)},TargetState.prototype.withOptions=function(options,replace){void 0===replace&&(replace=!1);var newOpts=replace?options:extend({},this._options,options);return new TargetState(this._stateRegistry,this._identifier,this._params,newOpts)},TargetState.isDef=function(obj){return obj&&obj.state&&(isString(obj.state)||isObject(obj.state)&&isString(obj.state.name))},TargetState}(),PathUtils=function(){function PathUtils(){}return PathUtils.makeTargetState=function(registry,path){var state=tail(path).state;return new TargetState(registry,state,path.map(prop("paramValues")).reduce(mergeR,{}),{})},PathUtils.buildPath=function(targetState){var toParams=targetState.params();return targetState.$state().path.map(function(state){return new PathNode(state).applyRawParams(toParams)})},PathUtils.buildToPath=function(fromPath,targetState){var toPath=PathUtils.buildPath(targetState);return targetState.options().inherit?PathUtils.inheritParams(fromPath,toPath,Object.keys(targetState.params())):toPath},PathUtils.applyViewConfigs=function($view,path,states){path.filter(function(node){return inArray(states,node.state)}).forEach(function(node){var viewDecls=values(node.state.views||{}),subPath=PathUtils.subPath(path,function(n){return n===node}),viewConfigs=viewDecls.map(function(view){return $view.createViewConfig(subPath,view)});node.views=viewConfigs.reduce(unnestR,[])})},PathUtils.inheritParams=function(fromPath,toPath,toKeys){function nodeParamVals(path,state){var node=find(path,propEq("state",state));return extend({},node&&node.paramValues)}function makeInheritedParamsNode(toNode){var toParamVals=extend({},toNode&&toNode.paramValues),incomingParamVals=pick(toParamVals,toKeys);toParamVals=omit(toParamVals,toKeys);var fromParamVals=omit(nodeParamVals(fromPath,toNode.state)||{},noInherit),ownParamVals=extend(toParamVals,fromParamVals,incomingParamVals);return new PathNode(toNode.state).applyRawParams(ownParamVals)}void 0===toKeys&&(toKeys=[]);var noInherit=fromPath.map(function(node){return node.paramSchema}).reduce(unnestR,[]).filter(function(param){return!param.inherit}).map(prop("id"));return toPath.map(makeInheritedParamsNode)},PathUtils.treeChanges=function(fromPath,toPath,reloadState){function applyToParams(retainedNode,idx){var cloned=retainedNode.clone();return cloned.paramValues=toPath[idx].paramValues,cloned}for(var max=Math.min(fromPath.length,toPath.length),keep=0,nodesMatch=function(node1,node2){return node1.equals(node2,PathUtils.nonDynamicParams)};max>keep&&fromPath[keep].state!==reloadState&&nodesMatch(fromPath[keep],toPath[keep]);)keep++;var from,retained,exiting,entering,to;from=fromPath,retained=from.slice(0,keep),exiting=from.slice(keep);var retainedWithToParams=retained.map(applyToParams);return entering=toPath.slice(keep),to=retainedWithToParams.concat(entering),{from:from,to:to,retained:retained,retainedWithToParams:retainedWithToParams,exiting:exiting,entering:entering}},PathUtils.matching=function(pathA,pathB,paramsFn){var done=!1,tuples=arrayTuples(pathA,pathB);return tuples.reduce(function(matching,_a){var nodeA=_a[0],nodeB=_a[1];return done=done||!nodeA.equals(nodeB,paramsFn),done?matching:matching.concat(nodeA)},[])},PathUtils.equals=function(pathA,pathB,paramsFn){return pathA.length===pathB.length&&PathUtils.matching(pathA,pathB,paramsFn).length===pathA.length},PathUtils.subPath=function(path,predicate){var node=find(path,predicate),elementIdx=path.indexOf(node);return-1===elementIdx?void 0:path.slice(0,elementIdx+1)},PathUtils.nonDynamicParams=function(node){return node.state.parameters({inherit:!1}).filter(function(param){return!param.dynamic})},PathUtils.paramValues=function(path){return path.reduce(function(acc,node){return extend(acc,node.paramValues)},{})},PathUtils}(),resolvePolicies={when:{LAZY:"LAZY",EAGER:"EAGER"},async:{WAIT:"WAIT",NOWAIT:"NOWAIT"}},defaultResolvePolicy={when:"LAZY",async:"WAIT"},Resolvable=function(){function Resolvable(arg1,resolveFn,deps,policy,data){if(this.resolved=!1,this.promise=void 0,arg1 instanceof Resolvable)extend(this,arg1);else if(isFunction(resolveFn)){if(isNullOrUndefined(arg1))throw new Error("new Resolvable(): token argument is required");if(!isFunction(resolveFn))throw new Error("new Resolvable(): resolveFn argument must be a function");this.token=arg1,this.policy=policy,this.resolveFn=resolveFn,this.deps=deps||[],this.data=data,this.resolved=void 0!==data,this.promise=this.resolved?services.$q.when(this.data):void 0}else if(isObject(arg1)&&arg1.token&&(arg1.hasOwnProperty("resolveFn")||arg1.hasOwnProperty("data"))){var literal=arg1;return new Resolvable(literal.token,literal.resolveFn,literal.deps,literal.policy,literal.data)}}return Resolvable.prototype.getPolicy=function(state){var thisPolicy=this.policy||{},statePolicy=state&&state.resolvePolicy||{};return{when:thisPolicy.when||statePolicy.when||defaultResolvePolicy.when,async:thisPolicy.async||statePolicy.async||defaultResolvePolicy.async}},Resolvable.prototype.resolve=function(resolveContext,trans){var _this=this,$q=services.$q,getResolvableDependencies=function(){return $q.all(resolveContext.getDependencies(_this).map(function(resolvable){return resolvable.get(resolveContext,trans)}))},invokeResolveFn=function(resolvedDeps){return _this.resolveFn.apply(null,resolvedDeps)},node=resolveContext.findNode(this),state=node&&node.state,asyncPolicy=this.getPolicy(state).async,customAsyncPolicy=isFunction(asyncPolicy)?asyncPolicy:identity,applyResolvedValue=function(resolvedValue){return _this.data=resolvedValue,_this.resolved=!0,_this.resolveFn=null,trace.traceResolvableResolved(_this,trans),_this.data};return this.promise=$q.when().then(getResolvableDependencies).then(invokeResolveFn).then(customAsyncPolicy).then(applyResolvedValue)},Resolvable.prototype.get=function(resolveContext,trans){return this.promise||this.resolve(resolveContext,trans)},Resolvable.prototype.toString=function(){return"Resolvable(token: "+stringify(this.token)+", requires: ["+this.deps.map(stringify)+"])"},Resolvable.prototype.clone=function(){return new Resolvable(this)},Resolvable.fromData=function(token,data){return new Resolvable(token,function(){return data},null,null,data)},Resolvable}(),whens=resolvePolicies.when,ALL_WHENS=[whens.EAGER,whens.LAZY],EAGER_WHENS=[whens.EAGER],NATIVE_INJECTOR_TOKEN="Native Injector",ResolveContext=function(){function ResolveContext(_path){this._path=_path}return ResolveContext.prototype.getTokens=function(){return this._path.reduce(function(acc,node){return acc.concat(node.resolvables.map(function(r){return r.token}))},[]).reduce(uniqR,[])},ResolveContext.prototype.getResolvable=function(token){var matching=this._path.map(function(node){return node.resolvables}).reduce(unnestR,[]).filter(function(r){return r.token===token});return tail(matching)},ResolveContext.prototype.getPolicy=function(resolvable){var node=this.findNode(resolvable);return resolvable.getPolicy(node.state)},ResolveContext.prototype.subContext=function(state){return new ResolveContext(PathUtils.subPath(this._path,function(node){return node.state===state}))},ResolveContext.prototype.addResolvables=function(newResolvables,state){var node=find(this._path,propEq("state",state)),keys=newResolvables.map(function(r){return r.token});node.resolvables=node.resolvables.filter(function(r){return-1===keys.indexOf(r.token)}).concat(newResolvables)},ResolveContext.prototype.resolvePath=function(when,trans){var _this=this;void 0===when&&(when="LAZY");var whenOption=inArray(ALL_WHENS,when)?when:"LAZY",matchedWhens=whenOption===resolvePolicies.when.EAGER?EAGER_WHENS:ALL_WHENS;trace.traceResolvePath(this._path,when,trans);var matchesPolicy=function(acceptedVals,whenOrAsync){return function(resolvable){return inArray(acceptedVals,_this.getPolicy(resolvable)[whenOrAsync])}},promises=this._path.reduce(function(acc,node){var nodeResolvables=node.resolvables.filter(matchesPolicy(matchedWhens,"when")),nowait=nodeResolvables.filter(matchesPolicy(["NOWAIT"],"async")),wait=nodeResolvables.filter(not(matchesPolicy(["NOWAIT"],"async"))),subContext=_this.subContext(node.state),getResult=function(r){return r.get(subContext,trans).then(function(value){return{token:r.token,value:value}})};return nowait.forEach(getResult),acc.concat(wait.map(getResult))},[]);return services.$q.all(promises)},ResolveContext.prototype.injector=function(){return this._injector||(this._injector=new UIInjectorImpl(this))},ResolveContext.prototype.findNode=function(resolvable){return find(this._path,function(node){return inArray(node.resolvables,resolvable)})},ResolveContext.prototype.getDependencies=function(resolvable){var _this=this,node=this.findNode(resolvable),subPath=PathUtils.subPath(this._path,function(x){return x===node})||this._path,availableResolvables=subPath.reduce(function(acc,_node){return acc.concat(_node.resolvables)},[]).filter(function(res){return res!==resolvable}),getDependency=function(token){var matching=availableResolvables.filter(function(r){return r.token===token});if(matching.length)return tail(matching);var fromInjector=_this.injector().getNative(token);if(isUndefined(fromInjector))throw new Error("Could not find Dependency Injection token: "+stringify(token));return new Resolvable(token,function(){return fromInjector},[],fromInjector)};return resolvable.deps.map(getDependency)},ResolveContext}(),UIInjectorImpl=function(){function UIInjectorImpl(context){this.context=context,this.native=this.get(NATIVE_INJECTOR_TOKEN)||services.$injector}return UIInjectorImpl.prototype.get=function(token){var resolvable=this.context.getResolvable(token);if(resolvable){if("NOWAIT"===this.context.getPolicy(resolvable).async)return resolvable.get(this.context);if(!resolvable.resolved)throw new Error("Resolvable async .get() not complete:"+stringify(resolvable.token));return resolvable.data}return this.getNative(token)},UIInjectorImpl.prototype.getAsync=function(token){var resolvable=this.context.getResolvable(token);return resolvable?resolvable.get(this.context):services.$q.when(this.native.get(token))},UIInjectorImpl.prototype.getNative=function(token){return this.native&&this.native.get(token)},UIInjectorImpl}(),parseUrl=function(url){if(!isString(url))return!1;var root="^"===url.charAt(0);return{val:root?url.substring(1):url,root:root}},getUrlBuilder=function($urlMatcherFactoryProvider,root){return function(stateObject){var stateDec=stateObject.self;if(stateDec&&stateDec.url&&stateDec.name&&stateDec.name.match(/\.\*\*$/)){var newStateDec={};copy(stateDec,newStateDec),newStateDec.url+="{remainder:any}",stateDec=newStateDec}var parent=stateObject.parent,parsed=parseUrl(stateDec.url),url=parsed?$urlMatcherFactoryProvider.compile(parsed.val,{state:stateDec}):stateDec.url;if(!url)return null;if(!$urlMatcherFactoryProvider.isMatcher(url))throw new Error("Invalid url '"+url+"' in state '"+stateObject+"'");return parsed&&parsed.root?url:(parent&&parent.navigable||root()).url.append(url)}},getNavigableBuilder=function(isRoot){return function(state){return!isRoot(state)&&state.url?state:state.parent?state.parent.navigable:null}},getParamsBuilder=function(paramFactory){return function(state){var makeConfigParam=function(config,id){return paramFactory.fromConfig(id,null,state.self)},urlParams=state.url&&state.url.parameters({inherit:!1})||[],nonUrlParams=values(mapObj(omit(state.params||{},urlParams.map(prop("id"))),makeConfigParam));return urlParams.concat(nonUrlParams).map(function(p){return[p.id,p]}).reduce(applyPairs,{})}},StateBuilder=function(){function StateBuilder(matcher,urlMatcherFactory){function parentBuilder(state){return isRoot(state)?null:matcher.find(self.parentName(state))||root()}this.matcher=matcher;var self=this,root=function(){return matcher.find("")},isRoot=function(state){return""===state.name};this.builders={name:[nameBuilder],self:[selfBuilder],parent:[parentBuilder],data:[dataBuilder],url:[getUrlBuilder(urlMatcherFactory,root)],navigable:[getNavigableBuilder(isRoot)],params:[getParamsBuilder(urlMatcherFactory.paramFactory)],views:[],path:[pathBuilder],includes:[includesBuilder],resolvables:[resolvablesBuilder]}
}return StateBuilder.prototype.builder=function(name,fn){var builders=this.builders,array=builders[name]||[];return isString(name)&&!isDefined(fn)?array.length>1?array:array[0]:isString(name)&&isFunction(fn)?(builders[name]=array,builders[name].push(fn),function(){return builders[name].splice(builders[name].indexOf(fn,1))&&null}):void 0},StateBuilder.prototype.build=function(state){var _a=this,matcher=_a.matcher,builders=_a.builders,parent=this.parentName(state);if(parent&&!matcher.find(parent,void 0,!1))return null;for(var key in builders)if(builders.hasOwnProperty(key)){var chain=builders[key].reduce(function(parentFn,step){return function(_state){return step(_state,parentFn)}},noop);state[key]=chain(state)}return state},StateBuilder.prototype.parentName=function(state){var name=state.name||"",segments=name.split("."),lastSegment=segments.pop();if("**"===lastSegment&&segments.pop(),segments.length){if(state.parent)throw new Error("States that specify the 'parent:' property should not have a '.' in their name ("+name+")");return segments.join(".")}return state.parent?isString(state.parent)?state.parent:state.parent.name:""},StateBuilder.prototype.name=function(state){var name=state.name;if(-1!==name.indexOf(".")||!state.parent)return name;var parentName=isString(state.parent)?state.parent:state.parent.name;return parentName?parentName+"."+name:name},StateBuilder}(),StateObject=function(){function StateObject(config){return StateObject.create(config||{})}return StateObject.create=function(stateDecl){stateDecl=StateObject.isStateClass(stateDecl)?new stateDecl:stateDecl;var state=inherit(inherit(stateDecl,StateObject.prototype));return stateDecl.$$state=function(){return state},state.self=stateDecl,state.__stateObjectCache={nameGlob:Glob.fromString(state.name)},state},StateObject.prototype.is=function(ref){return this===ref||this.self===ref||this.fqn()===ref},StateObject.prototype.fqn=function(){if(!(this.parent&&this.parent instanceof this.constructor))return this.name;var name=this.parent.fqn();return name?name+"."+this.name:this.name},StateObject.prototype.root=function(){return this.parent&&this.parent.root()||this},StateObject.prototype.parameters=function(opts){opts=defaults(opts,{inherit:!0,matchingKeys:null});var inherited=opts.inherit&&this.parent&&this.parent.parameters()||[];return inherited.concat(values(this.params)).filter(function(param){return!opts.matchingKeys||opts.matchingKeys.hasOwnProperty(param.id)})},StateObject.prototype.parameter=function(id,opts){return void 0===opts&&(opts={}),this.url&&this.url.parameter(id,opts)||find(values(this.params),propEq("id",id))||opts.inherit&&this.parent&&this.parent.parameter(id)},StateObject.prototype.toString=function(){return this.fqn()},StateObject.isStateClass=function(stateDecl){return isFunction(stateDecl)&&stateDecl.__uiRouterState===!0},StateObject.isStateDeclaration=function(obj){return isFunction(obj.$$state)},StateObject.isState=function(obj){return isObject(obj.__stateObjectCache)},StateObject}(),StateMatcher=function(){function StateMatcher(_states){this._states=_states}return StateMatcher.prototype.isRelative=function(stateName){return stateName=stateName||"",0===stateName.indexOf(".")||0===stateName.indexOf("^")},StateMatcher.prototype.find=function(stateOrName,base,matchGlob){if(void 0===matchGlob&&(matchGlob=!0),!stateOrName&&""!==stateOrName)return void 0;var isStr=isString(stateOrName),name=isStr?stateOrName:stateOrName.name;this.isRelative(name)&&(name=this.resolvePath(name,base));var state=this._states[name];if(state&&(isStr||!(isStr||state!==stateOrName&&state.self!==stateOrName)))return state;if(isStr&&matchGlob){var _states=values(this._states),matches=_states.filter(function(_state){return _state.__stateObjectCache.nameGlob&&_state.__stateObjectCache.nameGlob.matches(name)});return matches.length>1&&safeConsole.error("stateMatcher.find: Found multiple matches for "+name+" using glob: ",matches.map(function(match){return match.name})),matches[0]}return void 0},StateMatcher.prototype.resolvePath=function(name,base){if(!base)throw new Error("No reference point given for path '"+name+"'");for(var baseState=this.find(base),splitName=name.split("."),pathLength=splitName.length,i=0,current=baseState;pathLength>i;i++)if(""!==splitName[i]||0!==i){if("^"!==splitName[i])break;if(!current.parent)throw new Error("Path '"+name+"' not valid for state '"+baseState.name+"'");current=current.parent}else current=baseState;var relName=splitName.slice(i).join(".");return current.name+(current.name&&relName?".":"")+relName},StateMatcher}(),StateQueueManager=function(){function StateQueueManager(router,states,builder,listeners){this.router=router,this.states=states,this.builder=builder,this.listeners=listeners,this.queue=[]}return StateQueueManager.prototype.dispose=function(){this.queue=[]},StateQueueManager.prototype.register=function(stateDecl){var queue=this.queue,state=StateObject.create(stateDecl),name=state.name;if(!isString(name))throw new Error("State must have a valid name");if(this.states.hasOwnProperty(name)||inArray(queue.map(prop("name")),name))throw new Error("State '"+name+"' is already defined");return queue.push(state),this.flush(),state},StateQueueManager.prototype.flush=function(){for(var _this=this,_a=this,queue=_a.queue,states=_a.states,builder=_a.builder,registered=[],orphans=[],previousQueueLength={},getState=function(name){return _this.states.hasOwnProperty(name)&&_this.states[name]},notifyListeners=function(){registered.length&&_this.listeners.forEach(function(listener){return listener("registered",registered.map(function(s){return s.self}))})};queue.length>0;){var state=queue.shift(),name_1=state.name,result=builder.build(state),orphanIdx=orphans.indexOf(state);if(result){var existingState=getState(name_1);if(existingState&&existingState.name===name_1)throw new Error("State '"+name_1+"' is already defined");var existingFutureState=getState(name_1+".**");existingFutureState&&this.router.stateRegistry.deregister(existingFutureState),states[name_1]=state,this.attachRoute(state),orphanIdx>=0&&orphans.splice(orphanIdx,1),registered.push(state)}else{var prev=previousQueueLength[name_1];if(previousQueueLength[name_1]=queue.length,orphanIdx>=0&&prev===queue.length)return queue.push(state),notifyListeners(),states;0>orphanIdx&&orphans.push(state),queue.push(state)}}return notifyListeners(),states},StateQueueManager.prototype.attachRoute=function(state){if(!state.abstract&&state.url){var rulesApi=this.router.urlService.rules;rulesApi.rule(rulesApi.urlRuleFactory.create(state))}},StateQueueManager}(),StateRegistry=function(){function StateRegistry(router){this.router=router,this.states={},this.listeners=[],this.matcher=new StateMatcher(this.states),this.builder=new StateBuilder(this.matcher,router.urlMatcherFactory),this.stateQueue=new StateQueueManager(router,this.states,this.builder,this.listeners),this._registerRoot()}return StateRegistry.prototype._registerRoot=function(){var rootStateDef={name:"",url:"^",views:null,params:{"#":{value:null,type:"hash",dynamic:!0}},"abstract":!0},_root=this._root=this.stateQueue.register(rootStateDef);_root.navigable=null},StateRegistry.prototype.dispose=function(){var _this=this;this.stateQueue.dispose(),this.listeners=[],this.get().forEach(function(state){return _this.get(state)&&_this.deregister(state)})},StateRegistry.prototype.onStatesChanged=function(listener){return this.listeners.push(listener),function(){removeFrom(this.listeners)(listener)}.bind(this)},StateRegistry.prototype.root=function(){return this._root},StateRegistry.prototype.register=function(stateDefinition){return this.stateQueue.register(stateDefinition)},StateRegistry.prototype._deregisterTree=function(state){var _this=this,all=this.get().map(function(s){return s.$$state()}),getChildren=function(states){var _children=all.filter(function(s){return-1!==states.indexOf(s.parent)});return 0===_children.length?_children:_children.concat(getChildren(_children))},children=getChildren([state]),deregistered=[state].concat(children).reverse();return deregistered.forEach(function(_state){var rulesApi=_this.router.urlService.rules;rulesApi.rules().filter(propEq("state",_state)).forEach(function(rule){return rulesApi.removeRule(rule)}),delete _this.states[_state.name]}),deregistered},StateRegistry.prototype.deregister=function(stateOrName){var _state=this.get(stateOrName);if(!_state)throw new Error("Can't deregister state; not found: "+stateOrName);var deregisteredStates=this._deregisterTree(_state.$$state());return this.listeners.forEach(function(listener){return listener("deregistered",deregisteredStates.map(function(s){return s.self}))}),deregisteredStates},StateRegistry.prototype.get=function(stateOrName,base){var _this=this;if(0===arguments.length)return Object.keys(this.states).map(function(name){return _this.states[name].self});var found=this.matcher.find(stateOrName,base);return found&&found.self||null},StateRegistry.prototype.decorator=function(property,builderFunction){return this.builder.builder(property,builderFunction)},StateRegistry}();!function(TransitionHookPhase){TransitionHookPhase[TransitionHookPhase.CREATE=0]="CREATE",TransitionHookPhase[TransitionHookPhase.BEFORE=1]="BEFORE",TransitionHookPhase[TransitionHookPhase.RUN=2]="RUN",TransitionHookPhase[TransitionHookPhase.SUCCESS=3]="SUCCESS",TransitionHookPhase[TransitionHookPhase.ERROR=4]="ERROR"}(exports.TransitionHookPhase||(exports.TransitionHookPhase={})),function(TransitionHookScope){TransitionHookScope[TransitionHookScope.TRANSITION=0]="TRANSITION",TransitionHookScope[TransitionHookScope.STATE=1]="STATE"}(exports.TransitionHookScope||(exports.TransitionHookScope={}));var defaultRuleSortFn,defaultOptions={current:noop,transition:null,traceData:{},bind:null},TransitionHook=function(){function TransitionHook(transition,stateContext,registeredHook,options){var _this=this;this.transition=transition,this.stateContext=stateContext,this.registeredHook=registeredHook,this.options=options,this.isSuperseded=function(){return _this.type.hookPhase===exports.TransitionHookPhase.RUN&&!_this.options.transition.isActive()},this.options=defaults(options,defaultOptions),this.type=registeredHook.eventType}return TransitionHook.chain=function(hooks,waitFor){var createHookChainR=function(prev,nextHook){return prev.then(function(){return nextHook.invokeHook()})};return hooks.reduce(createHookChainR,waitFor||services.$q.when())},TransitionHook.invokeHooks=function(hooks,doneCallback){for(var idx=0;idx<hooks.length;idx++){var hookResult=hooks[idx].invokeHook();if(isPromise(hookResult)){var remainingHooks=hooks.slice(idx+1);return TransitionHook.chain(remainingHooks,hookResult).then(doneCallback)}}return doneCallback()},TransitionHook.runAllHooks=function(hooks){hooks.forEach(function(hook){return hook.invokeHook()})},TransitionHook.prototype.logError=function(err){this.transition.router.stateService.defaultErrorHandler()(err)},TransitionHook.prototype.invokeHook=function(){var _this=this,hook=this.registeredHook;if(!hook._deregistered){var notCurrent=this.getNotCurrentRejection();if(notCurrent)return notCurrent;var options=this.options;trace.traceHookInvocation(this,this.transition,options);var invokeCallback=function(){return hook.callback.call(options.bind,_this.transition,_this.stateContext)},normalizeErr=function(err){return Rejection.normalize(err).toPromise()},handleError=function(err){return hook.eventType.getErrorHandler(_this)(err)},handleResult=function(result){return hook.eventType.getResultHandler(_this)(result)};try{var result=invokeCallback();return!this.type.synchronous&&isPromise(result)?result.catch(normalizeErr).then(handleResult,handleError):handleResult(result)}catch(err){return handleError(Rejection.normalize(err))}finally{hook.invokeLimit&&++hook.invokeCount>=hook.invokeLimit&&hook.deregister()}}},TransitionHook.prototype.handleHookResult=function(result){var _this=this,notCurrent=this.getNotCurrentRejection();if(notCurrent)return notCurrent;if(isPromise(result))return result.then(function(val){return _this.handleHookResult(val)});if(trace.traceHookResult(result,this.transition,this.options),result===!1)return Rejection.aborted("Hook aborted transition").toPromise();var isTargetState=is(TargetState);return isTargetState(result)?Rejection.redirected(result).toPromise():void 0},TransitionHook.prototype.getNotCurrentRejection=function(){var router=this.transition.router;return router._disposed?Rejection.aborted("UIRouter instance #"+router.$id+" has been stopped (disposed)").toPromise():this.transition._aborted?Rejection.aborted().toPromise():this.isSuperseded()?Rejection.superseded(this.options.current()).toPromise():void 0},TransitionHook.prototype.toString=function(){var _a=this,options=_a.options,registeredHook=_a.registeredHook,event=parse("traceData.hookType")(options)||"internal",context=parse("traceData.context.state.name")(options)||parse("traceData.context")(options)||"unknown",name=fnToString(registeredHook.callback);return event+" context: "+context+", "+maxLength(200,name)},TransitionHook.HANDLE_RESULT=function(hook){return function(result){return hook.handleHookResult(result)}},TransitionHook.LOG_REJECTED_RESULT=function(hook){return function(result){return void(isPromise(result)&&result.catch(function(err){return hook.logError(Rejection.normalize(err))}))}},TransitionHook.LOG_ERROR=function(hook){return function(error){return hook.logError(error)}},TransitionHook.REJECT_ERROR=function(){return function(error){return silentRejection(error)}},TransitionHook.THROW_ERROR=function(){return function(error){throw error}},TransitionHook}(),RegisteredHook=function(){function RegisteredHook(tranSvc,eventType,callback,matchCriteria,removeHookFromRegistry,options){void 0===options&&(options={}),this.tranSvc=tranSvc,this.eventType=eventType,this.callback=callback,this.matchCriteria=matchCriteria,this.removeHookFromRegistry=removeHookFromRegistry,this.invokeCount=0,this._deregistered=!1,this.priority=options.priority||0,this.bind=options.bind||null,this.invokeLimit=options.invokeLimit}return RegisteredHook.prototype._matchingNodes=function(nodes,criterion,transition){if(criterion===!0)return nodes;var matching=nodes.filter(function(node){return matchState(node.state,criterion,transition)});return matching.length?matching:null},RegisteredHook.prototype._getDefaultMatchCriteria=function(){return mapObj(this.tranSvc._pluginapi._getPathTypes(),function(){return!0})},RegisteredHook.prototype._getMatchingNodes=function(treeChanges,transition){var _this=this,criteria=extend(this._getDefaultMatchCriteria(),this.matchCriteria),paths=values(this.tranSvc._pluginapi._getPathTypes());return paths.reduce(function(mn,pathtype){var isStateHook=pathtype.scope===exports.TransitionHookScope.STATE,path=treeChanges[pathtype.name]||[],nodes=isStateHook?path:[tail(path)];return mn[pathtype.name]=_this._matchingNodes(nodes,criteria[pathtype.name],transition),mn},{})},RegisteredHook.prototype.matches=function(treeChanges,transition){var matches=this._getMatchingNodes(treeChanges,transition),allMatched=values(matches).every(identity);return allMatched?matches:null},RegisteredHook.prototype.deregister=function(){this.removeHookFromRegistry(this),this._deregistered=!0},RegisteredHook}(),HookBuilder=function(){function HookBuilder(transition){this.transition=transition}return HookBuilder.prototype.buildHooksForPhase=function(phase){var _this=this,$transitions=this.transition.router.transitionService;return $transitions._pluginapi._getEvents(phase).map(function(type){return _this.buildHooks(type)}).reduce(unnestR,[]).filter(identity)},HookBuilder.prototype.buildHooks=function(hookType){var transition=this.transition,treeChanges=transition.treeChanges(),matchingHooks=this.getMatchingHooks(hookType,treeChanges,transition);if(!matchingHooks)return[];var baseHookOptions={transition:transition,current:transition.options().current},makeTransitionHooks=function(hook){var matches=hook.matches(treeChanges,transition),matchingNodes=matches[hookType.criteriaMatchPath.name];return matchingNodes.map(function(node){var _options=extend({bind:hook.bind,traceData:{hookType:hookType.name,context:node}},baseHookOptions),state=hookType.criteriaMatchPath.scope===exports.TransitionHookScope.STATE?node.state.self:null,transitionHook=new TransitionHook(transition,state,hook,_options);return{hook:hook,node:node,transitionHook:transitionHook}})};return matchingHooks.map(makeTransitionHooks).reduce(unnestR,[]).sort(tupleSort(hookType.reverseSort)).map(function(tuple){return tuple.transitionHook})},HookBuilder.prototype.getMatchingHooks=function(hookType,treeChanges,transition){var isCreate=hookType.hookPhase===exports.TransitionHookPhase.CREATE,$transitions=this.transition.router.transitionService,registries=isCreate?[$transitions]:[this.transition,$transitions];return registries.map(function(reg){return reg.getHooks(hookType.name)}).filter(assertPredicate(isArray,"broken event named: "+hookType.name)).reduce(unnestR,[]).filter(function(hook){return hook.matches(treeChanges,transition)})},HookBuilder}(),stateSelf=prop("self"),Transition=function(){function Transition(fromPath,targetState,router){var _this=this;if(this._deferred=services.$q.defer(),this.promise=this._deferred.promise,this._registeredHooks={},this._hookBuilder=new HookBuilder(this),this.isActive=function(){return _this.router.globals.transition===_this},this.router=router,this._targetState=targetState,!targetState.valid())throw new Error(targetState.error());this._options=extend({current:val(this)},targetState.options()),this.$id=router.transitionService._transitionCount++;var toPath=PathUtils.buildToPath(fromPath,targetState);this._treeChanges=PathUtils.treeChanges(fromPath,toPath,this._options.reloadState),this.createTransitionHookRegFns();var onCreateHooks=this._hookBuilder.buildHooksForPhase(exports.TransitionHookPhase.CREATE);TransitionHook.invokeHooks(onCreateHooks,function(){return null}),this.applyViewConfigs(router)}return Transition.prototype.onBefore=function(){},Transition.prototype.onStart=function(){},Transition.prototype.onExit=function(){},Transition.prototype.onRetain=function(){},Transition.prototype.onEnter=function(){},Transition.prototype.onFinish=function(){},Transition.prototype.onSuccess=function(){},Transition.prototype.onError=function(){},Transition.prototype.createTransitionHookRegFns=function(){var _this=this;this.router.transitionService._pluginapi._getEvents().filter(function(type){return type.hookPhase!==exports.TransitionHookPhase.CREATE}).forEach(function(type){return makeEvent(_this,_this.router.transitionService,type)})},Transition.prototype.getHooks=function(hookName){return this._registeredHooks[hookName]},Transition.prototype.applyViewConfigs=function(router){var enteringStates=this._treeChanges.entering.map(function(node){return node.state});PathUtils.applyViewConfigs(router.transitionService.$view,this._treeChanges.to,enteringStates)},Transition.prototype.$from=function(){return tail(this._treeChanges.from).state},Transition.prototype.$to=function(){return tail(this._treeChanges.to).state},Transition.prototype.from=function(){return this.$from().self},Transition.prototype.to=function(){return this.$to().self},Transition.prototype.targetState=function(){return this._targetState},Transition.prototype.is=function(compare){return compare instanceof Transition?this.is({to:compare.$to().name,from:compare.$from().name}):!(compare.to&&!matchState(this.$to(),compare.to,this)||compare.from&&!matchState(this.$from(),compare.from,this))},Transition.prototype.params=function(pathname){return void 0===pathname&&(pathname="to"),Object.freeze(this._treeChanges[pathname].map(prop("paramValues")).reduce(mergeR,{}))},Transition.prototype.paramsChanged=function(){var fromParams=this.params("from"),toParams=this.params("to"),allParamDescriptors=[].concat(this._treeChanges.to).concat(this._treeChanges.from).map(function(pathNode){return pathNode.paramSchema}).reduce(flattenR,[]).reduce(uniqR,[]),changedParamDescriptors=Param.changed(allParamDescriptors,fromParams,toParams);return changedParamDescriptors.reduce(function(changedValues,descriptor){return changedValues[descriptor.id]=toParams[descriptor.id],changedValues},{})},Transition.prototype.injector=function(state,pathName){void 0===pathName&&(pathName="to");var path=this._treeChanges[pathName];return state&&(path=PathUtils.subPath(path,function(node){return node.state===state||node.state.name===state})),new ResolveContext(path).injector()},Transition.prototype.getResolveTokens=function(pathname){return void 0===pathname&&(pathname="to"),new ResolveContext(this._treeChanges[pathname]).getTokens()},Transition.prototype.addResolvable=function(resolvable,state){void 0===state&&(state=""),resolvable=is(Resolvable)(resolvable)?resolvable:new Resolvable(resolvable);var stateName="string"==typeof state?state:state.name,topath=this._treeChanges.to,targetNode=find(topath,function(node){return node.state.name===stateName}),resolveContext=new ResolveContext(topath);resolveContext.addResolvables([resolvable],targetNode.state)},Transition.prototype.redirectedFrom=function(){return this._options.redirectedFrom||null},Transition.prototype.originalTransition=function(){var rf=this.redirectedFrom();return rf&&rf.originalTransition()||this},Transition.prototype.options=function(){return this._options},Transition.prototype.entering=function(){return map(this._treeChanges.entering,prop("state")).map(stateSelf)},Transition.prototype.exiting=function(){return map(this._treeChanges.exiting,prop("state")).map(stateSelf).reverse()},Transition.prototype.retained=function(){return map(this._treeChanges.retained,prop("state")).map(stateSelf)},Transition.prototype.views=function(pathname,state){void 0===pathname&&(pathname="entering");var path=this._treeChanges[pathname];return path=state?path.filter(propEq("state",state)):path,path.map(prop("views")).filter(identity).reduce(unnestR,[])},Transition.prototype.treeChanges=function(pathname){return pathname?this._treeChanges[pathname]:this._treeChanges},Transition.prototype.redirect=function(targetState){for(var redirects=1,trans=this;null!=(trans=trans.redirectedFrom());)if(++redirects>20)throw new Error("Too many consecutive Transition redirects (20+)");var redirectOpts={redirectedFrom:this,source:"redirect"};"url"===this.options().source&&targetState.options().location!==!1&&(redirectOpts.location="replace");var newOptions=extend({},this.options(),targetState.options(),redirectOpts);targetState=targetState.withOptions(newOptions,!0);var newTransition=this.router.transitionService.create(this._treeChanges.from,targetState),originalEnteringNodes=this._treeChanges.entering,redirectEnteringNodes=newTransition._treeChanges.entering,nodeIsReloading=function(reloadState){return function(node){return reloadState&&node.state.includes[reloadState.name]}},matchingEnteringNodes=PathUtils.matching(redirectEnteringNodes,originalEnteringNodes,PathUtils.nonDynamicParams).filter(not(nodeIsReloading(targetState.options().reloadState)));return matchingEnteringNodes.forEach(function(node,idx){node.resolvables=originalEnteringNodes[idx].resolvables}),newTransition},Transition.prototype._changedParams=function(){var tc=this._treeChanges;if(this._options.reload)return void 0;if(tc.exiting.length||tc.entering.length)return void 0;if(tc.to.length!==tc.from.length)return void 0;var pathsDiffer=arrayTuples(tc.to,tc.from).map(function(tuple){return tuple[0].state!==tuple[1].state}).reduce(anyTrueR,!1);if(pathsDiffer)return void 0;var nodeSchemas=tc.to.map(function(node){return node.paramSchema}),_a=[tc.to,tc.from].map(function(path){return path.map(function(x){return x.paramValues})}),toValues=_a[0],fromValues=_a[1],tuples=arrayTuples(nodeSchemas,toValues,fromValues);return tuples.map(function(_a){var schema=_a[0],toVals=_a[1],fromVals=_a[2];return Param.changed(schema,toVals,fromVals)}).reduce(unnestR,[])},Transition.prototype.dynamic=function(){var changes=this._changedParams();return changes?changes.map(function(x){return x.dynamic}).reduce(anyTrueR,!1):!1},Transition.prototype.ignored=function(){return!!this._ignoredReason()},Transition.prototype._ignoredReason=function(){var pending=this.router.globals.transition,reloadState=this._options.reloadState,same=function(pathA,pathB){if(pathA.length!==pathB.length)return!1;var matching=PathUtils.matching(pathA,pathB);return pathA.length===matching.filter(function(node){return!reloadState||!node.state.includes[reloadState.name]}).length},newTC=this.treeChanges(),pendTC=pending&&pending.treeChanges();return pendTC&&same(pendTC.to,newTC.to)&&same(pendTC.exiting,newTC.exiting)?"SameAsPending":0===newTC.exiting.length&&0===newTC.entering.length&&same(newTC.from,newTC.to)?"SameAsCurrent":void 0},Transition.prototype.run=function(){var _this=this,runAllHooks=TransitionHook.runAllHooks,getHooksFor=function(phase){return _this._hookBuilder.buildHooksForPhase(phase)},transitionSuccess=function(){trace.traceSuccess(_this.$to(),_this),_this.success=!0,_this._deferred.resolve(_this.to()),runAllHooks(getHooksFor(exports.TransitionHookPhase.SUCCESS))},transitionError=function(reason){trace.traceError(reason,_this),_this.success=!1,_this._deferred.reject(reason),_this._error=reason,runAllHooks(getHooksFor(exports.TransitionHookPhase.ERROR))},runTransition=function(){var allRunHooks=getHooksFor(exports.TransitionHookPhase.RUN),done=function(){return services.$q.when(void 0)};return TransitionHook.invokeHooks(allRunHooks,done)},startTransition=function(){var globals=_this.router.globals;return globals.lastStartedTransitionId=_this.$id,globals.transition=_this,globals.transitionHistory.enqueue(_this),trace.traceTransitionStart(_this),services.$q.when(void 0)},allBeforeHooks=getHooksFor(exports.TransitionHookPhase.BEFORE);return TransitionHook.invokeHooks(allBeforeHooks,startTransition).then(runTransition).then(transitionSuccess,transitionError),this.promise},Transition.prototype.valid=function(){return!this.error()||void 0!==this.success},Transition.prototype.abort=function(){isUndefined(this.success)&&(this._aborted=!0)},Transition.prototype.error=function(){var state=this.$to();if(state.self.abstract)return Rejection.invalid("Cannot transition to abstract state '"+state.name+"'");var paramDefs=state.parameters(),values=this.params(),invalidParams=paramDefs.filter(function(param){return!param.validates(values[param.id])});if(invalidParams.length){var invalidValues=invalidParams.map(function(param){return"["+param.id+":"+stringify(values[param.id])+"]"}).join(", "),detail="The following parameter values are not valid for state '"+state.name+"': "+invalidValues;return Rejection.invalid(detail)}return this.success===!1?this._error:void 0},Transition.prototype.toString=function(){var fromStateOrName=this.from(),toStateOrName=this.to(),avoidEmptyHash=function(params){return null!==params["#"]&&void 0!==params["#"]?params:omit(params,["#"])},id=this.$id,from=isObject(fromStateOrName)?fromStateOrName.name:fromStateOrName,fromParams=stringify(avoidEmptyHash(this._treeChanges.from.map(prop("paramValues")).reduce(mergeR,{}))),toValid=this.valid()?"":"(X) ",to=isObject(toStateOrName)?toStateOrName.name:toStateOrName,toParams=stringify(avoidEmptyHash(this.params()));return"Transition#"+id+"( '"+from+"'"+fromParams+" -> "+toValid+"'"+to+"'"+toParams+" )"},Transition.diToken=Transition,Transition}(),memoizeTo=function(obj,_prop,fn){return obj[_prop]=obj[_prop]||fn()},splitOnSlash=splitOnDelim("/"),defaultConfig={state:{params:{}},strict:!0,caseInsensitive:!0,decodeParams:!0},UrlMatcher=function(){function UrlMatcher(pattern,paramTypes,paramFactory,config){var _this=this;this._cache={path:[this]},this._children=[],this._params=[],this._segments=[],this._compiled=[],this.config=config=defaults(config,defaultConfig),this.pattern=pattern;for(var matchArray,details,segment,placeholder=/([:*])([\w\[\]]+)|\{([\w\[\]]+)(?:\:\s*((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,searchPlaceholder=/([:]?)([\w\[\].-]+)|\{([\w\[\].-]+)(?:\:\s*((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,patterns=[],last=0,checkParamErrors=function(id){if(!UrlMatcher.nameValidator.test(id))throw new Error("Invalid parameter name '"+id+"' in pattern '"+pattern+"'");if(find(_this._params,propEq("id",id)))throw new Error("Duplicate parameter name '"+id+"' in pattern '"+pattern+"'")},matchDetails=function(m,isSearch){var id=m[2]||m[3],regexp=isSearch?m[4]:m[4]||("*"===m[1]?"[\\s\\S]*":null),makeRegexpType=function(str){return inherit(paramTypes.type(isSearch?"query":"path"),{pattern:new RegExp(str,_this.config.caseInsensitive?"i":void 0)})};return{id:id,regexp:regexp,segment:pattern.substring(last,m.index),type:regexp?paramTypes.type(regexp)||makeRegexpType(regexp):null}};(matchArray=placeholder.exec(pattern))&&(details=matchDetails(matchArray,!1),!(details.segment.indexOf("?")>=0));)checkParamErrors(details.id),this._params.push(paramFactory.fromPath(details.id,details.type,config.state)),this._segments.push(details.segment),patterns.push([details.segment,tail(this._params)]),last=placeholder.lastIndex;segment=pattern.substring(last);var i=segment.indexOf("?");if(i>=0){var search=segment.substring(i);if(segment=segment.substring(0,i),search.length>0)for(last=0;matchArray=searchPlaceholder.exec(search);)details=matchDetails(matchArray,!0),checkParamErrors(details.id),this._params.push(paramFactory.fromSearch(details.id,details.type,config.state)),last=placeholder.lastIndex}this._segments.push(segment),this._compiled=patterns.map(function(_pattern){return quoteRegExp.apply(null,_pattern)}).concat(quoteRegExp(segment))}return UrlMatcher.encodeDashes=function(str){return encodeURIComponent(str).replace(/-/g,function(c){return"%5C%"+c.charCodeAt(0).toString(16).toUpperCase()})},UrlMatcher.pathSegmentsAndParams=function(matcher){var staticSegments=matcher._segments,pathParams=matcher._params.filter(function(p){return p.location===exports.DefType.PATH});return arrayTuples(staticSegments,pathParams.concat(void 0)).reduce(unnestR,[]).filter(function(x){return""!==x&&isDefined(x)})},UrlMatcher.queryParams=function(matcher){return matcher._params.filter(function(p){return p.location===exports.DefType.SEARCH})},UrlMatcher.compare=function(a,b){var segments=function(matcher){return matcher._cache.segments=matcher._cache.segments||matcher._cache.path.map(UrlMatcher.pathSegmentsAndParams).reduce(unnestR,[]).reduce(joinNeighborsR,[]).map(function(x){return isString(x)?splitOnSlash(x):x}).reduce(unnestR,[])},weights=function(matcher){return matcher._cache.weights=matcher._cache.weights||segments(matcher).map(function(segment){return"/"===segment?1:isString(segment)?2:segment instanceof Param?3:void 0})},padArrays=function(l,r,padVal){for(var len=Math.max(l.length,r.length);l.length<len;)l.push(padVal);for(;r.length<len;)r.push(padVal)},weightsA=weights(a),weightsB=weights(b);padArrays(weightsA,weightsB,0);var cmp,i,_pairs=arrayTuples(weightsA,weightsB);for(i=0;i<_pairs.length;i++)if(cmp=_pairs[i][0]-_pairs[i][1],0!==cmp)return cmp;return 0},UrlMatcher.prototype.append=function(url){return this._children.push(url),url._cache={path:this._cache.path.concat(url),parent:this,pattern:null},url},UrlMatcher.prototype.isRoot=function(){return this._cache.path[0]===this},UrlMatcher.prototype.toString=function(){return this.pattern},UrlMatcher.prototype._getDecodedParamValue=function(value,param){return isDefined(value)&&(this.config.decodeParams&&!param.type.raw&&(value=isArray(value)?value.map(function(paramValue){return decodeURIComponent(paramValue)}):decodeURIComponent(value)),value=param.type.decode(value)),param.value(value)},UrlMatcher.prototype.exec=function(path,search,hash){function decodePathArray(paramVal){var reverseString=function(str){return str.split("").reverse().join("")},unquoteDashes=function(str){return str.replace(/\\-/g,"-")},split=reverseString(paramVal).split(/-(?!\\)/),allReversed=map(split,reverseString);
return map(allReversed,unquoteDashes).reverse()}var _this=this;void 0===search&&(search={});var match=memoizeTo(this._cache,"pattern",function(){return new RegExp(["^",unnest(_this._cache.path.map(prop("_compiled"))).join(""),_this.config.strict===!1?"/?":"","$"].join(""),_this.config.caseInsensitive?"i":void 0)}).exec(path);if(!match)return null;var allParams=this.parameters(),pathParams=allParams.filter(function(param){return!param.isSearch()}),searchParams=allParams.filter(function(param){return param.isSearch()}),nPathSegments=this._cache.path.map(function(urlm){return urlm._segments.length-1}).reduce(function(a,x){return a+x}),values={};if(nPathSegments!==match.length-1)throw new Error("Unbalanced capture group in route '"+this.pattern+"'");for(var i=0;nPathSegments>i;i++){for(var param=pathParams[i],value=match[i+1],j=0;j<param.replace.length;j++)param.replace[j].from===value&&(value=param.replace[j].to);value&&param.array===!0&&(value=decodePathArray(value)),values[param.id]=this._getDecodedParamValue(value,param)}return searchParams.forEach(function(param){for(var value=search[param.id],j=0;j<param.replace.length;j++)param.replace[j].from===value&&(value=param.replace[j].to);values[param.id]=_this._getDecodedParamValue(value,param)}),hash&&(values["#"]=hash),values},UrlMatcher.prototype.parameters=function(opts){return void 0===opts&&(opts={}),opts.inherit===!1?this._params:unnest(this._cache.path.map(function(matcher){return matcher._params}))},UrlMatcher.prototype.parameter=function(id,opts){var _this=this;void 0===opts&&(opts={});var findParam=function(){for(var _i=0,_a=_this._params;_i<_a.length;_i++){var param=_a[_i];if(param.id===id)return param}},parent=this._cache.parent;return findParam()||opts.inherit!==!1&&parent&&parent.parameter(id,opts)||null},UrlMatcher.prototype.validates=function(params){var validParamVal=function(param,val){return!param||param.validates(val)};params=params||{};var paramSchema=this.parameters().filter(function(paramDef){return params.hasOwnProperty(paramDef.id)});return paramSchema.map(function(paramDef){return validParamVal(paramDef,params[paramDef.id])}).reduce(allTrueR,!0)},UrlMatcher.prototype.format=function(values){function getDetails(param){var value=param.value(values[param.id]),isValid=param.validates(value),isDefaultValue=param.isDefaultValue(value),squash=isDefaultValue?param.squash:!1,encoded=param.type.encode(value);return{param:param,value:value,isValid:isValid,isDefaultValue:isDefaultValue,squash:squash,encoded:encoded}}void 0===values&&(values={});var urlMatchers=this._cache.path,pathSegmentsAndParams=urlMatchers.map(UrlMatcher.pathSegmentsAndParams).reduce(unnestR,[]).map(function(x){return isString(x)?x:getDetails(x)}),queryParams=urlMatchers.map(UrlMatcher.queryParams).reduce(unnestR,[]).map(getDetails),isInvalid=function(param){return param.isValid===!1};if(pathSegmentsAndParams.concat(queryParams).filter(isInvalid).length)return null;var pathString=pathSegmentsAndParams.reduce(function(acc,x){if(isString(x))return acc+x;var squash=x.squash,encoded=x.encoded,param=x.param;return squash===!0?acc.match(/\/$/)?acc.slice(0,-1):acc:isString(squash)?acc+squash:squash!==!1?acc:null==encoded?acc:isArray(encoded)?acc+map(encoded,UrlMatcher.encodeDashes).join("-"):param.raw?acc+encoded:acc+encodeURIComponent(encoded)},""),queryString=queryParams.map(function(paramDetails){var param=paramDetails.param,squash=paramDetails.squash,encoded=paramDetails.encoded,isDefaultValue=paramDetails.isDefaultValue;if(!(null==encoded||isDefaultValue&&squash!==!1)&&(isArray(encoded)||(encoded=[encoded]),0!==encoded.length))return param.raw||(encoded=map(encoded,encodeURIComponent)),encoded.map(function(val){return param.id+"="+val})}).filter(identity).reduce(unnestR,[]).join("&");return pathString+(queryString?"?"+queryString:"")+(values["#"]?"#"+values["#"]:"")},UrlMatcher.nameValidator=/^\w+([-.]+\w+)*(?:\[\])?$/,UrlMatcher}(),__assign=void 0||function(){return __assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;n>i;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t},__assign.apply(this,arguments)},ParamFactory=function(){function ParamFactory(router){this.router=router}return ParamFactory.prototype.fromConfig=function(id,type,state){return new Param(id,type,exports.DefType.CONFIG,this.router.urlService.config,state)},ParamFactory.prototype.fromPath=function(id,type,state){return new Param(id,type,exports.DefType.PATH,this.router.urlService.config,state)},ParamFactory.prototype.fromSearch=function(id,type,state){return new Param(id,type,exports.DefType.SEARCH,this.router.urlService.config,state)},ParamFactory}(),UrlMatcherFactory=function(){function UrlMatcherFactory(router){var _this=this;this.router=router,this.paramFactory=new ParamFactory(this.router),this.UrlMatcher=UrlMatcher,this.Param=Param,this.caseInsensitive=function(value){return _this.router.urlService.config.caseInsensitive(value)},this.defaultSquashPolicy=function(value){return _this.router.urlService.config.defaultSquashPolicy(value)},this.strictMode=function(value){return _this.router.urlService.config.strictMode(value)},this.type=function(name,definition,definitionFn){return _this.router.urlService.config.type(name,definition,definitionFn)||_this}}return UrlMatcherFactory.prototype.compile=function(pattern,config){var urlConfig=this.router.urlService.config,params=config&&!config.state&&config.params;config=params?__assign({state:{params:params}},config):config;var globalConfig={strict:urlConfig._isStrictMode,caseInsensitive:urlConfig._isCaseInsensitive,decodeParams:urlConfig._decodeParams};return new UrlMatcher(pattern,urlConfig.paramTypes,this.paramFactory,extend(globalConfig,config))},UrlMatcherFactory.prototype.isMatcher=function(object){if(!isObject(object))return!1;var result=!0;return forEach(UrlMatcher.prototype,function(val,name){isFunction(val)&&(result=result&&isDefined(object[name])&&isFunction(object[name]))}),result},UrlMatcherFactory.prototype.$get=function(){var urlConfig=this.router.urlService.config;return urlConfig.paramTypes.enqueue=!1,urlConfig.paramTypes._flushTypeQueue(),this},UrlMatcherFactory}(),UrlRuleFactory=function(){function UrlRuleFactory(router){this.router=router}return UrlRuleFactory.prototype.compile=function(str){return this.router.urlMatcherFactory.compile(str)},UrlRuleFactory.prototype.create=function(what,handler){var _this=this,isState=StateObject.isState,isStateDeclaration=StateObject.isStateDeclaration,makeRule=pattern([[isString,function(_what){return makeRule(_this.compile(_what))}],[is(UrlMatcher),function(_what){return _this.fromUrlMatcher(_what,handler)}],[or(isState,isStateDeclaration),function(_what){return _this.fromState(_what,_this.router)}],[is(RegExp),function(_what){return _this.fromRegExp(_what,handler)}],[isFunction,function(_what){return new BaseUrlRule(_what,handler)}]]),rule=makeRule(what);if(!rule)throw new Error("invalid 'what' in when()");return rule},UrlRuleFactory.prototype.fromUrlMatcher=function(urlMatcher,handler){function matchUrlParamters(url){var params=urlMatcher.exec(url.path,url.search,url.hash);return urlMatcher.validates(params)&&params}function matchPriority(params){var optional=urlMatcher.parameters().filter(function(param){return param.isOptional});if(!optional.length)return 1e-6;var matched=optional.filter(function(param){return params[param.id]});return matched.length/optional.length}var _handler=handler;isString(handler)&&(handler=this.router.urlMatcherFactory.compile(handler)),is(UrlMatcher)(handler)&&(_handler=function(match){return handler.format(match)});var details={urlMatcher:urlMatcher,matchPriority:matchPriority,type:"URLMATCHER"};return extend(new BaseUrlRule(matchUrlParamters,_handler),details)},UrlRuleFactory.prototype.fromState=function(stateOrDecl,router){var state=StateObject.isStateDeclaration(stateOrDecl)?stateOrDecl.$$state():stateOrDecl,handler=function(match){var $state=router.stateService,globals=router.globals;$state.href(state,match)!==$state.href(globals.current,globals.params)&&$state.transitionTo(state,match,{inherit:!0,source:"url"})},details={state:state,type:"STATE"};return extend(this.fromUrlMatcher(state.url,handler),details)},UrlRuleFactory.prototype.fromRegExp=function(regexp,handler){if(regexp.global||regexp.sticky)throw new Error("Rule RegExp must not be global or sticky");var redirectUrlTo=function(match){return handler.replace(/\$(\$|\d{1,2})/,function(m,what){return match["$"===what?0:Number(what)]})},_handler=isString(handler)?redirectUrlTo:handler,matchParamsFromRegexp=function(url){return regexp.exec(url.path)},details={regexp:regexp,type:"REGEXP"};return extend(new BaseUrlRule(matchParamsFromRegexp,_handler),details)},UrlRuleFactory.isUrlRule=function(obj){return obj&&["type","match","handler"].every(function(key){return isDefined(obj[key])})},UrlRuleFactory}(),BaseUrlRule=function(){function BaseUrlRule(match,handler){var _this=this;this.match=match,this.type="RAW",this.matchPriority=function(){return 0-_this.$id},this.handler=handler||identity}return BaseUrlRule}(),UrlRouter=function(){function UrlRouter(router){var _this=this;this.router=router,this.sync=function(evt){return _this.router.urlService.sync(evt)},this.listen=function(enabled){return _this.router.urlService.listen(enabled)},this.deferIntercept=function(defer){return _this.router.urlService.deferIntercept(defer)},this.match=function(urlParts){return _this.router.urlService.match(urlParts)},this.initial=function(handler){return _this.router.urlService.rules.initial(handler)},this.otherwise=function(handler){return _this.router.urlService.rules.otherwise(handler)},this.removeRule=function(rule){return _this.router.urlService.rules.removeRule(rule)},this.rule=function(rule){return _this.router.urlService.rules.rule(rule)},this.rules=function(){return _this.router.urlService.rules.rules()},this.sort=function(compareFn){return _this.router.urlService.rules.sort(compareFn)},this.when=function(matcher,handler,options){return _this.router.urlService.rules.when(matcher,handler,options)},this.urlRuleFactory=new UrlRuleFactory(router)}return UrlRouter.prototype.update=function(read){var $url=this.router.locationService;return read?void(this.location=$url.url()):void($url.url()!==this.location&&$url.url(this.location,!0))},UrlRouter.prototype.push=function(urlMatcher,params,options){var replace=options&&!!options.replace;this.router.urlService.url(urlMatcher.format(params||{}),replace)},UrlRouter.prototype.href=function(urlMatcher,params,options){var url=urlMatcher.format(params);if(null==url)return null;options=options||{absolute:!1};var cfg=this.router.urlService.config,isHtml5=cfg.html5Mode();if(isHtml5||null===url||(url="#"+cfg.hashPrefix()+url),url=appendBasePath(url,isHtml5,options.absolute,cfg.baseHref()),!options.absolute||!url)return url;var slash=!isHtml5&&url?"/":"",cfgPort=cfg.port(),port=80===cfgPort||443===cfgPort?"":":"+cfgPort;return[cfg.protocol(),"://",cfg.host(),port,slash,url].join("")},Object.defineProperty(UrlRouter.prototype,"interceptDeferred",{get:function(){return this.router.urlService.interceptDeferred},enumerable:!1,configurable:!0}),UrlRouter}(),ViewService=function(){function ViewService(router){var _this=this;this.router=router,this._uiViews=[],this._viewConfigs=[],this._viewConfigFactories={},this._listeners=[],this._pluginapi={_rootViewContext:this._rootViewContext.bind(this),_viewConfigFactory:this._viewConfigFactory.bind(this),_registeredUIView:function(id){return find(_this._uiViews,function(view){return _this.router.$id+"."+view.id===id})},_registeredUIViews:function(){return _this._uiViews},_activeViewConfigs:function(){return _this._viewConfigs},_onSync:function(listener){return _this._listeners.push(listener),function(){return removeFrom(_this._listeners,listener)}}}}return ViewService.normalizeUIViewTarget=function(context,rawViewName){void 0===rawViewName&&(rawViewName="");var viewAtContext=rawViewName.split("@"),uiViewName=viewAtContext[0]||"$default",uiViewContextAnchor=isString(viewAtContext[1])?viewAtContext[1]:"^",relativeViewNameSugar=/^(\^(?:\.\^)*)\.(.*$)/.exec(uiViewName);relativeViewNameSugar&&(uiViewContextAnchor=relativeViewNameSugar[1],uiViewName=relativeViewNameSugar[2]),"!"===uiViewName.charAt(0)&&(uiViewName=uiViewName.substr(1),uiViewContextAnchor="");var relativeMatch=/^(\^(?:\.\^)*)$/;if(relativeMatch.exec(uiViewContextAnchor)){var anchorState=uiViewContextAnchor.split(".").reduce(function(anchor){return anchor.parent},context);uiViewContextAnchor=anchorState.name}else"."===uiViewContextAnchor&&(uiViewContextAnchor=context.name);return{uiViewName:uiViewName,uiViewContextAnchor:uiViewContextAnchor}},ViewService.prototype._rootViewContext=function(context){return this._rootContext=context||this._rootContext},ViewService.prototype._viewConfigFactory=function(viewType,factory){this._viewConfigFactories[viewType]=factory},ViewService.prototype.createViewConfig=function(path,decl){var cfgFactory=this._viewConfigFactories[decl.$type];if(!cfgFactory)throw new Error("ViewService: No view config factory registered for type "+decl.$type);var cfgs=cfgFactory(path,decl);return isArray(cfgs)?cfgs:[cfgs]},ViewService.prototype.deactivateViewConfig=function(viewConfig){trace.traceViewServiceEvent("<- Removing",viewConfig),removeFrom(this._viewConfigs,viewConfig)},ViewService.prototype.activateViewConfig=function(viewConfig){trace.traceViewServiceEvent("-> Registering",viewConfig),this._viewConfigs.push(viewConfig)},ViewService.prototype.sync=function(){function uiViewDepth(uiView){var stateDepth=function(context){return context&&context.parent?stateDepth(context.parent)+1:1};return 1e4*uiView.fqn.split(".").length+stateDepth(uiView.creationContext)}function viewConfigDepth(config){for(var context=config.viewDecl.$context,count=0;++count&&context.parent;)context=context.parent;return count}var _this=this,uiViewsByFqn=this._uiViews.map(function(uiv){return[uiv.fqn,uiv]}).reduce(applyPairs,{}),depthCompare=curry(function(depthFn,posNeg,left,right){return posNeg*(depthFn(left)-depthFn(right))}),matchingConfigPair=function(uiView){var matchingConfigs=_this._viewConfigs.filter(ViewService.matches(uiViewsByFqn,uiView));return matchingConfigs.length>1&&matchingConfigs.sort(depthCompare(viewConfigDepth,-1)),{uiView:uiView,viewConfig:matchingConfigs[0]}},configureUIView=function(tuple){-1!==_this._uiViews.indexOf(tuple.uiView)&&tuple.uiView.configUpdated(tuple.viewConfig)},uiViewTuples=this._uiViews.sort(depthCompare(uiViewDepth,1)).map(matchingConfigPair),matchedViewConfigs=uiViewTuples.map(function(tuple){return tuple.viewConfig}),unmatchedConfigTuples=this._viewConfigs.filter(function(config){return!inArray(matchedViewConfigs,config)}).map(function(viewConfig){return{uiView:void 0,viewConfig:viewConfig}});uiViewTuples.forEach(configureUIView);var allTuples=uiViewTuples.concat(unmatchedConfigTuples);this._listeners.forEach(function(cb){return cb(allTuples)}),trace.traceViewSync(allTuples)},ViewService.prototype.registerUIView=function(uiView){trace.traceViewServiceUIViewEvent("-> Registering",uiView);var uiViews=this._uiViews,fqnAndTypeMatches=function(uiv){return uiv.fqn===uiView.fqn&&uiv.$type===uiView.$type};return uiViews.filter(fqnAndTypeMatches).length&&trace.traceViewServiceUIViewEvent("!!!! duplicate uiView named:",uiView),uiViews.push(uiView),this.sync(),function(){var idx=uiViews.indexOf(uiView);return-1===idx?void trace.traceViewServiceUIViewEvent("Tried removing non-registered uiView",uiView):(trace.traceViewServiceUIViewEvent("<- Deregistering",uiView),void removeFrom(uiViews)(uiView))}},ViewService.prototype.available=function(){return this._uiViews.map(prop("fqn"))},ViewService.prototype.active=function(){return this._uiViews.filter(prop("$config")).map(prop("name"))},ViewService.matches=function(uiViewsByFqn,uiView){return function(viewConfig){if(uiView.$type!==viewConfig.viewDecl.$type)return!1;var vc=viewConfig.viewDecl,vcSegments=vc.$uiViewName.split("."),uivSegments=uiView.fqn.split(".");if(!equals(vcSegments,uivSegments.slice(0-vcSegments.length)))return!1;var negOffset=1-vcSegments.length||void 0,fqnToFirstSegment=uivSegments.slice(0,negOffset).join("."),uiViewContext=uiViewsByFqn[fqnToFirstSegment].creationContext;return vc.$uiViewContextAnchor===(uiViewContext&&uiViewContext.name)}},ViewService}(),UIRouterGlobals=function(){function UIRouterGlobals(){this.params=new StateParams,this.lastStartedTransitionId=-1,this.transitionHistory=new Queue([],1),this.successfulTransitions=new Queue([],1)}return UIRouterGlobals.prototype.dispose=function(){this.transitionHistory.clear(),this.successfulTransitions.clear(),this.transition=null},UIRouterGlobals}(),prioritySort=function(a,b){return(b.priority||0)-(a.priority||0)},typeSort=function(a,b){var weights={STATE:4,URLMATCHER:4,REGEXP:3,RAW:2,OTHER:1};return(weights[a.type]||0)-(weights[b.type]||0)},urlMatcherSort=function(a,b){return a.urlMatcher&&b.urlMatcher?UrlMatcher.compare(a.urlMatcher,b.urlMatcher):0},idSort=function(a,b){var useMatchPriority={STATE:!0,URLMATCHER:!0},equal=useMatchPriority[a.type]&&useMatchPriority[b.type];return equal?0:(a.$id||0)-(b.$id||0)};defaultRuleSortFn=function(a,b){var cmp=prioritySort(a,b);return 0!==cmp?cmp:(cmp=typeSort(a,b),0!==cmp?cmp:(cmp=urlMatcherSort(a,b),0!==cmp?cmp:idSort(a,b)))};var UrlRules=function(){function UrlRules(router){this.router=router,this._sortFn=defaultRuleSortFn,this._rules=[],this._id=0,this.urlRuleFactory=new UrlRuleFactory(router)}return UrlRules.prototype.dispose=function(){this._rules=[],delete this._otherwiseFn},UrlRules.prototype.initial=function(handler){var handlerFn=getHandlerFn(handler),matchFn=function(urlParts,router){return 0===router.globals.transitionHistory.size()&&!!/^\/?$/.exec(urlParts.path)};this.rule(this.urlRuleFactory.create(matchFn,handlerFn))},UrlRules.prototype.otherwise=function(handler){var handlerFn=getHandlerFn(handler);this._otherwiseFn=this.urlRuleFactory.create(val(!0),handlerFn),this._sorted=!1},UrlRules.prototype.removeRule=function(rule){removeFrom(this._rules,rule)},UrlRules.prototype.rule=function(rule){var _this=this;if(!UrlRuleFactory.isUrlRule(rule))throw new Error("invalid rule");return rule.$id=this._id++,rule.priority=rule.priority||0,this._rules.push(rule),this._sorted=!1,function(){return _this.removeRule(rule)}},UrlRules.prototype.rules=function(){return this.ensureSorted(),this._rules.concat(this._otherwiseFn?[this._otherwiseFn]:[])},UrlRules.prototype.sort=function(compareFn){for(var sorted=this.stableSort(this._rules,this._sortFn=compareFn||this._sortFn),group=0,i=0;i<sorted.length;i++)sorted[i]._group=group,i<sorted.length-1&&0!==this._sortFn(sorted[i],sorted[i+1])&&group++;this._rules=sorted,this._sorted=!0},UrlRules.prototype.ensureSorted=function(){this._sorted||this.sort()},UrlRules.prototype.stableSort=function(arr,compareFn){var arrOfWrapper=arr.map(function(elem,idx){return{elem:elem,idx:idx}});return arrOfWrapper.sort(function(wrapperA,wrapperB){var cmpDiff=compareFn(wrapperA.elem,wrapperB.elem);return 0===cmpDiff?wrapperA.idx-wrapperB.idx:cmpDiff}),arrOfWrapper.map(function(wrapper){return wrapper.elem})},UrlRules.prototype.when=function(matcher,handler,options){var rule=this.urlRuleFactory.create(matcher,handler);return isDefined(options&&options.priority)&&(rule.priority=options.priority),this.rule(rule),rule},UrlRules}(),UrlConfig=function(){function UrlConfig(router){var _this=this;this.router=router,this.paramTypes=new ParamTypes,this._decodeParams=!0,this._isCaseInsensitive=!1,this._isStrictMode=!0,this._defaultSquashPolicy=!1,this.dispose=function(){return _this.paramTypes.dispose()},this.baseHref=function(){return _this.router.locationConfig.baseHref()},this.hashPrefix=function(newprefix){return _this.router.locationConfig.hashPrefix(newprefix)},this.host=function(){return _this.router.locationConfig.host()},this.html5Mode=function(){return _this.router.locationConfig.html5Mode()},this.port=function(){return _this.router.locationConfig.port()},this.protocol=function(){return _this.router.locationConfig.protocol()}}return UrlConfig.prototype.caseInsensitive=function(value){return this._isCaseInsensitive=isDefined(value)?value:this._isCaseInsensitive},UrlConfig.prototype.defaultSquashPolicy=function(value){if(isDefined(value)&&value!==!0&&value!==!1&&!isString(value))throw new Error("Invalid squash policy: "+value+". Valid policies: false, true, arbitrary-string");return this._defaultSquashPolicy=isDefined(value)?value:this._defaultSquashPolicy},UrlConfig.prototype.strictMode=function(value){return this._isStrictMode=isDefined(value)?value:this._isStrictMode},UrlConfig.prototype.type=function(name,definition,definitionFn){var type=this.paramTypes.type(name,definition,definitionFn);return isDefined(definition)?this:type},UrlConfig}(),UrlService=function(){function UrlService(router){var _this=this;this.router=router,this.interceptDeferred=!1,this.rules=new UrlRules(this.router),this.config=new UrlConfig(this.router),this.url=function(newurl,replace,state){return _this.router.locationService.url(newurl,replace,state)},this.path=function(){return _this.router.locationService.path()},this.search=function(){return _this.router.locationService.search()},this.hash=function(){return _this.router.locationService.hash()},this.onChange=function(callback){return _this.router.locationService.onChange(callback)}}return UrlService.prototype.dispose=function(){this.listen(!1),this.rules.dispose()},UrlService.prototype.parts=function(){return{path:this.path(),search:this.search(),hash:this.hash()}},UrlService.prototype.sync=function(evt){if(!evt||!evt.defaultPrevented){var _a=this.router,urlService=_a.urlService,stateService=_a.stateService,url={path:urlService.path(),search:urlService.search(),hash:urlService.hash()},best=this.match(url),applyResult=pattern([[isString,function(newurl){return urlService.url(newurl,!0)}],[TargetState.isDef,function(def){return stateService.go(def.state,def.params,def.options)}],[is(TargetState),function(target){return stateService.go(target.state(),target.params(),target.options())}]]);applyResult(best&&best.rule.handler(best.match,url,this.router))}},UrlService.prototype.listen=function(enabled){var _this=this;return enabled!==!1?this._stopListeningFn=this._stopListeningFn||this.router.urlService.onChange(function(evt){return _this.sync(evt)}):(this._stopListeningFn&&this._stopListeningFn(),void delete this._stopListeningFn)},UrlService.prototype.deferIntercept=function(defer){void 0===defer&&(defer=!0),this.interceptDeferred=defer},UrlService.prototype.match=function(url){var _this=this;url=extend({path:"",search:{},hash:""},url);for(var best,rules=this.rules.rules(),checkRule=function(rule){var match=rule.match(url,_this.router);return match&&{match:match,rule:rule,weight:rule.matchPriority(match)}},i=0;i<rules.length&&(!best||best.rule._group===rules[i]._group);i++){var current=checkRule(rules[i]);best=!best||current&&current.weight>best.weight?current:best}return best},UrlService}(),_routerInstance=0,locSvcFns=["url","path","search","hash","onChange"],locCfgFns=["port","protocol","host","baseHref","html5Mode","hashPrefix"],locationServiceStub=makeStub("LocationServices",locSvcFns),locationConfigStub=makeStub("LocationConfig",locCfgFns),UIRouter=function(){function UIRouter(locationService,locationConfig){void 0===locationService&&(locationService=locationServiceStub),void 0===locationConfig&&(locationConfig=locationConfigStub),this.locationService=locationService,this.locationConfig=locationConfig,this.$id=_routerInstance++,this._disposed=!1,this._disposables=[],this.trace=trace,this.viewService=new ViewService(this),this.globals=new UIRouterGlobals,this.transitionService=new TransitionService(this),this.urlMatcherFactory=new UrlMatcherFactory(this),this.urlRouter=new UrlRouter(this),this.urlService=new UrlService(this),this.stateRegistry=new StateRegistry(this),this.stateService=new StateService(this),this._plugins={},this.viewService._pluginapi._rootViewContext(this.stateRegistry.root()),this.globals.$current=this.stateRegistry.root(),this.globals.current=this.globals.$current.self,this.disposable(this.globals),this.disposable(this.stateService),this.disposable(this.stateRegistry),this.disposable(this.transitionService),this.disposable(this.urlService),this.disposable(locationService),this.disposable(locationConfig)}return UIRouter.prototype.disposable=function(disposable){this._disposables.push(disposable)},UIRouter.prototype.dispose=function(disposable){var _this=this;return disposable&&isFunction(disposable.dispose)?void disposable.dispose(this):(this._disposed=!0,void this._disposables.slice().forEach(function(d){try{"function"==typeof d.dispose&&d.dispose(_this),removeFrom(_this._disposables,d)}catch(ignored){}}))},UIRouter.prototype.plugin=function(plugin,options){void 0===options&&(options={});var pluginInstance=new plugin(this,options);if(!pluginInstance.name)throw new Error("Required property `name` missing on plugin: "+pluginInstance);return this._disposables.push(pluginInstance),this._plugins[pluginInstance.name]=pluginInstance},UIRouter.prototype.getPlugin=function(pluginName){return pluginName?this._plugins[pluginName]:values(this._plugins)},UIRouter}(),registerAddCoreResolvables=function(transitionService){return transitionService.onCreate({},addCoreResolvables)},TRANSITION_TOKENS=["$transition$",Transition],isTransition=inArray(TRANSITION_TOKENS),treeChangesCleanup=function(trans){var nodes=values(trans.treeChanges()).reduce(unnestR,[]).reduce(uniqR,[]),replaceTransitionWithNull=function(r){return isTransition(r.token)?Resolvable.fromData(r.token,null):r};nodes.forEach(function(node){node.resolvables=node.resolvables.map(replaceTransitionWithNull)})},redirectToHook=function(trans){function handleResult(result){return result?result instanceof TargetState?result:isString(result)?$state.target(result,trans.params(),trans.options()):result.state||result.params?$state.target(result.state||trans.to(),result.params||trans.params(),trans.options()):void 0:void 0}var redirect=trans.to().redirectTo;if(redirect){var $state=trans.router.stateService;return isFunction(redirect)?services.$q.when(redirect(trans)).then(handleResult):handleResult(redirect)}},registerRedirectToHook=function(transitionService){return transitionService.onStart({to:function(state){return!!state.redirectTo}},redirectToHook)},onExitHook=makeEnterExitRetainHook("onExit"),registerOnExitHook=function(transitionService){return transitionService.onExit({exiting:function(state){return!!state.onExit}},onExitHook)},onRetainHook=makeEnterExitRetainHook("onRetain"),registerOnRetainHook=function(transitionService){return transitionService.onRetain({retained:function(state){return!!state.onRetain}},onRetainHook)},onEnterHook=makeEnterExitRetainHook("onEnter"),registerOnEnterHook=function(transitionService){return transitionService.onEnter({entering:function(state){return!!state.onEnter}},onEnterHook)},RESOLVE_HOOK_PRIORITY=1e3,eagerResolvePath=function(trans){return new ResolveContext(trans.treeChanges().to).resolvePath("EAGER",trans).then(noop)},registerEagerResolvePath=function(transitionService){return transitionService.onStart({},eagerResolvePath,{priority:RESOLVE_HOOK_PRIORITY})},lazyResolveState=function(trans,state){return new ResolveContext(trans.treeChanges().to).subContext(state.$$state()).resolvePath("LAZY",trans).then(noop)},registerLazyResolveState=function(transitionService){return transitionService.onEnter({entering:val(!0)},lazyResolveState,{priority:RESOLVE_HOOK_PRIORITY})},resolveRemaining=function(trans){return new ResolveContext(trans.treeChanges().to).resolvePath("LAZY",trans).then(noop)},registerResolveRemaining=function(transitionService){return transitionService.onFinish({},resolveRemaining,{priority:RESOLVE_HOOK_PRIORITY})},loadEnteringViews=function(transition){var $q=services.$q,enteringViews=transition.views("entering");return enteringViews.length?$q.all(enteringViews.map(function(view){return $q.when(view.load())})).then(noop):void 0},registerLoadEnteringViews=function(transitionService){return transitionService.onFinish({},loadEnteringViews)},activateViews=function(transition){var enteringViews=transition.views("entering"),exitingViews=transition.views("exiting");if(enteringViews.length||exitingViews.length){var $view=transition.router.viewService;exitingViews.forEach(function(vc){return $view.deactivateViewConfig(vc)}),enteringViews.forEach(function(vc){return $view.activateViewConfig(vc)}),$view.sync()}},registerActivateViews=function(transitionService){return transitionService.onSuccess({},activateViews)},updateGlobalState=function(trans){var globals=trans.router.globals,transitionSuccessful=function(){globals.successfulTransitions.enqueue(trans),globals.$current=trans.$to(),globals.current=globals.$current.self,copy(trans.params(),globals.params)},clearCurrentTransition=function(){globals.transition===trans&&(globals.transition=null)};trans.onSuccess({},transitionSuccessful,{priority:1e4}),trans.promise.then(clearCurrentTransition,clearCurrentTransition)},registerUpdateGlobalState=function(transitionService){return transitionService.onCreate({},updateGlobalState)},updateUrl=function(transition){var options=transition.options(),$state=transition.router.stateService,$urlRouter=transition.router.urlRouter;if("url"!==options.source&&options.location&&$state.$current.navigable){var urlOptions={replace:"replace"===options.location};$urlRouter.push($state.$current.navigable.url,$state.params,urlOptions)}$urlRouter.update(!0)},registerUpdateUrl=function(transitionService){return transitionService.onSuccess({},updateUrl,{priority:9999})},lazyLoadHook=function(transition){function retryTransition(){if("url"!==transition.originalTransition().options().source){var orig=transition.targetState();return router.stateService.target(orig.identifier(),orig.params(),orig.options())}var $url=router.urlService,result=$url.match($url.parts()),rule=result&&result.rule;if(rule&&"STATE"===rule.type){var state=rule.state,params=result.match;return router.stateService.target(state,params,transition.options())}router.urlService.sync()}var router=transition.router,promises=transition.entering().filter(function(state){return!!state.$$state().lazyLoad}).map(function(state){return lazyLoadState(transition,state)});return services.$q.all(promises).then(retryTransition)},registerLazyLoadHook=function(transitionService){return transitionService.onBefore({entering:function(state){return!!state.lazyLoad}},lazyLoadHook)},TransitionEventType=function(){function TransitionEventType(name,hookPhase,hookOrder,criteriaMatchPath,reverseSort,getResultHandler,getErrorHandler,synchronous){void 0===reverseSort&&(reverseSort=!1),void 0===getResultHandler&&(getResultHandler=TransitionHook.HANDLE_RESULT),void 0===getErrorHandler&&(getErrorHandler=TransitionHook.REJECT_ERROR),void 0===synchronous&&(synchronous=!1),this.name=name,this.hookPhase=hookPhase,this.hookOrder=hookOrder,this.criteriaMatchPath=criteriaMatchPath,this.reverseSort=reverseSort,this.getResultHandler=getResultHandler,this.getErrorHandler=getErrorHandler,this.synchronous=synchronous}return TransitionEventType}(),registerIgnoredTransitionHook=function(transitionService){return transitionService.onBefore({},ignoredHook,{priority:-9999})},registerInvalidTransitionHook=function(transitionService){return transitionService.onBefore({},invalidTransitionHook,{priority:-1e4})},defaultTransOpts={location:!0,relative:null,inherit:!1,notify:!0,reload:!1,supercede:!0,custom:{},current:function(){return null},source:"unknown"},TransitionService=function(){function TransitionService(_router){this._transitionCount=0,this._eventTypes=[],this._registeredHooks={},this._criteriaPaths={},this._router=_router,this.$view=_router.viewService,this._deregisterHookFns={},this._pluginapi=createProxyFunctions(val(this),{},val(this),["_definePathType","_defineEvent","_getPathTypes","_getEvents","getHooks"]),this._defineCorePaths(),this._defineCoreEvents(),this._registerCoreTransitionHooks(),_router.globals.successfulTransitions.onEvict(treeChangesCleanup)
}return TransitionService.prototype.onCreate=function(){},TransitionService.prototype.onBefore=function(){},TransitionService.prototype.onStart=function(){},TransitionService.prototype.onExit=function(){},TransitionService.prototype.onRetain=function(){},TransitionService.prototype.onEnter=function(){},TransitionService.prototype.onFinish=function(){},TransitionService.prototype.onSuccess=function(){},TransitionService.prototype.onError=function(){},TransitionService.prototype.dispose=function(){values(this._registeredHooks).forEach(function(hooksArray){return hooksArray.forEach(function(hook){hook._deregistered=!0,removeFrom(hooksArray,hook)})})},TransitionService.prototype.create=function(fromPath,targetState){return new Transition(fromPath,targetState,this._router)},TransitionService.prototype._defineCoreEvents=function(){var Phase=exports.TransitionHookPhase,TH=TransitionHook,paths=this._criteriaPaths,NORMAL_SORT=!1,REVERSE_SORT=!0,SYNCHRONOUS=!0;this._defineEvent("onCreate",Phase.CREATE,0,paths.to,NORMAL_SORT,TH.LOG_REJECTED_RESULT,TH.THROW_ERROR,SYNCHRONOUS),this._defineEvent("onBefore",Phase.BEFORE,0,paths.to),this._defineEvent("onStart",Phase.RUN,0,paths.to),this._defineEvent("onExit",Phase.RUN,100,paths.exiting,REVERSE_SORT),this._defineEvent("onRetain",Phase.RUN,200,paths.retained),this._defineEvent("onEnter",Phase.RUN,300,paths.entering),this._defineEvent("onFinish",Phase.RUN,400,paths.to),this._defineEvent("onSuccess",Phase.SUCCESS,0,paths.to,NORMAL_SORT,TH.LOG_REJECTED_RESULT,TH.LOG_ERROR,SYNCHRONOUS),this._defineEvent("onError",Phase.ERROR,0,paths.to,NORMAL_SORT,TH.LOG_REJECTED_RESULT,TH.LOG_ERROR,SYNCHRONOUS)},TransitionService.prototype._defineCorePaths=function(){var STATE=exports.TransitionHookScope.STATE,TRANSITION=exports.TransitionHookScope.TRANSITION;this._definePathType("to",TRANSITION),this._definePathType("from",TRANSITION),this._definePathType("exiting",STATE),this._definePathType("retained",STATE),this._definePathType("entering",STATE)},TransitionService.prototype._defineEvent=function(name,hookPhase,hookOrder,criteriaMatchPath,reverseSort,getResultHandler,getErrorHandler,synchronous){void 0===reverseSort&&(reverseSort=!1),void 0===getResultHandler&&(getResultHandler=TransitionHook.HANDLE_RESULT),void 0===getErrorHandler&&(getErrorHandler=TransitionHook.REJECT_ERROR),void 0===synchronous&&(synchronous=!1);var eventType=new TransitionEventType(name,hookPhase,hookOrder,criteriaMatchPath,reverseSort,getResultHandler,getErrorHandler,synchronous);this._eventTypes.push(eventType),makeEvent(this,this,eventType)},TransitionService.prototype._getEvents=function(phase){var transitionHookTypes=isDefined(phase)?this._eventTypes.filter(function(type){return type.hookPhase===phase}):this._eventTypes.slice();return transitionHookTypes.sort(function(l,r){var cmpByPhase=l.hookPhase-r.hookPhase;return 0===cmpByPhase?l.hookOrder-r.hookOrder:cmpByPhase})},TransitionService.prototype._definePathType=function(name,hookScope){this._criteriaPaths[name]={name:name,scope:hookScope}},TransitionService.prototype._getPathTypes=function(){return this._criteriaPaths},TransitionService.prototype.getHooks=function(hookName){return this._registeredHooks[hookName]},TransitionService.prototype._registerCoreTransitionHooks=function(){var fns=this._deregisterHookFns;fns.addCoreResolves=registerAddCoreResolvables(this),fns.ignored=registerIgnoredTransitionHook(this),fns.invalid=registerInvalidTransitionHook(this),fns.redirectTo=registerRedirectToHook(this),fns.onExit=registerOnExitHook(this),fns.onRetain=registerOnRetainHook(this),fns.onEnter=registerOnEnterHook(this),fns.eagerResolve=registerEagerResolvePath(this),fns.lazyResolve=registerLazyResolveState(this),fns.resolveAll=registerResolveRemaining(this),fns.loadViews=registerLoadEnteringViews(this),fns.activateViews=registerActivateViews(this),fns.updateGlobals=registerUpdateGlobalState(this),fns.updateUrl=registerUpdateUrl(this),fns.lazyLoad=registerLazyLoadHook(this)},TransitionService}(),StateService=function(){function StateService(router){this.router=router,this.invalidCallbacks=[],this._defaultErrorHandler=function($error$){$error$ instanceof Error&&$error$.stack?(console.error($error$),console.error($error$.stack)):$error$ instanceof Rejection?(console.error($error$.toString()),$error$.detail&&$error$.detail.stack&&console.error($error$.detail.stack)):console.error($error$)};var getters=["current","$current","params","transition"],boundFns=Object.keys(StateService.prototype).filter(not(inArray(getters)));createProxyFunctions(val(StateService.prototype),this,val(this),boundFns)}return Object.defineProperty(StateService.prototype,"transition",{get:function(){return this.router.globals.transition},enumerable:!1,configurable:!0}),Object.defineProperty(StateService.prototype,"params",{get:function(){return this.router.globals.params},enumerable:!1,configurable:!0}),Object.defineProperty(StateService.prototype,"current",{get:function(){return this.router.globals.current},enumerable:!1,configurable:!0}),Object.defineProperty(StateService.prototype,"$current",{get:function(){return this.router.globals.$current},enumerable:!1,configurable:!0}),StateService.prototype.dispose=function(){this.defaultErrorHandler(noop),this.invalidCallbacks=[]},StateService.prototype._handleInvalidTargetState=function(fromPath,toState){function invokeNextCallback(){var nextCallback=callbackQueue.dequeue();if(void 0===nextCallback)return Rejection.invalid(toState.error()).toPromise();var callbackResult=services.$q.when(nextCallback(toState,fromState,injector));return callbackResult.then(checkForRedirect).then(function(result){return result||invokeNextCallback()})}var _this=this,fromState=PathUtils.makeTargetState(this.router.stateRegistry,fromPath),globals=this.router.globals,latestThing=function(){return globals.transitionHistory.peekTail()},latest=latestThing(),callbackQueue=new Queue(this.invalidCallbacks.slice()),injector=new ResolveContext(fromPath).injector(),checkForRedirect=function(result){if(result instanceof TargetState){var target=result;return target=_this.target(target.identifier(),target.params(),target.options()),target.valid()?latestThing()!==latest?Rejection.superseded().toPromise():_this.transitionTo(target.identifier(),target.params(),target.options()):Rejection.invalid(target.error()).toPromise()}};return invokeNextCallback()},StateService.prototype.onInvalid=function(callback){return this.invalidCallbacks.push(callback),function(){removeFrom(this.invalidCallbacks)(callback)}.bind(this)},StateService.prototype.reload=function(reloadState){return this.transitionTo(this.current,this.params,{reload:isDefined(reloadState)?reloadState:!0,inherit:!1,notify:!1})},StateService.prototype.go=function(to,params,options){var defautGoOpts={relative:this.$current,inherit:!0},transOpts=defaults(options,defautGoOpts,defaultTransOpts);return this.transitionTo(to,params,transOpts)},StateService.prototype.target=function(identifier,params,options){if(void 0===options&&(options={}),isObject(options.reload)&&!options.reload.name)throw new Error("Invalid reload state object");var reg=this.router.stateRegistry;if(options.reloadState=options.reload===!0?reg.root():reg.matcher.find(options.reload,options.relative),options.reload&&!options.reloadState)throw new Error("No such reload state '"+(isString(options.reload)?options.reload:options.reload.name)+"'");return new TargetState(this.router.stateRegistry,identifier,params,options)},StateService.prototype.getCurrentPath=function(){var _this=this,globals=this.router.globals,latestSuccess=globals.successfulTransitions.peekTail(),rootPath=function(){return[new PathNode(_this.router.stateRegistry.root())]};return latestSuccess?latestSuccess.treeChanges().to:rootPath()},StateService.prototype.transitionTo=function(to,toParams,options){var _this=this;void 0===toParams&&(toParams={}),void 0===options&&(options={});var router=this.router,globals=router.globals;options=defaults(options,defaultTransOpts);var getCurrent=function(){return globals.transition};options=extend(options,{current:getCurrent});var ref=this.target(to,toParams,options),currentPath=this.getCurrentPath();if(!ref.exists())return this._handleInvalidTargetState(currentPath,ref);if(!ref.valid())return silentRejection(ref.error());if(options.supercede===!1&&getCurrent())return Rejection.ignored("Another transition is in progress and supercede has been set to false in TransitionOptions for the transition. So the transition was ignored in favour of the existing one in progress.").toPromise();var rejectedTransitionHandler=function(trans){return function(error){if(error instanceof Rejection){var isLatest=router.globals.lastStartedTransitionId<=trans.$id;if(error.type===exports.RejectType.IGNORED)return isLatest&&router.urlRouter.update(),services.$q.when(globals.current);var detail=error.detail;if(error.type===exports.RejectType.SUPERSEDED&&error.redirected&&detail instanceof TargetState){var redirect=trans.redirect(detail);return redirect.run().catch(rejectedTransitionHandler(redirect))}if(error.type===exports.RejectType.ABORTED)return isLatest&&router.urlRouter.update(),services.$q.reject(error)}var errorHandler=_this.defaultErrorHandler();return errorHandler(error),services.$q.reject(error)}},transition=this.router.transitionService.create(currentPath,ref),transitionToPromise=transition.run().catch(rejectedTransitionHandler(transition));return silenceUncaughtInPromise(transitionToPromise),extend(transitionToPromise,{transition:transition})},StateService.prototype.is=function(stateOrName,params,options){options=defaults(options,{relative:this.$current});var state=this.router.stateRegistry.matcher.find(stateOrName,options.relative);if(!isDefined(state))return void 0;if(this.$current!==state)return!1;if(!params)return!0;var schema=state.parameters({inherit:!0,matchingKeys:params});return Param.equals(schema,Param.values(schema,params),this.params)},StateService.prototype.includes=function(stateOrName,params,options){options=defaults(options,{relative:this.$current});var glob=isString(stateOrName)&&Glob.fromString(stateOrName);if(glob){if(!glob.matches(this.$current.name))return!1;stateOrName=this.$current.name}var state=this.router.stateRegistry.matcher.find(stateOrName,options.relative),include=this.$current.includes;if(!isDefined(state))return void 0;if(!isDefined(include[state.name]))return!1;if(!params)return!0;var schema=state.parameters({inherit:!0,matchingKeys:params});return Param.equals(schema,Param.values(schema,params),this.params)},StateService.prototype.href=function(stateOrName,params,options){var defaultHrefOpts={lossy:!0,inherit:!0,absolute:!1,relative:this.$current};options=defaults(options,defaultHrefOpts),params=params||{};var state=this.router.stateRegistry.matcher.find(stateOrName,options.relative);if(!isDefined(state))return null;options.inherit&&(params=this.params.$inherit(params,this.$current,state));var nav=state&&options.lossy?state.navigable:state;return nav&&void 0!==nav.url&&null!==nav.url?this.router.urlRouter.href(nav.url,params,{absolute:options.absolute}):null},StateService.prototype.defaultErrorHandler=function(handler){return this._defaultErrorHandler=handler||this._defaultErrorHandler},StateService.prototype.get=function(stateOrName,base){var reg=this.router.stateRegistry;return 0===arguments.length?reg.get():reg.get(stateOrName,base||this.$current)},StateService.prototype.lazyLoad=function(stateOrName,transition){var state=this.get(stateOrName);if(!state||!state.lazyLoad)throw new Error("Can not lazy load "+stateOrName);var currentPath=this.getCurrentPath(),target=PathUtils.makeTargetState(this.router.stateRegistry,currentPath);return transition=transition||this.router.transitionService.create(currentPath,target),lazyLoadState(transition,state)},StateService}(),$q={when:function(val){return new Promise(function(resolve){return resolve(val)})},reject:function(val){return new Promise(function(resolve,reject){reject(val)})},defer:function(){var deferred={};return deferred.promise=new Promise(function(resolve,reject){deferred.resolve=resolve,deferred.reject=reject}),deferred},all:function(promises){if(isArray(promises))return Promise.all(promises);if(isObject(promises)){var chain=Object.keys(promises).map(function(key){return promises[key].then(function(val){return{key:key,val:val}})});return $q.all(chain).then(function(values){return values.reduce(function(acc,tuple){return acc[tuple.key]=tuple.val,acc},{})})}}},globals={},STRIP_COMMENTS=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,ARGUMENT_NAMES=/([^\s,]+)/g,$injector={get:function(name){return globals[name]},has:function(name){return null!=$injector.get(name)},invoke:function(fn,context,locals){var all=extend({},globals,locals||{}),params=$injector.annotate(fn),ensureExist=assertPredicate(function(key){return all.hasOwnProperty(key)},function(key){return"DI can't find injectable: '"+key+"'"}),args=params.filter(ensureExist).map(function(x){return all[x]});return isFunction(fn)?fn.apply(context,args):fn.slice(-1)[0].apply(context,args)},annotate:function(fn){if(!isInjectable(fn))throw new Error("Not an injectable function: "+fn);if(fn&&fn.$inject)return fn.$inject;if(isArray(fn))return fn.slice(0,-1);var fnStr=fn.toString().replace(STRIP_COMMENTS,""),result=fnStr.slice(fnStr.indexOf("(")+1,fnStr.indexOf(")")).match(ARGUMENT_NAMES);return result||[]}},keyValsToObjectR=function(accum,_a){var key=_a[0],val=_a[1];return accum.hasOwnProperty(key)?isArray(accum[key])?accum[key].push(val):accum[key]=[accum[key],val]:accum[key]=val,accum},getParams=function(queryString){return queryString.split("&").filter(identity).map(splitEqual).reduce(keyValsToObjectR,{})},buildUrl=function(loc){var path=loc.path(),searchObject=loc.search(),hash=loc.hash(),search=Object.keys(searchObject).map(function(key){var param=searchObject[key],vals=isArray(param)?param:[param];return vals.map(function(val){return key+"="+val})}).reduce(unnestR,[]).join("&");return path+(search?"?"+search:"")+(hash?"#"+hash:"")},BaseLocationServices=function(){function BaseLocationServices(router,fireAfterUpdate){var _this=this;this.fireAfterUpdate=fireAfterUpdate,this._listeners=[],this._listener=function(evt){return _this._listeners.forEach(function(cb){return cb(evt)})},this.hash=function(){return parseUrl$1(_this._get()).hash},this.path=function(){return parseUrl$1(_this._get()).path},this.search=function(){return getParams(parseUrl$1(_this._get()).search)},this._location=root.location,this._history=root.history}return BaseLocationServices.prototype.url=function(url,replace){return void 0===replace&&(replace=!0),isDefined(url)&&url!==this._get()&&(this._set(null,null,url,replace),this.fireAfterUpdate&&this._listeners.forEach(function(cb){return cb({url:url})})),buildUrl(this)},BaseLocationServices.prototype.onChange=function(cb){var _this=this;return this._listeners.push(cb),function(){return removeFrom(_this._listeners,cb)}},BaseLocationServices.prototype.dispose=function(){deregAll(this._listeners)},BaseLocationServices}(),__extends=void 0||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),HashLocationService=function(_super){function HashLocationService(router){var _this=_super.call(this,router,!1)||this;return root.addEventListener("hashchange",_this._listener,!1),_this}return __extends(HashLocationService,_super),HashLocationService.prototype._get=function(){return trimHashVal(this._location.hash)},HashLocationService.prototype._set=function(state,title,url){this._location.hash=url},HashLocationService.prototype.dispose=function(router){_super.prototype.dispose.call(this,router),root.removeEventListener("hashchange",this._listener)},HashLocationService}(BaseLocationServices),__extends$1=void 0||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),MemoryLocationService=function(_super){function MemoryLocationService(router){return _super.call(this,router,!0)||this}return __extends$1(MemoryLocationService,_super),MemoryLocationService.prototype._get=function(){return this._url},MemoryLocationService.prototype._set=function(state,title,url){this._url=url},MemoryLocationService}(BaseLocationServices),__extends$2=void 0||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),PushStateLocationService=function(_super){function PushStateLocationService(router){var _this=_super.call(this,router,!0)||this;return _this._config=router.urlService.config,root.addEventListener("popstate",_this._listener,!1),_this}return __extends$2(PushStateLocationService,_super),PushStateLocationService.prototype._getBasePrefix=function(){return stripLastPathElement(this._config.baseHref())},PushStateLocationService.prototype._get=function(){var _a=this._location,pathname=_a.pathname,hash=_a.hash,search=_a.search;search=splitQuery(search)[1],hash=splitHash(hash)[1];var basePrefix=this._getBasePrefix(),exactBaseHrefMatch=pathname===this._config.baseHref(),startsWithBase=pathname.substr(0,basePrefix.length)===basePrefix;return pathname=exactBaseHrefMatch?"/":startsWithBase?pathname.substring(basePrefix.length):pathname,pathname+(search?"?"+search:"")+(hash?"#"+hash:"")},PushStateLocationService.prototype._set=function(state,title,url,replace){var basePrefix=this._getBasePrefix(),slash=url&&"/"!==url[0]?"/":"",fullUrl=""===url||"/"===url?this._config.baseHref():basePrefix+slash+url;replace?this._history.replaceState(state,title,fullUrl):this._history.pushState(state,title,fullUrl)},PushStateLocationService.prototype.dispose=function(router){_super.prototype.dispose.call(this,router),root.removeEventListener("popstate",this._listener)},PushStateLocationService}(BaseLocationServices),MemoryLocationConfig=function(){function MemoryLocationConfig(){var _this=this;this.dispose=noop,this._baseHref="",this._port=80,this._protocol="http",this._host="localhost",this._hashPrefix="",this.port=function(){return _this._port},this.protocol=function(){return _this._protocol},this.host=function(){return _this._host},this.baseHref=function(){return _this._baseHref},this.html5Mode=function(){return!1},this.hashPrefix=function(newval){return isDefined(newval)?_this._hashPrefix=newval:_this._hashPrefix}}return MemoryLocationConfig}(),BrowserLocationConfig=function(){function BrowserLocationConfig(router,_isHtml5){void 0===_isHtml5&&(_isHtml5=!1),this._isHtml5=_isHtml5,this._baseHref=void 0,this._hashPrefix=""}return BrowserLocationConfig.prototype.port=function(){return location.port?Number(location.port):"https"===this.protocol()?443:80},BrowserLocationConfig.prototype.protocol=function(){return location.protocol.replace(/:/g,"")},BrowserLocationConfig.prototype.host=function(){return location.hostname},BrowserLocationConfig.prototype.html5Mode=function(){return this._isHtml5},BrowserLocationConfig.prototype.hashPrefix=function(newprefix){return isDefined(newprefix)?this._hashPrefix=newprefix:this._hashPrefix},BrowserLocationConfig.prototype.baseHref=function(href){return isDefined(href)&&(this._baseHref=href),isUndefined(this._baseHref)&&(this._baseHref=this.getBaseHref()),this._baseHref},BrowserLocationConfig.prototype.getBaseHref=function(){var baseTag=document.getElementsByTagName("base")[0];return baseTag&&baseTag.href?baseTag.href.replace(/^([^\/:]*:)?\/\/[^\/]*/,""):this._isHtml5?"/":location.pathname||"/"},BrowserLocationConfig.prototype.dispose=function(){},BrowserLocationConfig}(),hashLocationPlugin=locationPluginFactory("vanilla.hashBangLocation",!1,HashLocationService,BrowserLocationConfig),pushStateLocationPlugin=locationPluginFactory("vanilla.pushStateLocation",!0,PushStateLocationService,BrowserLocationConfig),memoryLocationPlugin=locationPluginFactory("vanilla.memoryLocation",!1,MemoryLocationService,MemoryLocationConfig),UIRouterPluginBase=function(){function UIRouterPluginBase(){}return UIRouterPluginBase.prototype.dispose=function(){},UIRouterPluginBase}(),index=Object.freeze({__proto__:null,root:root,fromJson:fromJson,toJson:toJson,forEach:forEach,extend:extend,equals:equals,identity:identity,noop:noop,createProxyFunctions:createProxyFunctions,inherit:inherit,inArray:inArray,_inArray:_inArray,removeFrom:removeFrom,_removeFrom:_removeFrom,pushTo:pushTo,_pushTo:_pushTo,deregAll:deregAll,defaults:defaults,mergeR:mergeR,ancestors:ancestors,pick:pick,omit:omit,pluck:pluck,filter:filter,find:find,mapObj:mapObj,map:map,values:values,allTrueR:allTrueR,anyTrueR:anyTrueR,unnestR:unnestR,flattenR:flattenR,pushR:pushR,uniqR:uniqR,unnest:unnest,flatten:flatten,assertPredicate:assertPredicate,assertMap:assertMap,assertFn:assertFn,pairs:pairs,arrayTuples:arrayTuples,applyPairs:applyPairs,tail:tail,copy:copy,_extend:_extend,silenceUncaughtInPromise:silenceUncaughtInPromise,silentRejection:silentRejection,makeStub:makeStub,services:services,Glob:Glob,curry:curry,compose:compose,pipe:pipe,prop:prop,propEq:propEq,parse:parse,not:not,and:and,or:or,all:all,any:any,is:is,eq:eq,val:val,invoke:invoke,pattern:pattern,isUndefined:isUndefined,isDefined:isDefined,isNull:isNull,isNullOrUndefined:isNullOrUndefined,isFunction:isFunction,isNumber:isNumber,isString:isString,isObject:isObject,isArray:isArray,isDate:isDate,isRegExp:isRegExp,isInjectable:isInjectable,isPromise:isPromise,Queue:Queue,maxLength:maxLength,padString:padString,kebobString:kebobString,functionToString:functionToString,fnToString:fnToString,stringify:stringify,beforeAfterSubstr:beforeAfterSubstr,hostRegex:hostRegex,stripLastPathElement:stripLastPathElement,splitHash:splitHash,splitQuery:splitQuery,splitEqual:splitEqual,trimHashVal:trimHashVal,splitOnDelim:splitOnDelim,joinNeighborsR:joinNeighborsR,get Category(){return exports.Category},Trace:Trace,trace:trace,get DefType(){return exports.DefType},Param:Param,ParamTypes:ParamTypes,StateParams:StateParams,ParamType:ParamType,PathNode:PathNode,PathUtils:PathUtils,resolvePolicies:resolvePolicies,defaultResolvePolicy:defaultResolvePolicy,Resolvable:Resolvable,NATIVE_INJECTOR_TOKEN:NATIVE_INJECTOR_TOKEN,ResolveContext:ResolveContext,resolvablesBuilder:resolvablesBuilder,StateBuilder:StateBuilder,StateObject:StateObject,StateMatcher:StateMatcher,StateQueueManager:StateQueueManager,StateRegistry:StateRegistry,StateService:StateService,TargetState:TargetState,get TransitionHookPhase(){return exports.TransitionHookPhase},get TransitionHookScope(){return exports.TransitionHookScope},HookBuilder:HookBuilder,matchState:matchState,RegisteredHook:RegisteredHook,makeEvent:makeEvent,get RejectType(){return exports.RejectType},Rejection:Rejection,Transition:Transition,TransitionHook:TransitionHook,TransitionEventType:TransitionEventType,defaultTransOpts:defaultTransOpts,TransitionService:TransitionService,UrlRules:UrlRules,UrlConfig:UrlConfig,UrlMatcher:UrlMatcher,ParamFactory:ParamFactory,UrlMatcherFactory:UrlMatcherFactory,UrlRouter:UrlRouter,UrlRuleFactory:UrlRuleFactory,BaseUrlRule:BaseUrlRule,UrlService:UrlService,ViewService:ViewService,UIRouterGlobals:UIRouterGlobals,UIRouter:UIRouter,$q:$q,$injector:$injector,BaseLocationServices:BaseLocationServices,HashLocationService:HashLocationService,MemoryLocationService:MemoryLocationService,PushStateLocationService:PushStateLocationService,MemoryLocationConfig:MemoryLocationConfig,BrowserLocationConfig:BrowserLocationConfig,keyValsToObjectR:keyValsToObjectR,getParams:getParams,parseUrl:parseUrl$1,buildUrl:buildUrl,locationPluginFactory:locationPluginFactory,servicesPlugin:servicesPlugin,hashLocationPlugin:hashLocationPlugin,pushStateLocationPlugin:pushStateLocationPlugin,memoryLocationPlugin:memoryLocationPlugin,UIRouterPluginBase:UIRouterPluginBase}),hasAnyKey=function(keys,obj){return keys.reduce(function(acc,key){return acc||isDefined(obj[key])},!1)},id$1=0,Ng1ViewConfig=function(){function Ng1ViewConfig(path,viewDecl,factory){var _this=this;this.path=path,this.viewDecl=viewDecl,this.factory=factory,this.$id=id$1++,this.loaded=!1,this.getTemplate=function(uiView,context){return _this.component?_this.factory.makeComponentTemplate(uiView,context,_this.component,_this.viewDecl.bindings):_this.template}}return Ng1ViewConfig.prototype.load=function(){var _this=this,$q=services.$q,context=new ResolveContext(this.path),params=this.path.reduce(function(acc,node){return extend(acc,node.paramValues)},{}),promises={template:$q.when(this.factory.fromConfig(this.viewDecl,params,context)),controller:$q.when(this.getController(context))};return $q.all(promises).then(function(results){return trace.traceViewServiceEvent("Loaded",_this),_this.controller=results.controller,extend(_this,results.template),_this})},Ng1ViewConfig.prototype.getController=function(context){var provider=this.viewDecl.controllerProvider;if(!isInjectable(provider))return this.viewDecl.controller;var deps=services.$injector.annotate(provider),providerFn=isArray(provider)?tail(provider):provider,resolvable=new Resolvable("",providerFn,deps);return resolvable.get(context)},Ng1ViewConfig}(),TemplateFactory=function(){function TemplateFactory(){var _this=this;this._useHttp=ng.version.minor<3,this.$get=["$http","$templateCache","$injector",function($http,$templateCache,$injector){return _this.$templateRequest=$injector.has&&$injector.has("$templateRequest")&&$injector.get("$templateRequest"),_this.$http=$http,_this.$templateCache=$templateCache,_this}]}return TemplateFactory.prototype.useHttpService=function(value){this._useHttp=value},TemplateFactory.prototype.fromConfig=function(config,params,context){var defaultTemplate="<ui-view></ui-view>",asTemplate=function(result){return services.$q.when(result).then(function(str){return{template:str}})},asComponent=function(result){return services.$q.when(result).then(function(str){return{component:str}})};return isDefined(config.template)?asTemplate(this.fromString(config.template,params)):isDefined(config.templateUrl)?asTemplate(this.fromUrl(config.templateUrl,params)):isDefined(config.templateProvider)?asTemplate(this.fromProvider(config.templateProvider,params,context)):isDefined(config.component)?asComponent(config.component):isDefined(config.componentProvider)?asComponent(this.fromComponentProvider(config.componentProvider,params,context)):asTemplate(defaultTemplate)},TemplateFactory.prototype.fromString=function(template,params){return isFunction(template)?template(params):template},TemplateFactory.prototype.fromUrl=function(url,params){return isFunction(url)&&(url=url(params)),null==url?null:this._useHttp?this.$http.get(url,{cache:this.$templateCache,headers:{Accept:"text/html"}}).then(function(response){return response.data}):this.$templateRequest(url)},TemplateFactory.prototype.fromProvider=function(provider,params,context){var deps=services.$injector.annotate(provider),providerFn=isArray(provider)?tail(provider):provider,resolvable=new Resolvable("",providerFn,deps);return resolvable.get(context)},TemplateFactory.prototype.fromComponentProvider=function(provider,params,context){var deps=services.$injector.annotate(provider),providerFn=isArray(provider)?tail(provider):provider,resolvable=new Resolvable("",providerFn,deps);return resolvable.get(context)},TemplateFactory.prototype.makeComponentTemplate=function(uiView,context,component,bindings){bindings=bindings||{};var prefix=ng.version.minor>=3?"::":"",kebob=function(camelCase){var kebobed=kebobString(camelCase);return/^(x|data)-/.exec(kebobed)?"x-"+kebobed:kebobed},attributeTpl=function(input){var name=input.name,type=input.type,attrName=kebob(name);if(uiView.attr(attrName)&&!bindings[name])return attrName+"='"+uiView.attr(attrName)+"'";var resolveName=bindings[name]||name;if("@"===type)return attrName+"='{{"+prefix+"$resolve."+resolveName+"}}'";if("&"===type){var res=context.getResolvable(resolveName),fn=res&&res.data,args=fn&&services.$injector.annotate(fn)||[],arrayIdxStr=isArray(fn)?"["+(fn.length-1)+"]":"";return attrName+"='$resolve."+resolveName+arrayIdxStr+"("+args.join(",")+")'"}return attrName+"='"+prefix+"$resolve."+resolveName+"'"},attrs=getComponentBindings(component).map(attributeTpl).join(" "),kebobName=kebob(component);return"<"+kebobName+" "+attrs+"></"+kebobName+">"},TemplateFactory}(),getBindings=function(def){return scopeBindings(isObject(def.bindToController)?def.bindToController:def.scope)},scopeBindings=function(bindingsObj){return Object.keys(bindingsObj||{}).map(function(key){return[key,/^([=<@&])[?]?(.*)/.exec(bindingsObj[key])]}).filter(function(tuple){return isDefined(tuple)&&isArray(tuple[1])}).map(function(tuple){return{name:tuple[1][2]||tuple[0],type:tuple[1][1]}})},StateProvider=function(){function StateProvider(stateRegistry,stateService){this.stateRegistry=stateRegistry,this.stateService=stateService,createProxyFunctions(val(StateProvider.prototype),this,val(this))}return StateProvider.prototype.decorator=function(name,func){return this.stateRegistry.decorator(name,func)||this},StateProvider.prototype.state=function(name,definition){return isObject(name)?definition=name:definition.name=name,this.stateRegistry.register(definition),this},StateProvider.prototype.onInvalid=function(callback){return this.stateService.onInvalid(callback)},StateProvider}(),getStateHookBuilder=function(hookName){return function(stateObject){function decoratedNg1Hook(trans,state){var resolveContext=new ResolveContext(trans.treeChanges(pathname)),subContext=resolveContext.subContext(state.$$state()),locals=extend(getLocals(subContext),{$state$:state,$transition$:trans});return services.$injector.invoke(hook,this,locals)}var hook=stateObject[hookName],pathname="onExit"===hookName?"from":"to";return hook?decoratedNg1Hook:void 0}},Ng1LocationServices=function(){function Ng1LocationServices($locationProvider){this._urlListeners=[],this.$locationProvider=$locationProvider;var _lp=val($locationProvider);createProxyFunctions(_lp,this,_lp,["hashPrefix"])}return Ng1LocationServices.monkeyPatchPathParameterType=function(router){var pathType=router.urlMatcherFactory.type("path");pathType.encode=function(x){return null!=x?x.toString().replace(/(~|\/)/g,function(m){return{"~":"~~","/":"~2F"}[m]}):x},pathType.decode=function(x){return null!=x?x.toString().replace(/(~~|~2F)/g,function(m){return{"~~":"~","~2F":"/"}[m]}):x}},Ng1LocationServices.prototype.dispose=function(){},Ng1LocationServices.prototype.onChange=function(callback){var _this=this;return this._urlListeners.push(callback),function(){return removeFrom(_this._urlListeners)(callback)}},Ng1LocationServices.prototype.html5Mode=function(){var html5Mode=this.$locationProvider.html5Mode();return html5Mode=isObject(html5Mode)?html5Mode.enabled:html5Mode,html5Mode&&this.$sniffer.history},Ng1LocationServices.prototype.baseHref=function(){return this._baseHref||(this._baseHref=this.$browser.baseHref()||this.$window.location.pathname)},Ng1LocationServices.prototype.url=function(newUrl,replace,state){return void 0===replace&&(replace=!1),isDefined(newUrl)&&this.$location.url(newUrl),replace&&this.$location.replace(),state&&this.$location.state(state),this.$location.url()},Ng1LocationServices.prototype._runtimeServices=function($rootScope,$location,$sniffer,$browser,$window){var _this=this;this.$location=$location,this.$sniffer=$sniffer,this.$browser=$browser,this.$window=$window,$rootScope.$on("$locationChangeSuccess",function(evt){return _this._urlListeners.forEach(function(fn){return fn(evt)
})});var _loc=val($location);createProxyFunctions(_loc,this,_loc,["replace","path","search","hash"]),createProxyFunctions(_loc,this,_loc,["port","protocol","host"])},Ng1LocationServices}(),UrlRouterProvider=function(){function UrlRouterProvider(router){this.router=router}return UrlRouterProvider.injectableHandler=function(router,handler){return function(match){return services.$injector.invoke(handler,null,{$match:match,$stateParams:router.globals.params})}},UrlRouterProvider.prototype.$get=function(){var urlService=this.router.urlService;return this.router.urlRouter.update(!0),urlService.interceptDeferred||urlService.listen(),this.router.urlRouter},UrlRouterProvider.prototype.rule=function(ruleFn){var _this=this;if(!isFunction(ruleFn))throw new Error("'rule' must be a function");var match=function(){return ruleFn(services.$injector,_this.router.locationService)},rule=new BaseUrlRule(match,identity);return this.router.urlService.rules.rule(rule),this},UrlRouterProvider.prototype.otherwise=function(rule){var _this=this,urlRules=this.router.urlService.rules;if(isString(rule))urlRules.otherwise(rule);else{if(!isFunction(rule))throw new Error("'rule' must be a string or function");urlRules.otherwise(function(){return rule(services.$injector,_this.router.locationService)})}return this},UrlRouterProvider.prototype.when=function(what,handler){return(isArray(handler)||isFunction(handler))&&(handler=UrlRouterProvider.injectableHandler(this.router,handler)),this.router.urlService.rules.when(what,handler),this},UrlRouterProvider.prototype.deferIntercept=function(defer){this.router.urlService.deferIntercept(defer)},UrlRouterProvider}();ng.module("ui.router.angular1",[]);var mod_init=ng.module("ui.router.init",["ng"]),mod_util=ng.module("ui.router.util",["ui.router.init"]),mod_rtr=ng.module("ui.router.router",["ui.router.util"]),mod_state=ng.module("ui.router.state",["ui.router.router","ui.router.util","ui.router.angular1"]),mod_main=ng.module("ui.router",["ui.router.init","ui.router.state","ui.router.angular1"]),router=(ng.module("ui.router.compat",["ui.router"]),null);$uiRouterProvider.$inject=["$locationProvider"];var getProviderFor=function(serviceName){return["$uiRouterProvider",function($urp){var service=$urp.router[serviceName];return service.$get=function(){return service},service}]};runBlock.$inject=["$injector","$q","$uiRouter"];var getUrlRouterProvider=function(uiRouter){return uiRouter.urlRouterProvider=new UrlRouterProvider(uiRouter)},getStateProvider=function(){return extend(router.stateProvider,{$get:function(){return router.stateService}})};watchDigests.$inject=["$rootScope"],mod_init.provider("$uiRouter",$uiRouterProvider),mod_rtr.provider("$urlRouter",["$uiRouterProvider",getUrlRouterProvider]),mod_util.provider("$urlService",getProviderFor("urlService")),mod_util.provider("$urlMatcherFactory",["$uiRouterProvider",function(){return router.urlMatcherFactory}]),mod_util.provider("$templateFactory",function(){return new TemplateFactory}),mod_state.provider("$stateRegistry",getProviderFor("stateRegistry")),mod_state.provider("$uiRouterGlobals",getProviderFor("globals")),mod_state.provider("$transitions",getProviderFor("transitionService")),mod_state.provider("$state",["$uiRouterProvider",getStateProvider]),mod_state.factory("$stateParams",["$uiRouter",function($uiRouter){return $uiRouter.globals.params}]),mod_main.factory("$view",function(){return router.viewService}),mod_main.service("$trace",function(){return trace}),mod_main.run(watchDigests),mod_util.run(["$urlMatcherFactory",function(){}]),mod_state.run(["$state",function(){}]),mod_rtr.run(["$urlRouter",function(){}]),mod_init.run(runBlock);var uiSrefDirective,getLocals=function(ctx){var tokens=ctx.getTokens().filter(isString),tuples=tokens.map(function(key){var resolvable=ctx.getResolvable(key),waitPolicy=ctx.getPolicy(resolvable).async;return[key,"NOWAIT"===waitPolicy?resolvable.promise:resolvable.data]});return tuples.reduce(applyPairs,{})};uiSrefDirective=["$uiRouter","$timeout",function($uiRouter,$timeout){var $state=$uiRouter.stateService;return{restrict:"A",require:["?^uiSrefActive","?^uiSrefActiveEq"],link:function(scope,element,attrs,uiSrefActive){function update(){var def=getDef();unlinkInfoFn&&unlinkInfoFn(),active&&(unlinkInfoFn=active.$$addStateInfo(def.uiState,def.uiStateParams)),null!=def.href&&attrs.$set(type.attr,def.href)}var type=getTypeInfo(element),active=uiSrefActive[1]||uiSrefActive[0],unlinkInfoFn=null,rawDef={},getDef=function(){return processedDef($state,element,rawDef)},ref=parseStateRef(attrs.uiSref);if(rawDef.uiState=ref.state,rawDef.uiStateOpts=attrs.uiSrefOpts?scope.$eval(attrs.uiSrefOpts):{},ref.paramExpr&&(scope.$watch(ref.paramExpr,function(val){rawDef.uiStateParams=extend({},val),update()},!0),rawDef.uiStateParams=extend({},scope.$eval(ref.paramExpr))),update(),scope.$on("$destroy",$uiRouter.stateRegistry.onStatesChanged(update)),scope.$on("$destroy",$uiRouter.transitionService.onSuccess({},update)),type.clickable){var hookFn=clickHook(element,$state,$timeout,type,getDef);bindEvents(element,scope,hookFn,rawDef.uiStateOpts)}}}}];var uiStateDirective;uiStateDirective=["$uiRouter","$timeout",function($uiRouter,$timeout){var $state=$uiRouter.stateService;return{restrict:"A",require:["?^uiSrefActive","?^uiSrefActiveEq"],link:function(scope,element,attrs,uiSrefActive){function update(){var def=getDef();unlinkInfoFn&&unlinkInfoFn(),active&&(unlinkInfoFn=active.$$addStateInfo(def.uiState,def.uiStateParams)),null!=def.href&&attrs.$set(type.attr,def.href)}var hookFn,type=getTypeInfo(element),active=uiSrefActive[1]||uiSrefActive[0],unlinkInfoFn=null,rawDef={},getDef=function(){return processedDef($state,element,rawDef)},inputAttrs=["uiState","uiStateParams","uiStateOpts"],watchDeregFns=inputAttrs.reduce(function(acc,attr){return acc[attr]=noop,acc},{});inputAttrs.forEach(function(field){rawDef[field]=attrs[field]?scope.$eval(attrs[field]):null,attrs.$observe(field,function(expr){watchDeregFns[field](),watchDeregFns[field]=scope.$watch(expr,function(newval){rawDef[field]=newval,update()},!0)})}),update(),scope.$on("$destroy",$uiRouter.stateRegistry.onStatesChanged(update)),scope.$on("$destroy",$uiRouter.transitionService.onSuccess({},update)),type.clickable&&(hookFn=clickHook(element,$state,$timeout,type,getDef),bindEvents(element,scope,hookFn,rawDef.uiStateOpts))}}}];var uiSrefActiveDirective;uiSrefActiveDirective=["$state","$stateParams","$interpolate","$uiRouter",function($state,$stateParams,$interpolate,$uiRouter){return{restrict:"A",controller:["$scope","$element","$attrs",function($scope,$element,$attrs){function updateAfterTransition(trans){trans.promise.then(update,noop)}function setupEventListeners(){var deregisterStatesChangedListener=$uiRouter.stateRegistry.onStatesChanged(handleStatesChanged),deregisterOnStartListener=$uiRouter.transitionService.onStart({},updateAfterTransition),deregisterStateChangeSuccessListener=$scope.$on("$stateChangeSuccess",update);return function(){deregisterStatesChangedListener(),deregisterOnStartListener(),deregisterStateChangeSuccessListener()}}function handleStatesChanged(){setStatesFromDefinitionObject(uiSrefActive)}function setStatesFromDefinitionObject(statesDefinition){isObject(statesDefinition)&&(states=[],forEach(statesDefinition,function(stateOrName,activeClass){var addStateForClass=function(stateOrName,activeClass){var ref=parseStateRef(stateOrName);addState(ref.state,$scope.$eval(ref.paramExpr),activeClass)};isString(stateOrName)?addStateForClass(stateOrName,activeClass):isArray(stateOrName)&&forEach(stateOrName,function(stateOrName){addStateForClass(stateOrName,activeClass)})}))}function addState(stateName,stateParams,activeClass){var state=$state.get(stateName,stateContext($element)),stateInfo={state:state||{name:stateName},params:stateParams,activeClass:activeClass};return states.push(stateInfo),function(){removeFrom(states)(stateInfo)}}function update(){var splitClasses=function(str){return str.split(/\s/).filter(identity)},getClasses=function(stateList){return stateList.map(function(x){return x.activeClass}).map(splitClasses).reduce(unnestR,[])},allClasses=getClasses(states).concat(splitClasses(activeEqClass)).reduce(uniqR,[]),fuzzyClasses=getClasses(states.filter(function(x){return $state.includes(x.state.name,x.params)})),exactlyMatchesAny=!!states.filter(function(x){return $state.is(x.state.name,x.params)}).length,exactClasses=exactlyMatchesAny?splitClasses(activeEqClass):[],addClasses=fuzzyClasses.concat(exactClasses).reduce(uniqR,[]),removeClasses=allClasses.filter(function(cls){return!inArray(addClasses,cls)});$scope.$evalAsync(function(){addClasses.forEach(function(className){return $element.addClass(className)}),removeClasses.forEach(function(className){return $element.removeClass(className)})})}var activeEqClass,uiSrefActive,states=[];activeEqClass=$interpolate($attrs.uiSrefActiveEq||"",!1)($scope);try{uiSrefActive=$scope.$eval($attrs.uiSrefActive)}catch(e){}uiSrefActive=uiSrefActive||$interpolate($attrs.uiSrefActive||"",!1)($scope),setStatesFromDefinitionObject(uiSrefActive),this.$$addStateInfo=function(newState,newParams){if(!(isObject(uiSrefActive)&&states.length>0)){var deregister=addState(newState,newParams,uiSrefActive);return update(),deregister}},$scope.$on("$destroy",setupEventListeners()),$uiRouter.globals.transition&&updateAfterTransition($uiRouter.globals.transition),update()}]}}],ng.module("ui.router.state").directive("uiSref",uiSrefDirective).directive("uiSrefActive",uiSrefActiveDirective).directive("uiSrefActiveEq",uiSrefActiveDirective).directive("uiState",uiStateDirective),$IsStateFilter.$inject=["$state"],$IncludedByStateFilter.$inject=["$state"],ng.module("ui.router.state").filter("isState",$IsStateFilter).filter("includedByState",$IncludedByStateFilter);var uiView;uiView=["$view","$animate","$uiViewScroll","$interpolate","$q",function($view,$animate,$uiViewScroll,$interpolate,$q){function getRenderer(){return{enter:function(element,target,cb){ng.version.minor>2?$animate.enter(element,null,target).then(cb):$animate.enter(element,null,target,cb)},leave:function(element,cb){ng.version.minor>2?$animate.leave(element).then(cb):$animate.leave(element,cb)}}}function configsEqual(config1,config2){return config1===config2}var rootData={$cfg:{viewDecl:{$context:$view._pluginapi._rootViewContext()}},$uiView:{}},directive={count:0,restrict:"ECA",terminal:!0,priority:400,transclude:"element",compile:function(tElement,tAttrs,$transclude){return function(scope,$element,attrs){function configUpdatedCallback(config){(!config||config instanceof Ng1ViewConfig)&&(configsEqual(viewConfig,config)||(trace.traceUIViewConfigUpdated(activeUIView,config&&config.viewDecl&&config.viewDecl.$context),viewConfig=config,updateView(config)))}function cleanupLastView(){if(previousEl&&(trace.traceUIViewEvent("Removing (previous) el",previousEl.data("$uiView")),previousEl.remove(),previousEl=null),currentScope&&(trace.traceUIViewEvent("Destroying scope",activeUIView),currentScope.$destroy(),currentScope=null),currentEl){var _viewData_1=currentEl.data("$uiViewAnim");trace.traceUIViewEvent("Animate out",_viewData_1),renderer.leave(currentEl,function(){_viewData_1.$$animLeave.resolve(),previousEl=null}),previousEl=currentEl,currentEl=null}}function updateView(config){var newScope=scope.$new(),animEnter=$q.defer(),animLeave=$q.defer(),$uiViewData={$cfg:config,$uiView:activeUIView},$uiViewAnim={$animEnter:animEnter.promise,$animLeave:animLeave.promise,$$animLeave:animLeave};newScope.$emit("$viewContentLoading",name);var cloned=$transclude(newScope,function(clone){clone.data("$uiViewAnim",$uiViewAnim),clone.data("$uiView",$uiViewData),renderer.enter(clone,$element,function(){animEnter.resolve(),currentScope&&currentScope.$emit("$viewContentAnimationEnded"),(isDefined(autoScrollExp)&&!autoScrollExp||scope.$eval(autoScrollExp))&&$uiViewScroll(clone)}),cleanupLastView()});currentEl=cloned,currentScope=newScope,currentScope.$emit("$viewContentLoaded",config||viewConfig),currentScope.$eval(onloadExp)}var previousEl,currentEl,currentScope,viewConfig,onloadExp=attrs.onload||"",autoScrollExp=attrs.autoscroll,renderer=getRenderer(),inherited=$element.inheritedData("$uiView")||rootData,name=$interpolate(attrs.uiView||attrs.name||"")(scope)||"$default",activeUIView={$type:"ng1",id:directive.count++,name:name,fqn:inherited.$uiView.fqn?inherited.$uiView.fqn+"."+name:name,config:null,configUpdated:configUpdatedCallback,get creationContext(){var fromParentTagConfig=parse("$cfg.viewDecl.$context")(inherited),fromParentTag=parse("$uiView.creationContext")(inherited);return fromParentTagConfig||fromParentTag}};trace.traceUIViewEvent("Linking",activeUIView),$element.data("$uiView",{$uiView:activeUIView}),updateView();var unregister=$view.registerUIView(activeUIView);scope.$on("$destroy",function(){trace.traceUIViewEvent("Destroying/Unregistering",activeUIView),unregister()})}}};return directive}],$ViewDirectiveFill.$inject=["$compile","$controller","$transitions","$view","$q"];var hasComponentImpl="function"==typeof ng.module("ui.router").component,_uiCanExitId=0;ng.module("ui.router.state").directive("uiView",uiView),ng.module("ui.router.state").directive("uiView",$ViewDirectiveFill),ng.module("ui.router.state").provider("$uiViewScroll",$ViewScrollProvider);var index$1="ui.router";exports.$injector=$injector,exports.$q=$q,exports.BaseLocationServices=BaseLocationServices,exports.BaseUrlRule=BaseUrlRule,exports.BrowserLocationConfig=BrowserLocationConfig,exports.Glob=Glob,exports.HashLocationService=HashLocationService,exports.HookBuilder=HookBuilder,exports.MemoryLocationConfig=MemoryLocationConfig,exports.MemoryLocationService=MemoryLocationService,exports.NATIVE_INJECTOR_TOKEN=NATIVE_INJECTOR_TOKEN,exports.Ng1ViewConfig=Ng1ViewConfig,exports.Param=Param,exports.ParamFactory=ParamFactory,exports.ParamType=ParamType,exports.ParamTypes=ParamTypes,exports.PathNode=PathNode,exports.PathUtils=PathUtils,exports.PushStateLocationService=PushStateLocationService,exports.Queue=Queue,exports.RegisteredHook=RegisteredHook,exports.Rejection=Rejection,exports.Resolvable=Resolvable,exports.ResolveContext=ResolveContext,exports.StateBuilder=StateBuilder,exports.StateMatcher=StateMatcher,exports.StateObject=StateObject,exports.StateParams=StateParams,exports.StateProvider=StateProvider,exports.StateQueueManager=StateQueueManager,exports.StateRegistry=StateRegistry,exports.StateService=StateService,exports.TargetState=TargetState,exports.Trace=Trace,exports.Transition=Transition,exports.TransitionEventType=TransitionEventType,exports.TransitionHook=TransitionHook,exports.TransitionService=TransitionService,exports.UIRouter=UIRouter,exports.UIRouterGlobals=UIRouterGlobals,exports.UIRouterPluginBase=UIRouterPluginBase,exports.UrlConfig=UrlConfig,exports.UrlMatcher=UrlMatcher,exports.UrlMatcherFactory=UrlMatcherFactory,exports.UrlRouter=UrlRouter,exports.UrlRouterProvider=UrlRouterProvider,exports.UrlRuleFactory=UrlRuleFactory,exports.UrlRules=UrlRules,exports.UrlService=UrlService,exports.ViewService=ViewService,exports._extend=_extend,exports._inArray=_inArray,exports._pushTo=_pushTo,exports._removeFrom=_removeFrom,exports.all=all,exports.allTrueR=allTrueR,exports.ancestors=ancestors,exports.and=and,exports.any=any,exports.anyTrueR=anyTrueR,exports.applyPairs=applyPairs,exports.arrayTuples=arrayTuples,exports.assertFn=assertFn,exports.assertMap=assertMap,exports.assertPredicate=assertPredicate,exports.beforeAfterSubstr=beforeAfterSubstr,exports.buildUrl=buildUrl,exports.compose=compose,exports.copy=copy,exports.core=index,exports.createProxyFunctions=createProxyFunctions,exports.curry=curry,exports.default=index$1,exports.defaultResolvePolicy=defaultResolvePolicy,exports.defaultTransOpts=defaultTransOpts,exports.defaults=defaults,exports.deregAll=deregAll,exports.eq=eq,exports.equals=equals,exports.extend=extend,exports.filter=filter,exports.find=find,exports.flatten=flatten,exports.flattenR=flattenR,exports.fnToString=fnToString,exports.forEach=forEach,exports.fromJson=fromJson,exports.functionToString=functionToString,exports.getLocals=getLocals,exports.getNg1ViewConfigFactory=getNg1ViewConfigFactory,exports.getParams=getParams,exports.hashLocationPlugin=hashLocationPlugin,exports.hostRegex=hostRegex,exports.identity=identity,exports.inArray=inArray,exports.inherit=inherit,exports.invoke=invoke,exports.is=is,exports.isArray=isArray,exports.isDate=isDate,exports.isDefined=isDefined,exports.isFunction=isFunction,exports.isInjectable=isInjectable,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isObject=isObject,exports.isPromise=isPromise,exports.isRegExp=isRegExp,exports.isString=isString,exports.isUndefined=isUndefined,exports.joinNeighborsR=joinNeighborsR,exports.kebobString=kebobString,exports.keyValsToObjectR=keyValsToObjectR,exports.locationPluginFactory=locationPluginFactory,exports.makeEvent=makeEvent,exports.makeStub=makeStub,exports.map=map,exports.mapObj=mapObj,exports.matchState=matchState,exports.maxLength=maxLength,exports.memoryLocationPlugin=memoryLocationPlugin,exports.mergeR=mergeR,exports.ng1ViewsBuilder=ng1ViewsBuilder,exports.noop=noop,exports.not=not,exports.omit=omit,exports.or=or,exports.padString=padString,exports.pairs=pairs,exports.parse=parse,exports.parseUrl=parseUrl$1,exports.pattern=pattern,exports.pick=pick,exports.pipe=pipe,exports.pluck=pluck,exports.prop=prop,exports.propEq=propEq,exports.pushR=pushR,exports.pushStateLocationPlugin=pushStateLocationPlugin,exports.pushTo=pushTo,exports.removeFrom=removeFrom,exports.resolvablesBuilder=resolvablesBuilder,exports.resolvePolicies=resolvePolicies,exports.root=root,exports.services=services,exports.servicesPlugin=servicesPlugin,exports.silenceUncaughtInPromise=silenceUncaughtInPromise,exports.silentRejection=silentRejection,exports.splitEqual=splitEqual,exports.splitHash=splitHash,exports.splitOnDelim=splitOnDelim,exports.splitQuery=splitQuery,exports.stringify=stringify,exports.stripLastPathElement=stripLastPathElement,exports.tail=tail,exports.toJson=toJson,exports.trace=trace,exports.trimHashVal=trimHashVal,exports.uniqR=uniqR,exports.unnest=unnest,exports.unnestR=unnestR,exports.val=val,exports.values=values,exports.watchDigests=watchDigests,Object.defineProperty(exports,"__esModule",{value:!0})});
!function(){"use strict";function findFirstParentElementWithAttribute(attributeName,childObj){if(void 0===childObj)return null;for(var testObj=childObj.parentNode,count=1,res="function"==typeof testObj.setAttribute&&testObj.hasAttribute(attributeName)?testObj:null;testObj&&"function"==typeof testObj.setAttribute&&!testObj.hasAttribute(attributeName);){if(testObj=testObj.parentNode,res=testObj,testObj===document.documentElement){res=null;break}count++}return res}angular.module("ui.tree").factory("UiTreeHelper",["$document","$window","treeConfig",function($document,$window,treeConfig){return{nodesData:{},setNodeAttribute:function(scope,attrName,val){if(!scope.$modelValue)return null;var data=this.nodesData[scope.$modelValue.$$hashKey];data||(data={},this.nodesData[scope.$modelValue.$$hashKey]=data),data[attrName]=val},getNodeAttribute:function(scope,attrName){if(!scope.$modelValue)return null;var data=this.nodesData[scope.$modelValue.$$hashKey];return data?data[attrName]:null},nodrag:function(targetElm){return"undefined"!=typeof targetElm.attr("data-nodrag")?"false"!==targetElm.attr("data-nodrag"):!1},eventObj:function(e){var obj=e;return void 0!==e.targetTouches?obj=e.targetTouches.item(0):void 0!==e.originalEvent&&void 0!==e.originalEvent.targetTouches&&(obj=e.originalEvent.targetTouches.item(0)),obj},dragInfo:function(node){return{source:node,sourceInfo:{cloneModel:node.$treeScope.cloneEnabled===!0?angular.copy(node.$modelValue):void 0,nodeScope:node,index:node.index(),nodesScope:node.$parentNodesScope},index:node.index(),siblings:node.siblings().slice(0),parent:node.$parentNodesScope,resetParent:function(){this.parent=node.$parentNodesScope},moveTo:function(parent,siblings,index){this.parent=parent,this.siblings=siblings.slice(0);var i=this.siblings.indexOf(this.source);i>-1&&(this.siblings.splice(i,1),this.source.index()<index&&index--),this.siblings.splice(index,0,this.source),this.index=index},parentNode:function(){return this.parent.$nodeScope},prev:function(){return this.index>0?this.siblings[this.index-1]:null},next:function(){return this.index<this.siblings.length-1?this.siblings[this.index+1]:null},isClone:function(){return this.source.$treeScope.cloneEnabled===!0},clonedNode:function(node){return angular.copy(node)},isDirty:function(){return this.source.$parentNodesScope!=this.parent||this.source.index()!=this.index},isForeign:function(){return this.source.$treeScope!==this.parent.$treeScope},eventArgs:function(elements,pos){return{source:this.sourceInfo,dest:{index:this.index,nodesScope:this.parent},elements:elements,pos:pos}},apply:function(){var nodeData=this.source.$modelValue;this.parent.nodropEnabled||this.parent.$treeScope.nodropEnabled||this.isDirty()&&(this.isClone()&&this.isForeign()?this.parent.insertNode(this.index,this.sourceInfo.cloneModel):(this.source.remove(),this.parent.insertNode(this.index,nodeData)))}}},height:function(element){return element.prop("scrollHeight")},width:function(element){return element.prop("scrollWidth")},offset:function(element){var boundingClientRect=element[0].getBoundingClientRect();return{width:element.prop("offsetWidth"),height:element.prop("offsetHeight"),top:boundingClientRect.top+($window.pageYOffset||$document[0].body.scrollTop||$document[0].documentElement.scrollTop),left:boundingClientRect.left+($window.pageXOffset||$document[0].body.scrollLeft||$document[0].documentElement.scrollLeft)}},positionStarted:function(e,target){var pos={},pageX=e.pageX,pageY=e.pageY;return e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches.length>0&&(pageX=e.originalEvent.touches[0].pageX,pageY=e.originalEvent.touches[0].pageY),pos.offsetX=pageX-this.offset(target).left,pos.offsetY=pageY-this.offset(target).top,pos.startX=pos.lastX=pageX,pos.startY=pos.lastY=pageY,pos.nowX=pos.nowY=pos.distX=pos.distY=pos.dirAx=0,pos.dirX=pos.dirY=pos.lastDirX=pos.lastDirY=pos.distAxX=pos.distAxY=0,pos},positionMoved:function(e,pos,firstMoving){var newAx,pageX=e.pageX,pageY=e.pageY;return e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches.length>0&&(pageX=e.originalEvent.touches[0].pageX,pageY=e.originalEvent.touches[0].pageY),pos.lastX=pos.nowX,pos.lastY=pos.nowY,pos.nowX=pageX,pos.nowY=pageY,pos.distX=pos.nowX-pos.lastX,pos.distY=pos.nowY-pos.lastY,pos.lastDirX=pos.dirX,pos.lastDirY=pos.dirY,pos.dirX=0===pos.distX?0:pos.distX>0?1:-1,pos.dirY=0===pos.distY?0:pos.distY>0?1:-1,newAx=Math.abs(pos.distX)>Math.abs(pos.distY)?1:0,firstMoving?(pos.dirAx=newAx,void(pos.moving=!0)):(pos.dirAx!==newAx?(pos.distAxX=0,pos.distAxY=0):(pos.distAxX+=Math.abs(pos.distX),0!==pos.dirX&&pos.dirX!==pos.lastDirX&&(pos.distAxX=0),pos.distAxY+=Math.abs(pos.distY),0!==pos.dirY&&pos.dirY!==pos.lastDirY&&(pos.distAxY=0)),void(pos.dirAx=newAx))},elementIsTreeNode:function(element){return"undefined"!=typeof element.attr("ui-tree-node")},elementIsTreeNodeHandle:function(element){return"undefined"!=typeof element.attr("ui-tree-handle")},elementIsTree:function(element){return"undefined"!=typeof element.attr("ui-tree")},elementIsTreeNodes:function(element){return"undefined"!=typeof element.attr("ui-tree-nodes")},elementIsPlaceholder:function(element){return element.hasClass(treeConfig.placeholderClass)},elementIsDropzone:function(element){return element.hasClass(treeConfig.dropzoneClass)},elementContainsTreeNodeHandler:function(element){return element[0].querySelectorAll("[ui-tree-handle]").length>=1},treeNodeHandlerContainerOfElement:function(element){return findFirstParentElementWithAttribute("ui-tree-handle",element[0])}}}])}();
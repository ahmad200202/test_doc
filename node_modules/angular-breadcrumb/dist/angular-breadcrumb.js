!function(window,angular,undefined){"use strict";function isAOlderThanB(scopeA,scopeB){return angular.equals(scopeA.length,scopeB.length)?scopeA>scopeB:scopeA.length>scopeB.length}function parseStateRef(ref){var parsed=ref.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/);if(!parsed||4!==parsed.length)throw new Error("Invalid state ref '"+ref+"'");return{state:parsed[1],paramExpr:parsed[3]||null}}function registerListenerOnce(tag,$rootScope,event,fn){var deregisterListenerFn=$registeredListeners[tag];deregisterListenerFn!==undefined&&deregisterListenerFn(),deregisterListenerFn=$rootScope.$on(event,fn),$registeredListeners[tag]=deregisterListenerFn}function $Breadcrumb(){var $$options={prefixStateName:null,template:"bootstrap3",templateUrl:null,templateLast:"default",templateLastUrl:null,includeAbstract:!1};this.setOptions=function(options){angular.extend($$options,options)},this.$get=["$state","$stateParams","$rootScope",function($state,$stateParams,$rootScope){var $lastViewScope=$rootScope;registerListenerOnce("$Breadcrumb.$viewContentLoaded",$rootScope,"$viewContentLoaded",function(event){!event.targetScope.ncyBreadcrumbIgnore&&isAOlderThanB(event.targetScope.$id,$lastViewScope.$id)&&($lastViewScope=event.targetScope)});var $$parentState=function(state){var parent=state.parent||(/^(.+)\.[^.]+$/.exec(state.name)||[])[1],isObjectParent="object"==typeof parent;return isObjectParent?parent.name:parent},$$addStateInChain=function(chain,stateRef){for(var conf,parentParams,ref=parseStateRef(stateRef),force=!1,skip=!1,i=0,l=chain.length;l>i;i+=1)if(chain[i].name===ref.state)return;conf=$state.get(ref.state),conf.ncyBreadcrumb&&(conf.ncyBreadcrumb.force&&(force=!0),conf.ncyBreadcrumb.skip&&(skip=!0)),conf.abstract&&!$$options.includeAbstract&&!force||skip||(ref.paramExpr&&(parentParams=$lastViewScope.$eval(ref.paramExpr)),conf.ncyBreadcrumbLink=$state.href(ref.state,parentParams||$stateParams||{}),conf.ncyBreadcrumbStateRef=stateRef,chain.unshift(conf))},$$breadcrumbParentState=function(stateRef){var ref=parseStateRef(stateRef),conf=$state.get(ref.state);if(conf.ncyBreadcrumb&&conf.ncyBreadcrumb.parent){var isFunction="function"==typeof conf.ncyBreadcrumb.parent,parentStateRef=isFunction?conf.ncyBreadcrumb.parent($lastViewScope):conf.ncyBreadcrumb.parent;if(parentStateRef)return parentStateRef}return $$parentState(conf)};return{getTemplate:function(templates){return $$options.templateUrl?null:templates[$$options.template]?templates[$$options.template]:$$options.template},getTemplateUrl:function(){return $$options.templateUrl},getTemplateLast:function(templates){return $$options.templateLastUrl?null:templates[$$options.templateLast]?templates[$$options.templateLast]:$$options.templateLast},getTemplateLastUrl:function(){return $$options.templateLastUrl},getStatesChain:function(exitOnFirst){for(var chain=[],stateRef=$state.$current.self.name;stateRef;stateRef=$$breadcrumbParentState(stateRef))if($$addStateInChain(chain,stateRef),exitOnFirst&&chain.length)return chain;return $$options.prefixStateName&&$$addStateInChain(chain,$$options.prefixStateName),chain},getLastStep:function(){var chain=this.getStatesChain(!0);return chain.length?chain[0]:undefined},$getLastViewScope:function(){return $lastViewScope}}}]}function BreadcrumbDirective($interpolate,$breadcrumb,$rootScope){var $$templates={bootstrap2:'<ul class="breadcrumb"><li ng-repeat="step in steps" ng-switch="$last || !!step.abstract" ng-class="{active: $last}"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span><span class="divider" ng-hide="$last">/</span></li></ul>',bootstrap3:'<ol class="breadcrumb"><li ng-repeat="step in steps" ng-class="{active: $last}" ng-switch="$last || !!step.abstract"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span></li></ol>'};return{restrict:"AE",replace:!0,scope:{},template:$breadcrumb.getTemplate($$templates),templateUrl:$breadcrumb.getTemplateUrl(),link:{post:function(scope){var labelWatchers=[],renderBreadcrumb=function(){deregisterWatchers(labelWatchers),labelWatchers=[];var viewScope=$breadcrumb.$getLastViewScope();scope.steps=$breadcrumb.getStatesChain(),angular.forEach(scope.steps,function(step){if(step.ncyBreadcrumb&&step.ncyBreadcrumb.label){var parseLabel=$interpolate(step.ncyBreadcrumb.label);step.ncyBreadcrumbLabel=parseLabel(viewScope),registerWatchers(labelWatchers,parseLabel,viewScope,step)}else step.ncyBreadcrumbLabel=step.name})};registerListenerOnce("BreadcrumbDirective.$viewContentLoaded",$rootScope,"$viewContentLoaded",function(event){event.targetScope.ncyBreadcrumbIgnore||renderBreadcrumb()}),renderBreadcrumb()}}}}function BreadcrumbLastDirective($interpolate,$breadcrumb,$rootScope){var $$templates={"default":"{{ncyBreadcrumbLabel}}"};return{restrict:"A",scope:{},template:$breadcrumb.getTemplateLast($$templates),templateUrl:$breadcrumb.getTemplateLastUrl(),compile:function(cElement,cAttrs){var template=cElement.attr(cAttrs.$attr.ncyBreadcrumbLast);return template&&cElement.html(template),{post:function(scope){var labelWatchers=[],renderLabel=function(){deregisterWatchers(labelWatchers),labelWatchers=[];var viewScope=$breadcrumb.$getLastViewScope(),lastStep=$breadcrumb.getLastStep();if(lastStep)if(scope.ncyBreadcrumbLink=lastStep.ncyBreadcrumbLink,lastStep.ncyBreadcrumb&&lastStep.ncyBreadcrumb.label){var parseLabel=$interpolate(lastStep.ncyBreadcrumb.label);scope.ncyBreadcrumbLabel=parseLabel(viewScope),registerWatchers(labelWatchers,parseLabel,viewScope,scope)}else scope.ncyBreadcrumbLabel=lastStep.name};registerListenerOnce("BreadcrumbLastDirective.$viewContentLoaded",$rootScope,"$viewContentLoaded",function(event){event.targetScope.ncyBreadcrumbIgnore||renderLabel()}),renderLabel()}}}}}function BreadcrumbTextDirective($interpolate,$breadcrumb,$rootScope){return{restrict:"A",scope:{},template:"{{ncyBreadcrumbChain}}",compile:function(cElement,cAttrs){var template=cElement.attr(cAttrs.$attr.ncyBreadcrumbText);template&&cElement.html(template);var separator=cElement.attr(cAttrs.$attr.ncyBreadcrumbTextSeparator)||" / ";return{post:function(scope){var labelWatchers=[],registerWatchersText=function(labelWatcherArray,interpolationFunction,viewScope){angular.forEach(getExpression(interpolationFunction),function(expression){var watcher=viewScope.$watch(expression,function(newValue,oldValue){newValue!==oldValue&&renderLabel()});labelWatcherArray.push(watcher)})},renderLabel=function(){deregisterWatchers(labelWatchers),labelWatchers=[];var viewScope=$breadcrumb.$getLastViewScope(),steps=$breadcrumb.getStatesChain(),combinedLabels=[];angular.forEach(steps,function(step){if(step.ncyBreadcrumb&&step.ncyBreadcrumb.label){var parseLabel=$interpolate(step.ncyBreadcrumb.label);combinedLabels.push(parseLabel(viewScope)),registerWatchersText(labelWatchers,parseLabel,viewScope)}else combinedLabels.push(step.name)}),scope.ncyBreadcrumbChain=combinedLabels.join(separator)};registerListenerOnce("BreadcrumbTextDirective.$viewContentLoaded",$rootScope,"$viewContentLoaded",function(event){event.targetScope.ncyBreadcrumbIgnore||renderLabel()}),renderLabel()}}}}}var $registeredListeners={},getExpression=function(interpolationFunction){if(interpolationFunction.expressions)return interpolationFunction.expressions;var expressions=[];return angular.forEach(interpolationFunction.parts,function(part){angular.isFunction(part)&&expressions.push(part.exp)}),expressions},registerWatchers=function(labelWatcherArray,interpolationFunction,viewScope,step){angular.forEach(getExpression(interpolationFunction),function(expression){var watcher=viewScope.$watch(expression,function(){step.ncyBreadcrumbLabel=interpolationFunction(viewScope)});labelWatcherArray.push(watcher)})},deregisterWatchers=function(labelWatcherArray){angular.forEach(labelWatcherArray,function(deregisterWatch){deregisterWatch()})};BreadcrumbDirective.$inject=["$interpolate","$breadcrumb","$rootScope"],BreadcrumbLastDirective.$inject=["$interpolate","$breadcrumb","$rootScope"],BreadcrumbTextDirective.$inject=["$interpolate","$breadcrumb","$rootScope"],angular.module("ncy-angular-breadcrumb",["ui.router.state"]).provider("$breadcrumb",$Breadcrumb).directive("ncyBreadcrumb",BreadcrumbDirective).directive("ncyBreadcrumbLast",BreadcrumbLastDirective).directive("ncyBreadcrumbText",BreadcrumbTextDirective)}(window,window.angular);